<query-editor-row query-ctrl="ctrl" can-collapse="false">
  <div class="gf-form">
    <label class="gf-form-label width-13 pointer" for="in-query-{{ctrl.target.refId}}">
      Query
      <info-popover position="top center" mode="right-normal">
        <p>Specify a query for the entities you wish to plot. Use the dynamic focus syntax:
          <a href="https://docs.instana.io/core_concepts/dynamic_focus/#syntax">https://docs.instana.io/core_concepts/dynamic_focus/#syntax</a>
        </p>
      </info-popover>
    </label>
    <input id="in-query-{{ctrl.target.refId}}"
           class="gf-form-input"
           type="text"
           ng-model='ctrl.target.entityQuery'
           ng-class="ctrl.target.queryIsValid ? 'ng-valid' : 'ng-invalid'"
           ng-model-options='{ debounce: 300 }'
           ng-change="ctrl.onFilterChange(true)"
           placeholder="Please Specify"
           spellcheck='false'/>
  </div>

  <div class="gf-form">
    <label class="gf-form-label width-13 pointer" for="in-category-{{ctrl.target.refId}}">
      Category
      <info-popover position="top center" mode="right-normal">
        <p>Select a metric category.</p>
      </info-popover>
    </label>
    <div class="gf-form-select-wrapper width-22 gf-form-select-wrapper--has-help-icon">
      <select id="in-category-{{ctrl.target.refId}}"
              class="gf-form-input ng-pristine ng-valid ng-not-empty ng-touched"
              ng-model="ctrl.target.metricCategory"
              ng-change="ctrl.onMetricCategorySelect()">
        <option value="0" selected>Built-in metrics</option>
        <option value="1">Custom metrics</option>
      </select>
    </div>
  </div>

  <div class="gf-form">
    <label class="gf-form-label width-13 pointer" for="in-type-{{ctrl.target.refId}}">
      Type
      <info-popover position="top center" mode="right-normal">
        <p>Select an entity type for a list of available metrics.</p>
      </info-popover>
    </label>
    <div class="gf-form-select-wrapper width-22 gf-form-select-wrapper--has-help-icon">
      <select id="in-type-{{ctrl.target.refId}}"
              class="gf-form-input ng-pristine ng-valid ng-not-empty ng-touched"
              ng-model="ctrl.target.entityType"
              ng-change="ctrl.onEntityTypeSelect(true)"
              ng-options="f.key as f.label for f in ctrl.uniqueEntityTypes track by f.key">
        <option value="" disabled selected>{{ctrl.entitySelectionText}}</option>
      </select>
    </div>
  </div>

  <div class="gf-form" ng-hide="ctrl.target.metricCategory === '0'">
    <label class="gf-form-label width-13 pointer" for="in-filter-{{ctrl.target.refId}}">
      Filter metric select
      <info-popover position="top center" mode="right-normal">
        <p>Type to suggest metrics.</p>
      </info-popover>
    </label>
    <input id="in-filter-{{ctrl.target.refId}}"
           class="gf-form-input width-22"
           type="text"
           ng-model="ctrl.target.filter"
           ng-model-options='{ debounce: 200 }'
           ng-change="ctrl.onMetricsFilter(true)"
           placeholder="(optional)"
           spellcheck='false'/>
  </div>

  <div class="gf-form">
    <label class="gf-form-label width-13 pointer" for="in-metric-{{ctrl.target.refId}}">
      Metric
      <info-popover position="top center" mode="right-normal">
        <p>Select the metric you wish to plot.</p>
      </info-popover>
    </label>
    <div class="gf-form-select-wrapper width-22 gf-form-select-wrapper--has-help-icon">
      <select id="in-metric-{{ctrl.target.refId}}"
              class="gf-form-input ng-pristine ng-valid ng-not-empty ng-touched"
              ng-model="ctrl.target.metric"
              ng-change="ctrl.onMetricSelect()"
              ng-options="f as f.label + ' (' + f.key + ')' for f in ctrl.availableMetrics track by f.key">
        <option value="" disabled selected>{{ctrl.metricSelectionText}}</option>
      </select>
    </div>
  </div>

  <div class="gf-form">
    <label class="gf-form-label width-13 pointer">
      Legend format
      <info-popover position="top center" mode="right-normal">
        Default: $label (on host $host)
        <ul>
          <li>$label - entity label</li>
          <li>$host - corresponding host</li>
          <li>$pid - corresponding PID</li>
          <li>$metric - displayed metric</li>
          <li>$type - entity type</li>
          <li>$service - service label</li>
          <li>$name - label alternative</li>
        </ul>
      </info-popover>
    </label>
    <input id="in-legend-{{ctrl.target.refId}}"
           class="gf-form-input width-22"
           type="text"
           ng-model="ctrl.target.labelFormat"
           ng-model-options='{ debounce: 500 }'
           placeholder="$label (on host $host)"
           ng-change="ctrl.onLabelChange()"
           spellcheck='false'/>
  </div>

</query-editor-row>
