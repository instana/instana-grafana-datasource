/*! For license information please see module.js.LICENSE.txt */
define(["react","lodash","@grafana/ui","@grafana/data","@grafana/runtime"],(function(e,t,n,a,r){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=12)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var r=(o=a,l=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),"/*# ".concat(s," */")),i=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[n].concat(i).concat([r]).join("\n")}var o,l,s;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,a){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(a)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(var l=0;l<e.length;l++){var s=[].concat(e[l]);a&&r[s[0]]||(n&&(s[2]?s[2]="".concat(n," and ").concat(s[2]):s[2]=n),t.push(s))}},t}},function(e,t,n){var a,r,i={},o=(a=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=a.apply(this,arguments)),r}),l=function(e,t){return t?t.querySelector(e):document.querySelector(e)},s=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var a=l.call(this,e,n);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}}(),u=null,c=0,p=[],y=n(9);function h(e,t){for(var n=0;n<e.length;n++){var a=e[n],r=i[a.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](a.parts[o]);for(;o<a.parts.length;o++)r.parts.push(b(a.parts[o],t))}else{var l=[];for(o=0;o<a.parts.length;o++)l.push(b(a.parts[o],t));i[a.id]={id:a.id,refs:1,parts:l}}}}function d(e,t){for(var n=[],a={},r=0;r<e.length;r++){var i=e[r],o=t.base?i[0]+t.base:i[0],l={css:i[1],media:i[2],sourceMap:i[3]};a[o]?a[o].parts.push(l):n.push(a[o]={id:o,parts:[l]})}return n}function f(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var a=p[p.length-1];if("top"===e.insertAt)a?a.nextSibling?n.insertBefore(t,a.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),p.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=s(e.insertAt.before,n);n.insertBefore(t,r)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=p.indexOf(e);t>=0&&p.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var a=function(){0;return n.nc}();a&&(e.attrs.nonce=a)}return v(t,e.attrs),f(e,t),t}function v(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function b(e,t){var n,a,r,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var o=c++;n=u||(u=g(t)),a=E.bind(null,n,o,!1),r=E.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(t,e.attrs),f(e,t),t}(t),a=k.bind(null,n,t),r=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(t),a=T.bind(null,n),r=function(){m(n)});return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=d(e,t);return h(n,t),function(e){for(var a=[],r=0;r<n.length;r++){var o=n[r];(l=i[o.id]).refs--,a.push(l)}e&&h(d(e,t),t);for(r=0;r<a.length;r++){var l;if(0===(l=a[r]).refs){for(var s=0;s<l.parts.length;s++)l.parts[s]();delete i[l.id]}}}};var S,C=(S=[],function(e,t){return S[e]=t,S.filter(Boolean).join("\n")});function E(e,t,n,a){var r=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=C(t,r);else{var i=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function T(e,t){var n=t.css,a=t.media;if(a&&e.setAttribute("media",a),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function k(e,t,n){var a=n.css,r=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&r;(t.convertToAbsoluteUrls||i)&&(a=y(a)),r&&(a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([a],{type:"text/css"}),l=e.href;e.href=URL.createObjectURL(o),l&&URL.revokeObjectURL(l)}},function(e,t){e.exports=r},function(e,t,n){var a=n(8);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(5)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(t=n(4)(!0)).push([e.i,".entityDropdown {\n  min-width: 80px; }\n","",{version:3,sources:["plugin.css"],names:[],mappings:"AAAA;EACE,eAAe,EAAE",file:"plugin.css",sourcesContent:[".entityDropdown {\n  min-width: 80px; }\n"]}]),e.exports=t},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,a=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var r,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(r=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:a+i.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(e,t,n){var a=n(11);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(5)(a,r);a.locals&&(e.exports=a.locals)},function(e,t,n){(t=n(4)(!0)).push([e.i,'path[d="M18.71,7.21a1,1,0,0,0-1.42,0L9.84,14.67,6.71,11.53A1,1,0,1,0,5.29,13l3.84,3.84a1,1,0,0,0,1.42,0l8.16-8.16A1,1,0,0,0,18.71,7.21Z"] {\n  display: none; }\n',"",{version:3,sources:["instana-grafana.css"],names:[],mappings:"AAAA;EACE,aAAa,EAAE",file:"instana-grafana.css",sourcesContent:['path[d="M18.71,7.21a1,1,0,0,0-1.42,0L9.84,14.67,6.71,11.53A1,1,0,1,0,5.29,13l3.84,3.84a1,1,0,0,0,1.42,0l8.16-8.16A1,1,0,0,0,18.71,7.21Z"] {\n  display: none; }\n']}]),e.exports=t},function(e,t,n){"use strict";n.r(t);var a=n(3),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function l(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}function s(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{s(a.next(e))}catch(e){i(e)}}function l(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}s((a=a.apply(e,t||[])).next())}))}function u(e,t){var n,a,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}var p=n(6);function y(e,t,n,a){return void 0===n&&(n=!1),void 0===a&&(a=1),d(e,{method:"GET",url:e.url+t},n,a)}function h(e,t,n,a,r){return void 0===a&&(a=!1),void 0===r&&(r=0),d(e,{method:"POST",url:e.url+t,data:n},a,r)}function d(e,t,n,a){return e.useProxy||(t.headers={Authorization:"apiToken "+e.apiToken}),Object(p.getBackendSrv)().datasourceRequest(t).catch((function(r){var i;if(429===r.status){if(a>0&&(null===(i=r.data)||void 0===i?void 0:i.errors)&&r.data.errors[0]&&r.data.errors[0].includes("concurrent")){var o=a>=4?1e4:2e4*(4-a);return new Promise((function(e){return setTimeout(e,o)})).then((function(){return d(e,t,n,a-1)}))}throw new Error("API limit is reached.")}if(!n||!(r.status>=400||r.status<500)){if(a>0)return d(e,t,n,a-1);throw r}console.log(r)}))}function f(e){return{target:e,datapoints:[]}}function m(e,t,n){return{target:e,refId:t,datapoints:n}}var g="-- No Application Filter --",v="-- No Endpoint Filter --";function b(e){var t=1e3*Math.floor(new Date(e.from.valueOf()).getTime()/1e3),n=1e3*Math.floor(new Date(e.to.valueOf()).getTime()/1e3);return{from:t,to:n,windowSize:n-t}}function S(e){return e.from?e.to-e.from:e.windowSize}function C(e){return E(e.from)+"|"+E(e.to)}function E(e){return Math.floor(e/6e4)}function T(e){return e>0?60*e*60*1e3:0}var k=function(){function e(){this.store={}}return e.prototype.put=function(e,t,n){var a=this;void 0===n&&(n=7e4),void 0!==e&&void 0!==t&&(this.del(e),this.store[e]={value:t,expiry:Date.now()+n,timeout:setTimeout((function(){a.del(e)}),n)})},e.prototype.get=function(e){var t=this.store[e];return!t||t.expiry&&t.expiry>Date.now()||(this.del(e),t=void 0),t&&t.value},e.prototype.del=function(e){this.store.hasOwnProperty(e)&&(clearTimeout(this.store[e].timeout),delete this.store[e])},e}(),w=n(1),A=n.n(w),I=function(){function e(e){this.instanaOptions=e,this.sliReportsCache=new k}return e.prototype.getConfiguredSLIs=function(){var e=this.sliReportsCache.get("sliReports");return e||(e=y(this.instanaOptions,"/api/settings/sli").then((function(e){return A.a.map(e.data,(function(e){return{key:e.id,label:e.sliName}}))})),this.sliReportsCache.put("sliReports",e),e)},e.prototype.runQuery=function(e,t){var n=this;if(!(e&&e.sloReport&&e.sloReport.key&&e.sloSpecific&&e.sloSpecific.key&&e.sloValue))return Promise.resolve(f(e.refId));var a="/api/sli/report/"+e.sloReport.key+"?from="+t.from+"&to="+t.to+"&slo="+e.sloValue;return y(this.instanaOptions,a).then((function(a){return n.extractSpecificValueFromSLI(e,a.data,t)}))},e.prototype.extractSpecificValueFromSLI=function(e,t,n){return"SLI"===e.sloSpecific.key?[m(e.sloSpecific.label,e.refId,this.buildResultArray(t.sli,n.to))]:"Remaining Error Budget"===e.sloSpecific.key?[m(e.sloSpecific.label,e.refId,this.buildResultArray(t.errorBudgetRemaining,n.to))]:"Timeseries"===e.sloSpecific.key?this.buildViolationDistributionTimeSeries(e,t.violationDistribution,n):[f(e.refId)]},e.prototype.buildResultArray=function(e,t){return[[e,t]]},e.prototype.buildViolationDistributionTimeSeries=function(e,t,n){var a=[],r=[],i=[],o=S(n)/Object.keys(t).length;A.a.forEach(t,(function(e,t){1===e?a.push([1,n.from+t*o]):0===e?i.push([1,n.from+t*o]):-1===e&&r.push([1,n.from+t*o])}));var l=[];return l.push(m("No violation",e.refId,a)),l.push(m("Violation",e.refId,r)),l.push(m("No data",e.refId,i)),l},e}(),M=[{label:"Infrastructure built-in metrics",key:0},{label:"Infrastructure custom metrics",key:1},{label:"Application/service/endpoint metrics",key:4},{label:"Analyze application calls",key:2},{label:"Analyze website",key:3},{label:"SLO information",key:7}];function R(e,t){return!!t&&(t>0&&1e3*Math.floor(e/1e3)>t)}var q=[{value:1,label:"1s"},{value:5,label:"5s"},{value:10,label:"10s"},{value:60,label:"1min"},{value:300,label:"5min"},{value:600,label:"10min"},{value:3600,label:"1h"},{value:18e3,label:"5h"},{value:36e3,label:"10h"},{value:86400,label:"1d"},{value:432e3,label:"5d"},{value:864e3,label:"10d"}],L=[{availableFor:864e5,rollup:1e3,label:"1s"},{availableFor:864e5,rollup:5e3,label:"5s"},{availableFor:26784e5,rollup:6e4,label:"1min"},{availableFor:80352e5,rollup:3e5,label:"5min"},{availableFor:321408e5,rollup:36e5,label:"1h"}];function O(e){return F(e,80)[0]}function F(e,t){void 0===t&&(t=600);var n=q.filter((function(n){return e/1e3/n.value<=t&&1e3*n.value<=e}));return e>48000001&&(n=n.filter((function(e){return e.value>=3600}))),e>=18e5&&(n=n.filter((function(e){return e.value>=60}))),n.length>0?n.map((function(e){return{key:e.value.toString(),label:e.label}})):[{key:q[q.length-1].value.toString(),label:q[q.length-1].label}]}function x(e){return N(e)[0]}function N(e){var t=Date.now(),n=function(e){return e.from?e.to-e.from:e.windowSize}(e),a=L.filter((function(n){return e.from>=t-n.availableFor})).filter((function(e){return n>=e.rollup&&n/e.rollup<=800}));return a.length>0?a.map((function(e){return{key:e.rollup.toString(),label:e.label}})):[{key:L[L.length-1].rollup.toString(),label:L[L.length-1].label}]}var P=[{key:"cpu.used",value:"cpu.count",label:"cpu.max"},{key:"memory.used",value:"memory.total",label:"memory.max"},{key:"openFiles.used",value:"openFiles.max",label:"openFiles.max"}],Q=function(){function e(e){this.timeToLiveSnapshotInfoCache=4e6,this.instanaOptions=e,this.snapshotCache=new k,this.snapshotInfoCache=new k,this.catalogCache=new k,this.typeCache=new k}return e.prototype.runQuery=function(e,t){var n=this;if(R(t.windowSize,T(this.instanaOptions.queryinterval_limit_infra)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_infra+" hours");return e.metric&&e.metric.key||e.showAllMetrics||e.freeTextMetrics?this.fetchSnapshotsForTarget(e,t).then((function(a){if(e.showAllMetrics)return n.fetchMultipleMetricsForSnapshots(e,a,t,e.allMetrics);if(e.freeTextMetrics){var r=n.extractMetricsFromText(e.freeTextMetrics);return n.fetchMultipleMetricsForSnapshots(e,a,t,r)}return n.fetchMetricsForSnapshots(e,a,t,e.metric)})):Promise.resolve(f(e.refId))},e.prototype.extractMetricsFromText=function(e){var t=e.replace(/\s/g,"").split(","),n=[];return A.a.each(t,(function(e){return n.push(JSON.parse('{ "key": "'+e+'"}'))})),n.length>4&&(n=n.slice(0,4)),n},e.prototype.fetchMultipleMetricsForSnapshots=function(e,t,n,a){var r=this,i=[];return A.a.forEach(a,(function(a){i.push(r.fetchMetricsForSnapshots(e,t,n,a))})),Promise.all(i).then((function(e){var t=[];return e.forEach((function(e){return e.forEach((function(e){return t.push(e)}))})),t}))},e.prototype.fetchMetricsForSnapshots=function(e,t,n,a){var r=this,i=[],o=A.a.map(t,(function(t,o){return r.fetchMetricsForSnapshot(t.snapshotId,n,e.timeInterval.key,a).then((function(l){var s=r.readTimeSeries(l.data.values,e.aggregation,n),u={target:r.buildLabel(t.response,t.host,e,o,a),datapoints:A.a.map(s,(function(e){return[e.value,e.timestamp]})),refId:e.refId,key:e.stableHash};if(e.displayMaxMetricValue){var c=r.getMaxMetricValue(e.metric,t);i.push(r.buildMaxMetricTarget(e,s,c,u.target)),u.datapoints=r.convertRelativeToAbsolute(u.datapoints,c)}return u}))}));return Promise.all(o).then((function(t){return e.displayMaxMetricValue&&(t=A.a.concat(o,i)),Promise.all(t)}))},e.prototype.getMaxMetricValue=function(e,t){var n=P;return t.response.data.data[A.a.find(n,(function(t){return t.key===e.key})).value]},e.prototype.buildMaxMetricTarget=function(e,t,n,a){var r=A.a.map(t,(function(e){return[n,e.timestamp]})),i=this.convertMetricNameToMaxLabel(e.metric);return{target:a+" "+i,datapoints:r,refId:e.refId,key:e.stableHash+i}},e.prototype.convertMetricNameToMaxLabel=function(e){var t=P;return A.a.find(t,(function(t){return t.key===e.key})).label},e.prototype.convertRelativeToAbsolute=function(e,t){return A.a.map(e,(function(e){return e[0]?[e[0]*t,e[1]]:[null,e[1]]}))},e.prototype.getEntityTypes=function(){var e=this.typeCache.get("entityTypes");return e||(e=y(this.instanaOptions,"/api/infrastructure-monitoring/catalog/plugins").then((function(e){var t=e.data.map((function(e){return{key:e.plugin,label:e.label}}));return t.push({key:"regionEntity",label:"Region"}),A.a.sortBy(t,"label")})),this.typeCache.put("entityTypes",e),e)},e.prototype.fetchTypesForTarget=function(e,t){var n="/api/snapshots/types?q="+encodeURIComponent(e.entityQuery)+"&from="+t.from+"&to="+t.to+(this.instanaOptions.showOffline?"":"&time="+t.to);return y(this.instanaOptions,n)},e.prototype.getMetricsCatalog=function(e,t){var n=e.key+"|"+t,a=this.catalogCache.get(n);if(a)return a;var r=1===t?"custom":"builtin";return a=y(this.instanaOptions,"/api/infrastructure-monitoring/catalog/metrics/"+e.key+"?filter="+r).then((function(e){return e.data.map((function(e){return{key:e.metricId,label:e.label,description:e.metricId,aggregations:[{key:"MEAN",label:"MEAN"},{key:"SUM",label:"SUM"}],entityType:e.pluginId}}))})),this.catalogCache.put(n,a),a},e.prototype.fetchSnapshotsForTarget=function(e,t){var n=this,a=this.buildQuery(e),r=this.buildSnapshotCacheKey(a,t),i=this.snapshotCache.get(r);if(i)return i;var o="/api/snapshots/context?q="+a+"&from="+t.from+"&to="+t.to+(this.instanaOptions.showOffline?"":"&time="+t.to+"&size=100");return i=y(this.instanaOptions,o).then((function(e){return Promise.all(e.data.map((function(e){var a=e.snapshotId,r=e.host,i=n.snapshotInfoCache.get(a);if(i)return i;var o="/api/snapshots/"+a+(n.instanaOptions.showOffline?"?from="+t.from+"&to="+t.to:"?time="+t.to);return i=y(n.instanaOptions,o,!0).then((function(e){return void 0!==e?{snapshotId:a,host:r,response:n.reduceSnapshot(e)}:null})),n.snapshotInfoCache.put(a,i,n.timeToLiveSnapshotInfoCache),i})))})).then((function(e){return A.a.compact(e)})),this.snapshotCache.put(r,i),i},e.prototype.buildQuery=function(e){return(""+e.entityQuery).includes("entity.pluginId:")||(""+e.entityQuery).includes("entity.selfType:")?encodeURIComponent(""+e.entityQuery):encodeURIComponent(e.entityQuery+" AND entity.pluginId:"+e.entityType.key)},e.prototype.buildSnapshotCacheKey=function(e,t){return e+"|"+C(t)},e.prototype.reduceSnapshot=function(e){return e.data=A.a.pick(e.data,["id","label","plugin","data"]),e},e.prototype.readTimeSeries=function(e,t,n){return t&&"SUM"===t.key?this.correctMeanToSum(e,n):e},e.prototype.correctMeanToSum=function(e,t){var n=parseInt(x(t).key,10)/1e3;return A.a.map(e,(function(e){return{value:e.value?e.value*n:null,timestamp:e.timestamp}}))},e.prototype.fetchMetricsForSnapshot=function(e,t,n,a){var r="/api/metrics?metric="+a.key+"&from="+t.from+"&to="+t.to+"&rollup="+n+"&fillTimeSeries=true&snapshotId="+e;return y(this.instanaOptions,r)},e.prototype.getHostSuffix=function(e){return e?' (on host "'+e+'")':""},e.prototype.buildLabel=function(e,t,n,a,r){if(n.labelFormat){var i=n.labelFormat;return i=A.a.replace(i,"$label",e.data.label),i=A.a.replace(i,"$plugin",e.data.plugin),i=A.a.replace(i,"$snapshot",e.data.id),i=A.a.replace(i,"$host",t||"unknown"),i=A.a.replace(i,"$pid",A.a.get(e.data,["data","pid"],"")),i=A.a.replace(i,"$type",A.a.get(e.data,["data","type"],"")),i=A.a.replace(i,"$name",A.a.get(e.data,["data","name"],"")),i=A.a.replace(i,"$service",A.a.get(e.data,["data","service_name"],"")),i=n.freeTextMetrics?A.a.replace(i,"$metric",r.key):A.a.replace(i,"$metric",A.a.get(n,["metric","key"],"n/a")),i=A.a.replace(i,"$index",a+1),i=A.a.replace(i,"$timeShift",n.timeShift)}return n.timeShift&&n.timeShiftIsValid?e.data.label+this.getHostSuffix(t)+" - "+n.timeShift:e.data.label+this.getHostSuffix(t)},e}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var $=["refId","pluginId","showWarningCantShowAllResults","timeShiftIsValid","useFreeTextMetrics","showGroupBySecondLevel","canShowAllMetrics","timeFilter","stableHash"];var U=new k;function D(e){var t=U.get("version");return t?Promise.resolve(t):y(e,"/api/instana/version").then((function(t){if(t.data&&t.data.imageTag){var n=parseInt(t.data.imageTag.split(".",2)[1],10)||null;return n&&U.put(e.url,n,6e5),n}return null}),(function(e){return null}))}function B(e,t){var n=function(e){if(e.showAllMetrics){if(e.allMetrics.length>1){if(e.customFilters&&e.customFilters.length>0){var t="";return A.a.each(e.customFilters,(function(n,a){t+=n,a!==e.customFilters.length-1&&(t+=".")})),t=t+" ("+e.aggregationFunction.label+")"}return e.aggregationFunction.label}return e.allMetrics[0].key+" ("+e.aggregationFunction.label+")"}return e.metric.key+" ("+e.aggregationFunction.label+")"}(t),a=function(e){var t=[];return A.a.each(e,(function(e){t=A.a.concat(t,e.datapoints)})),t}(e=A.a.filter(e,(function(e){return e.target!==n}))),r=function(e,t){var n=[];return A.a.each(e,(function(e,a){var r,i,o=A.a.map(e,(function(e){return e[0]})),l=(i=o,"sum"===(r=t).toLowerCase()?A.a.sum(i):"mean"===r.toLowerCase()?A.a.mean(i):"min"===r.toLowerCase()?A.a.min(i):"max"===r.toLowerCase()?A.a.max(i):i);n.push([l,parseInt(a,10)])})),n}(A.a.groupBy(a,(function(e){return e[1]})),t.aggregationFunction.label);return function(e,t,n){return{datapoints:e,refId:t,target:n}}(r=A.a.sortBy(r,[function(e){return e[1]}]),t.refId,n)}function V(e){var t={name:e.tag.key,operator:e.operator.key,value:e.stringValue};return"NUMBER"===e.tag.type?null!==e.numberValue&&(t.value=e.numberValue.toString()):"BOOLEAN"===e.tag.type&&(t.value=e.booleanValue.toString()),t}function W(e,t,n){return t.data?A.a.flatten(t.data.items.map((function(t,a){return A.a.map(t.metrics,(function(r,i){return{target:n(e,t,i,a),datapoints:A.a.map(r,(function(e){return[e[1],e[0]]})),refId:e.refId,key:e.stableHash}}))}))):t}var z=function(){function e(e){this.instanaOptions=e,this.websitesCache=new k,this.miscCache=new k}return e.prototype.runQuery=function(e,t){var n=this;if(R(t.windowSize,T(this.instanaOptions.queryinterval_limit_website_metrics)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_website_metrics+" hours");return e&&e.metric&&e.metric.key&&e.group&&e.group.key&&e.entity&&e.entity.key?this.fetchAnalyzeMetricsForWebsite(e,t).then((function(t){return W(e,t,n.buildAnalyzeWebsiteLabel)})):Promise.resolve(f(e.refId))},e.prototype.getWebsites=function(e){var t=C(e),n=this.websitesCache.get(t);if(n)return n;var a=S(e),r={group:{groupbyTag:"beacon.website.name"},timeFrame:{to:e.to,windowSize:a},type:"PAGELOAD",metrics:[{metric:"pageLoads",aggregation:"SUM"}],order:{by:"pageLoads",direction:"desc"},pagination:{ingestionTime:0,offset:0,retrievalSize:200}};return n=h(this.instanaOptions,"/api/website-monitoring/analyze/beacon-groups",r).then((function(e){return e.data.items.map((function(e){return{key:e.name,label:e.name}}))})),this.websitesCache.put(t,n,6e5),n},e.prototype.getWebsiteTags=function(){var e=this.miscCache.get("websiteTags");return e||(e=y(this.instanaOptions,"/api/website-monitoring/catalog/tags").then((function(e){return e.data.map((function(e){return{key:e.name,label:e.name,type:e.type}}))})),this.miscCache.put("websiteTags",e),e)},e.prototype.getWebsiteMetricsCatalog=function(){var e=this,t=this.miscCache.get("websiteCatalog");return t||(t=y(this.instanaOptions,"/api/website-monitoring/catalog/metrics").then((function(t){return t.data.map((function(t){return{key:t.metricId,label:t.label,aggregations:t.aggregations?e.transformAggregations(t.aggregations.sort()):[],beaconTypes:t.beaconTypes?e.transformBeaconTypes(t.beaconTypes):["pageLoad","resourceLoad","httpRequest","error","custom","pageChange"]}}))})),this.miscCache.put("websiteCatalog",t),t)},e.prototype.transformBeaconTypes=function(e){if(e.includes("pageChange")){var t=A.a.remove(e,(function(e){return"pageChange"!==e}));return t.push("page_change"),t}return e},e.prototype.transformAggregations=function(e){return A.a.map(e,(function(e){return{key:e,label:e}}))},e.prototype.fetchAnalyzeMetricsForWebsite=function(e,t){var n=S(t),a=[{name:"beacon.website.name",operator:"EQUALS",value:e.entity.key}];A.a.forEach(e.filters,(function(e){e.isValid&&a.push(V(e))}));var r={metric:e.metric.key,aggregation:e.aggregation.key?e.aggregation.key:"SUM"};e.timeInterval||(e.timeInterval=O(n)),r.granularity=e.timeInterval.key;var i={groupbyTag:e.group.key};"KEY_VALUE_PAIR"===e.group.type&&e.groupbyTagSecondLevelKey&&(i.groupbyTagSecondLevelKey=e.groupbyTagSecondLevelKey);var o={group:i,timeFrame:{to:t.to,windowSize:n},tagFilters:a,type:e.entityType.key,metrics:[r]};return h(this.instanaOptions,"/api/website-monitoring/analyze/beacon-groups?fillTimeSeries=true",o,!1,5)},e.prototype.buildAnalyzeWebsiteLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=A.a.replace(r,"$label",t.name),r=A.a.replace(r,"$website",e.entity.label),r=A.a.replace(r,"$type",e.entityType.label),r=A.a.replace(r,"$metric",e.metric.label),r=A.a.replace(r,"$key",n),r=A.a.replace(r,"$index",""+a+1),r=A.a.replace(r,"$timeShift",e.timeShift)}return e.timeShift&&e.timeShiftIsValid?t.name+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.name+" ("+e.entity.label+") - "+n},e}(),G=[{key:"calls",label:"Call count",description:"calls",aggregations:[{key:"SUM",label:"SUM"}]},{key:"latency",label:"Call latency",description:"latency",aggregations:[{key:"MAX",label:"MAX"},{key:"MEAN",label:"MEAN"},{key:"MIN",label:"MIN"},{key:"P25",label:"P25"},{key:"P50",label:"P50"},{key:"P75",label:"P75"},{key:"P90",label:"P90"},{key:"P95",label:"P95"},{key:"P98",label:"P98"},{key:"P99",label:"P99"}]},{key:"errors",label:"Error rate",description:"errors",aggregations:[{key:"MEAN",label:"MEAN"}]},{key:"services",label:"Service Count",description:"services",aggregations:[{key:"DISTINCT_COUNT",label:"DISTINCT_COUNT"}]}],K=function(){function e(e){this.instanaOptions=e,this.applicationsCache=new k,this.miscCache=new k}return e.prototype.runQuery=function(e,t){var n=this;if(R(t.windowSize,T(this.instanaOptions.queryinterval_limit_app_calls)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_app_calls+" hours");return e&&e.metric&&e.metric.key&&e.group&&e.group.key&&e.entity&&(e.entity.key||e.entity.label)?this.fetchAnalyzeMetricsForApplication(e,t).then((function(t){return e.showWarningCantShowAllResults=t.data.canLoadMore,W(e,t,n.buildAnalyzeApplicationLabel)})):Promise.resolve(f(e.refId))},e.prototype.getApplications=function(e){var t=C(e),n=this.applicationsCache.get(t);if(n)return n;var a=S(e);return n=this.paginateApplications([],a,e.to,1,200,15).then((function(e){var t=A.a.flattenDeep(A.a.map(e,(function(e){return e.items})));return A.a.orderBy(A.a.compact(t).map((function(e){return{key:e.id,label:e.label,boundaryScope:e.boundaryScope}})),[function(e){return e.label.toLowerCase()}],["asc"])})),this.applicationsCache.put(t,n,6e5),n},e.prototype.paginateApplications=function(e,t,n,a,r,i){var o=this;if(a>i)return e;var l="windowSize="+t+"&to="+n+"&page="+a+"&pageSize="+r;return y(this.instanaOptions,"/api/application-monitoring/applications?"+l).then((function(l){return e.push(l.data),a*r<l.data.totalHits?(a++,o.paginateApplications(e,t,n,a,r,i)):e}))},e.prototype.getApplicationTags=function(){var e=this.miscCache.get("applicationTags");return e||(e=y(this.instanaOptions,"/api/application-monitoring/catalog/tags").then((function(e){return e.data.map((function(e){return{key:e.name,label:e.name,type:e.type,canApplyToSource:e.canApplyToSource,canApplyToDestination:e.canApplyToDestination}}))})),this.miscCache.put("applicationTags",e),e)},e.prototype.getApplicationMetricsCatalog=function(){return G},e.prototype.fetchAnalyzeMetricsForApplication=function(e,t){var n=this,a=S(t),r=[];return Promise.resolve(this.getApplicationTags()).then((function(i){e.entity.key&&r.push({name:"application.name",operator:"EQUALS",value:e.entity.label,entity:e.applicationCallToEntity?e.applicationCallToEntity:"DESTINATION"}),A.a.forEach(e.filters,(function(e){if(e.isValid){var t=V(e),a=A.a.find(i,["key",e.tag.key]);(a.canApplyToDestination||a.canApplyToSource)&&(t.entity=n.getTagEntity(e.entity,a)),r.push(t)}}));var o={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM"};e.timeInterval||(e.timeInterval=O(a)),o.granularity=e.timeInterval.key;var l={groupbyTag:e.group.key},s=A.a.find(i,["key",e.group.key]);(s.canApplyToDestination||s.canApplyToSource)&&(l.groupbyTagEntity=e.callToEntity),"KEY_VALUE_PAIR"===e.group.type&&e.groupbyTagSecondLevelKey&&(l.groupbyTagSecondLevelKey=e.groupbyTagSecondLevelKey);var u={group:l,timeFrame:{to:t.to,windowSize:a},tagFilters:r,metrics:[o]};return h(n.instanaOptions,"/api/application-monitoring/analyze/call-groups?fillTimeSeries=true",u,!1,5)}))},e.prototype.getTagEntity=function(e,t){return"DESTINATION"===e&&t.canApplyToDestination?"DESTINATION":"SOURCE"===e&&t.canApplyToSource?"SOURCE":t.canApplyToDestination?"DESTINATION":"SOURCE"},e.prototype.fetchApplicationMetrics=function(e,t){if(!e||!e.metric||!e.metric.key)return Promise.resolve(f(e.refId));var n=S(t),a={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM"};e.timeInterval||(e.timeInterval=O(n)),a.granularity=e.timeInterval.key;var r={timeFrame:{to:t.to,windowSize:n},metrics:[a]};return null!==e.entity.key&&(r.applicationId=e.entity.key,r.applicationBoundaryScope=e.applicationBoundaryScope),h(this.instanaOptions,"/api/application-monitoring/metrics/applications?fillTimeSeries=true",r)},e.prototype.buildAnalyzeApplicationLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=A.a.replace(r,"$label",t.name),r=A.a.replace(r,"$application",e.entity.label),r=A.a.replace(r,"$metric",e.metric.label),r=A.a.replace(r,"$key",n),r=A.a.replace(r,"$index",""+a+1),r=A.a.replace(r,"$timeShift",e.timeShift)}return e.entity.label===g?e.timeShift?t.name+" - "+n+" - "+e.timeShift:t.name+" - "+n:e.timeShift&&e.timeShiftIsValid?t.name+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.name+" ("+e.entity.label+") - "+n},e.prototype.buildApplicationMetricLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=A.a.replace(r,"$label",t.application.label),r=A.a.replace(r,"$application",e.entity.label),r=A.a.replace(r,"$metric",e.metric.label),r=A.a.replace(r,"$key",n),r=A.a.replace(r,"$index",""+a+1),r=A.a.replace(r,"$timeShift",e.timeShift)}return e.entity.label===g?e.timeShift?t.application.label+" - "+n+" - "+e.timeShift:t.application.label+" - "+n:e.timeShift&&e.timeShiftIsValid?t.application.label+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.application.label+" ("+e.entity.label+") - "+n},e}(),j=function(){function e(e){this.instanaOptions=e,this.servicesCache=new k}return e.prototype.getServicesOfApplication=function(e,t){var n="";e.entity&&e.entity.key&&(n=e.entity.key);var a=C(t)+n+e.applicationBoundaryScope,r=this.servicesCache.get(a);if(r)return r;var i=S(t);return r=this.paginateServices([],n,i,t.to,e.applicationBoundaryScope,1,200,15).then((function(e){var t=A.a.flattenDeep(A.a.map(e,(function(e){return e.items})));return A.a.orderBy(A.a.compact(t).map((function(e){return{key:e.id,label:e.label}})),[function(e){return e.label.toLowerCase()}],["asc"])})),this.servicesCache.put(a,r,6e5),r},e.prototype.paginateServices=function(e,t,n,a,r,i,o,l){var s=this;if(i>l)return e;var u="windowSize="+n+"&to="+a+"&page="+i+"&pageSize="+o;"ALL"!==r&&"INBOUND"!==r||(u+="&applicationBoundaryScope="+r);var c="/api/application-monitoring/applications;id="+(t||"")+"/services?"+u;return y(this.instanaOptions,c).then((function(u){return e.push(u.data),i*o<u.data.totalHits?(i++,s.paginateServices(e,t,n,a,r,i,o,l)):e}))},e.prototype.fetchServiceMetrics=function(e,t){if(!e||!e.metric||!e.metric.key)return Promise.resolve(f(e.refId));var n=S(t);e.timeInterval||(e.timeInterval=O(n));var a={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},r={timeFrame:{to:t.to,windowSize:n},metrics:[a]};return e.entity&&e.entity.key&&(r.applicationId=e.entity.key,r.applicationBoundaryScope=e.applicationBoundaryScope),e.service&&e.service.key&&(r.serviceId=e.service.key),h(this.instanaOptions,"/api/application-monitoring/metrics/services?fillTimeSeries=true",r)},e.prototype.buildServiceMetricLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=A.a.replace(r,"$label",t.service.label),r=A.a.replace(r,"$service",e.service.label),r=A.a.replace(r,"$application",e.entity.label),r=A.a.replace(r,"$metric",e.metric.label),r=A.a.replace(r,"$key",n),r=A.a.replace(r,"$index",a+1+""),r=A.a.replace(r,"$timeShift",e.timeShift)}return null===e.service.key?e.timeShift?t.service.label+" - "+n+" - "+e.timeShift:t.service.label+" - "+n:e.timeShift&&e.timeShiftIsValid?t.service.label+" ("+e.service.label+") - "+n+" - "+e.timeShift:t.service.label+" ("+e.service.label+") - "+n},e}(),H=function(){function e(e){this.instanaOptions=e,this.endpointsCache=new k}return e.prototype.getEndpointsOfService=function(e,t){var n="";e.entity&&e.entity.key&&(n=e.entity.key);var a="";e.service&&(a=e.service.key);var r=C(t)+n+a+e.applicationBoundaryScope,i=this.endpointsCache.get(r);if(i)return i;var o=S(t);return i=this.paginateEndpoints([],n,a,o,e.applicationBoundaryScope,t.to,1,200,15).then((function(e){var t=A.a.flattenDeep(A.a.map(e,(function(e){return e.items})));return A.a.orderBy(A.a.compact(t).map((function(e){return{key:e.id,label:e.label}})),[function(e){return e.label.toLowerCase()}],["asc"])})),this.endpointsCache.put(r,i,6e5),i},e.prototype.paginateEndpoints=function(e,t,n,a,r,i,o,l,s){var u=this;if(o>s)return e;var c="windowSize="+a+"&to="+i+"&page="+o+"&pageSize="+l;"ALL"!==r&&"INBOUND"!==r||(c+="&applicationBoundaryScope="+r);var p="/api/application-monitoring/applications;id="+(t||"")+"/services;id="+(n||"")+"/endpoints?"+c;return y(this.instanaOptions,p).then((function(c){return e.push(c.data),o*l<c.data.totalHits?(o++,u.paginateEndpoints(e,t,n,a,r,i,o,l,s)):e}))},e.prototype.fetchEndpointMetrics=function(e,t){if(!e||!e.metric||!e.metric.key)return Promise.resolve(f(e.refId));var n=S(t),a={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM"};e.timeInterval||(e.timeInterval=O(n)),a.granularity=e.timeInterval.key;var r={endpointId:e.endpoint.key,timeFrame:{to:t.to,windowSize:n},metrics:[a]};return e.entity&&e.entity.key&&(r.applicationId=e.entity.key,r.applicationBoundaryScope=e.applicationBoundaryScope),e.service&&e.service.key&&(r.serviceId=e.service.key),h(this.instanaOptions,"/api/application-monitoring/metrics/endpoints?fillTimeSeries=true",r)},e.prototype.buildEndpointMetricLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=A.a.replace(r,"$label",t.endpoint.label),r=A.a.replace(r,"$endpoint",e.endpoint.label),r=A.a.replace(r,"$service",e.service.label),r=A.a.replace(r,"$application",e.entity.label),r=A.a.replace(r,"$metric",e.metric.label),r=A.a.replace(r,"$key",n),r=A.a.replace(r,"$index",""+a+1),r=A.a.replace(r,"$timeShift",e.timeShift)}return e.endpoint.label===v?e.timeShift?t.endpoint.label+" - "+n+" - "+e.timeShift:t.endpoint.label+" - "+n:e.timeShift&&e.timeShiftIsValid?t.endpoint.label+" ("+e.endpoint.label+") - "+n+" - "+e.timeShift:t.endpoint.label+" ("+e.endpoint.label+") - "+n},e}(),Y=function(e){e.entityType&&"string"==typeof e.entityType&&(e.entityType={key:e.entityType,label:e.entityType}),e.filter&&""!==e.filter&&(e.customFilters||(e.customFilters=[],e.customFilters.push({value:e.filter}))),e.timeInterval&&(e.timeInterval.value?e.timeInterval={key:e.timeInterval.value,label:e.timeInterval.label}:e.timeInterval.rollup&&(e.timeInterval={key:e.timeInterval.rollup,label:e.timeInterval.label})),"5"===e.metricCategory&&(e.metricCategory="4",e.service={},e.service.key=e.entity.key,e.service.label=e.entity.label,e.selectedApplication&&e.selectedApplication.key?(e.entity.key=e.selectedApplication.key,e.entity.label=e.selectedApplication.label):(e.entity.key=null,e.entity.label="Test")),"6"===e.metricCategory&&(e.metricCategory="4",e.endpoint={},e.endpoint.key=e.entity.key,e.selectedApplication&&e.selectedApplication.key?(e.entity.key=e.selectedApplication.key,e.entity.label=e.selectedApplication.label):(e.entity.key=null,e.entity.label="Test")),e.aggregation&&"string"==typeof e.aggregation&&(e.aggregation?e.aggregation={key:e.aggregation,label:e.aggregation}:e.aggregation={},e.aggregationFunction?e.aggregationFunction={key:e.aggregationFunction.label,label:e.aggregationFunction.label}:e.aggregationFunction={}),e.customFilters&&e.customFilters.length>0&&e.customFilters[0].value&&(e.customFilters=A.a.map(e.customFilters,(function(e){return e.value}))),e.filters&&e.filters.length>0&&!e.filters[0].tag.key&&!e.filters[0].tag.label&&A.a.forEach(e.filters,(function(e){e.tag.label=e.tag.key})),e.group&&e.group.key&&!e.group.label&&(e.group.label=e.group.key),e.metricCategory&&"string"==typeof e.metricCategory&&(e.metricCategory=A.a.find(M,(function(t){return t.key===parseInt(e.metricCategory,10)}))),e.callToEntity&&e.callToEntity.key&&(e.callToEntity=e.callToEntity.key),e.applicationCallToEntity&&e.applicationCallToEntity.key&&(e.applicationCallToEntity=e.applicationCallToEntity.key),e.filters&&e.filters.length>0&&e.filters.forEach((function(e){e.entity&&e.entity.key&&(e.entity=e.entity.key)}))},Z=function(e){function t(t){var n=e.call(this,t)||this;return n.options=t.jsonData,n.options.url=function(e){return e.jsonData.useProxy?e.url+"/instana":e.jsonData.url}(t),n.availableGranularities=[],n.availableRollups=[],n.availableTimeIntervals=[],n.dataSourceSlo=new I(t.jsonData),n.dataSourceInfrastructure=new Q(t.jsonData),n.dataSourceWebsite=new z(t.jsonData),n.dataSourceApplication=new K(t.jsonData),n.dataSourceService=new j(t.jsonData),n.dataSourceEndpoint=new H(t.jsonData),n.resultCache=new k,n}return i(t,e),t.prototype.query=function(e){return s(this,void 0,Promise,(function(){var t,n=this;return u(this,(function(a){return t=e.range,this.timeFilter=b(t),this.availableRollups=N(this.timeFilter),this.availableGranularities=F(this.timeFilter.windowSize),[2,Promise.all(e.targets.map((function(e){var a,r,i=b(t);if(e.hide)return{data:[],target:e};if(Y(e),e.metricCategory||(e.metricCategory=M[0]),n.setPossibleTimeIntervals(e),n.availableTimeIntervals.find((function(t){return t.key===e.timeInterval.key}))||(e.timeInterval=n.getDefaultTimeInterval(e)),Y(e),e.timeShift){var o=n.convertTimeShiftToMillis(e.timeShift);o&&(i=n.applyTimeShiftOnTimeFilter(i,o))}return e.timeFilter=i,e.stableHash=(a=e,r=A.a.omit(a,$),r=A.a.mapValues(r,(function(e){return null!=e&&"object"===_(e)&&"key"in e&&(e=e.key),e})),JSON.stringify(r)),i=n.adjustTimeFilterIfCached(i,e),7===e.metricCategory.key?n.dataSourceSlo.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):0===e.metricCategory.key||1===e.metricCategory.key?n.dataSourceInfrastructure.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):3===e.metricCategory.key?n.dataSourceWebsite.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):2===e.metricCategory.key?n.dataSourceApplication.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):4===e.metricCategory.key?n.getApplicationServiceEndpointMetrics(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):Promise.resolve(f(e.refId))}))).then((function(e){var t=[];return A.a.each(e,(function(e){var a=A.a.compact(A.a.flatten(e.data));n.applyTimeShiftIfNecessary(a,e.target),a=n.aggregateDataIfNecessary(a,e.target),n.cacheResultIfNecessary(a,e.target),t.push(a)})),{data:A.a.flatten(t)}}))]}))}))},t.prototype.getApplicationServiceEndpointMetrics=function(e,t){var n=this;if(R(t.windowSize,T(this.options.queryinterval_limit_app_metrics)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.options.queryinterval_limit_app_metrics+" hours");return e.endpoint&&e.endpoint.key?this.dataSourceEndpoint.fetchEndpointMetrics(e,t).then((function(t){return W(e,t,n.dataSourceEndpoint.buildEndpointMetricLabel)})):e.service&&e.service.key?this.dataSourceService.fetchServiceMetrics(e,t).then((function(t){return W(e,t,n.dataSourceService.buildServiceMetricLabel)})):e.entity&&e.entity.key?this.dataSourceApplication.fetchApplicationMetrics(e,t).then((function(t){return t.data&&(e.showWarningCantShowAllResults=t.data.canLoadMore),W(e,t,n.dataSourceApplication.buildApplicationMetricLabel)})):Promise.resolve({data:{items:[]}})},t.prototype.applyTimeShiftIfNecessary=function(e,t){var n=this;e.forEach((function(e){t.timeShift&&n.applyTimeShiftOnData(e,n.convertTimeShiftToMillis(t.timeShift))}))},t.prototype.cacheResultIfNecessary=function(e,t){if(this.supportsDeltaRequests(t)&&this.hasResult(e)){var n={timeFilter:t.timeFilter,results:e};this.resultCache.put(t.stableHash,n,4e6)}},t.prototype.supportsDeltaRequests=function(e){var t=this;if(e.metricCategory&&7===e.metricCategory.key)return!1;var n=this.resultCache.get("version");return n?n>=171:D(this.options).then((function(e){return t.resultCache.put("version",e,4e6),e>=171}))},t.prototype.hasResult=function(e){return e&&e.length>0},t.prototype.applyTimeShiftOnData=function(e,t){e.datapoints.forEach((function(e){e[1]=e[1]+t}))},t.prototype.aggregateDataIfNecessary=function(e,t){var n=[];if(t.aggregateGraphs){var a=B(e,t);return n.push(a),t.hideOriginalGraphs||A.a.each(e,(function(e){e.target!==a.target&&n.push(e)})),n}return e},t.prototype.buildTargetWithAppendedDataResult=function(e,t,n){return t.from!==e.timeFilter.from&&n&&(n=this.appendResult(n,e)),{target:e,data:n}},t.prototype.appendResult=function(e,t){var n,a,r=this.resultCache.get(t.stableHash);return r&&r.results&&(n=e,a=r.results,A.a.each(n,(function(e){var t=A.a.find(a,(function(t){return t.key===e.key&&t.target===e.target}));if(t&&e.datapoints){var n=t.datapoints.length,r=e.datapoints.concat(t.datapoints);r=A.a.sortedUniqBy(r.sort((function(e,t){return e[1]-t[1]})),(function(e){return e[1]})),t.datapoints=A.a.takeRight(r,n),t.target=e.target}else a.push(e)})),e=a),e},t.prototype.adjustTimeFilterIfCached=function(e,t){var n,a,r=this.resultCache.get(t.stableHash);if(r&&(n=e,a=r.timeFilter,n.from<a.to&&n.from>=a.from)){var i=this.getDeltaRequestTimestamp(r.results,r.timeFilter.from),o=1e4*Math.floor(e.to/1e4);return{from:i,to:o,windowSize:o-i}}return e},t.prototype.getDeltaRequestTimestamp=function(e,t){var n=e[0].datapoints.length;if(0===n)return t;var a=n>1?n-2:1;return e[0].datapoints[a][1]},t.prototype.getSloReports=function(){return this.dataSourceSlo.getConfiguredSLIs()},t.prototype.getEntityTypes=function(){return this.dataSourceInfrastructure.getEntityTypes()},t.prototype.fetchApplications=function(){return this.dataSourceApplication.getApplications(this.getTimeFilter())},t.prototype.fetchServices=function(e){return this.dataSourceService.getServicesOfApplication(e,this.getTimeFilter())},t.prototype.fetchEndpoints=function(e){return this.dataSourceEndpoint.getEndpointsOfService(e,this.getTimeFilter())},t.prototype.fetchTypesForTarget=function(e){return this.dataSourceInfrastructure.fetchTypesForTarget(e,this.getTimeFilter())},t.prototype.fetchWebsites=function(){return this.dataSourceWebsite.getWebsites(this.getTimeFilter())},t.prototype.getDefaultTimeInterval=function(e){return 0===e.metricCategory.key||1===e.metricCategory.key?x(this.getTimeFilter()):O(this.getTimeFilter().windowSize)},t.prototype.convertTimeShiftToMillis=function(e){if(!e)return null;try{return this.parseTimeShift(e)}catch(e){return null}},t.prototype.parseTimeShift=function(e){return e.endsWith("s")?1e3*parseInt(e.split("s")[0],10):e.endsWith("m")?60*parseInt(e.split("m")[0],10)*1e3:e.endsWith("h")?60*parseInt(e.split("h")[0],10)*60*1e3:e.endsWith("d")?60*parseInt(e.split("d")[0],10)*60*24*1e3:e.endsWith("w")?60*parseInt(e.split("w")[0],10)*60*24*7*1e3:null},t.prototype.applyTimeShiftOnTimeFilter=function(e,t){return t?{from:e.from-t,to:e.to-t,windowSize:e.windowSize}:e},t.prototype.setPossibleTimeIntervals=function(e){0===e.metricCategory.key||1===e.metricCategory.key?this.availableTimeIntervals=this.availableRollups:this.availableTimeIntervals=this.availableGranularities},t.prototype.getTimeFilter=function(){if(!this.timeFilter||!this.timeFilter.from){var e=1e3*Math.floor(Date.now()/1e3);this.timeFilter={from:e-216e5,to:e,windowSize:216e5}}return this.timeFilter},t.prototype.testDatasource=function(){return y(this.options,"/api/monitoringState").then((function(){return{status:"success",message:"Successfully connected to the Instana API.",title:"Success"}}),(function(e){return 401===e.status?{status:"error",message:"Unauthorized. Please verify the API Token.",title:"Error"}:(console.log(e),{status:"error",message:"Error ("+e.status+") connecting to the Instana API: "+e.statusText,title:"Error"})}))},t}(a.DataSourceApi),J=n(0),X=n.n(J),ee=n(2),te=function(){var e=A.a.get(window,["grafanaBootData","settings","buildInfo","version"],"3.0.0"),t=A.a.split(e,".",2).map((function(e){return parseInt(e,10)}));return e[0]>=6||t[0]>=5&&t[1]>=3},ne=function(e){function t(t){var n=e.call(this,t)||this;n.onInstanaOptionsChange=function(e,t){var a,r=n.props,i=r.options,l=r.onOptionsChange,s=o(o({},i.jsonData),((a={})[t]=e.currentTarget.value,a));l(o(o({},i),{jsonData:s})),"url"!==t&&"apiToken"!==t||n.debouncedDetectFeatures(i)},n.onSwitchChange=function(e,t){var a,r=n.props,i=r.options,l=r.onOptionsChange,s=!1;e&&e.currentTarget&&(s=!i.jsonData[t]);var u=o(o({},i.jsonData),((a={})[t]=s,a));l(o(o({},i),{jsonData:u}))},n.debouncedDetectFeatures=function(e){A.a.debounce((function(){return n.detectFeatures(e)}),500)},n.detectFeatures=function(e){e||(e=n.props.options),e.id&&(n.setState({canUseProxy:te()}),D(e.jsonData).then((function(e){e?n.setState({canQueryOfflineSnapshots:e>=156}):n.setState({canQueryOfflineSnapshots:!1})})))},n.state={canQueryOfflineSnapshots:!1,canUseProxy:!1},n.detectFeatures();var a=n.props.options.jsonData;return void 0===a.useProxy&&(a.useProxy=te()),n}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.options.jsonData;return X.a.createElement("div",null,X.a.createElement(ee.Legend,null,"Instana configuration"),X.a.createElement(ee.Field,{className:"width-30",horizontal:!0,required:!0,label:"URL",description:"The URL of your Instana installation."},X.a.createElement(ee.Input,{css:"",width:30,value:t.url,placeholder:"https://tools-acme.instana.io",onChange:function(t){return e.onInstanaOptionsChange(t,"url")}})),X.a.createElement(ee.Field,{className:"width-30",horizontal:!0,required:!0,label:"API Token",description:"The API token to access the data."},X.a.createElement(ee.Input,{type:"password",css:"",width:30,value:t.apiToken,suffix:X.a.createElement(ee.Tooltip,{content:X.a.createElement("p",null,"You can create API tokens following the instructions atÂ ",X.a.createElement("a",{href:"https://docs.instana.io/quick_start/api/#api-tokens"},"https://docs.instana.io/quick_start/api/#api-tokens")),theme:"info"},X.a.createElement(ee.Icon,{name:"info-circle"})),onChange:function(t){return e.onInstanaOptionsChange(t,"apiToken")}})),X.a.createElement(ee.Checkbox,{css:"",label:"Use Proxy",value:t.useProxy,onChange:function(t){return e.onSwitchChange(t,"useProxy")},description:"Use Grafana server as proxy. Needs Grafana 5.3+ and Instana datasource 2.0.0+"}),X.a.createElement(ee.Checkbox,{css:"",label:"Enable offline snapshots",value:t.showOffline,onChange:function(t){return e.onSwitchChange(t,"showOffline")},description:"Enables querying offline snapshots. Needs Instana release 156+ and Instana datasource 2.3.0+"}),X.a.createElement(ee.Checkbox,{css:"",label:"Enable SLO dashboards",value:t.allowSlo,onChange:function(t){return e.onSwitchChange(t,"allowSlo")},description:"Adds a new category that allows retrieval of SLO information. Needs Instana release 176+ and an explicit feature flag."}),X.a.createElement("br",null),X.a.createElement("br",null),X.a.createElement("b",null,"Maximum query intervals in hours"),X.a.createElement("p",{className:"width-30"},"This settings are optional values to control the load of data queries, by defining the maximum allowed query intervals against the Instana API."),X.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Infrastructure metrics"},X.a.createElement(ee.Input,{css:"",width:30,value:t.queryinterval_limit_infra,placeholder:"optional: interval limit in hours",onChange:function(t){return e.onInstanaOptionsChange(t,"queryinterval_limit_infra")}})),X.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Application metrics"},X.a.createElement(ee.Input,{css:"",width:30,value:t.queryinterval_limit_app_metrics,placeholder:"optional: interval limit in hours",onChange:function(t){return e.onInstanaOptionsChange(t,"queryinterval_limit_app_metrics")}})),X.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Analyze application calls"},X.a.createElement(ee.Input,{css:"",width:30,value:t.queryinterval_limit_app_calls,placeholder:"optional: interval limit in hours",onChange:function(t){return e.onInstanaOptionsChange(t,"queryinterval_limit_app_calls")}})),X.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Analyze website"},X.a.createElement(ee.Input,{css:"",width:30,value:t.queryinterval_limit_website_metrics,placeholder:"optional: interval limit in hours",onChange:function(t){return e.onInstanaOptionsChange(t,"queryinterval_limit_website_metrics")}})))},t}(J.PureComponent),ae={position:"relative",background:"transparent",width:"32px",height:"32px",marginRight:"4px"},re={transition:"max-height .2s ease-out",maxHeight:0,overflow:"hidden",zIndex:1,position:"fixed"},ie={overflow:"hidden",zIndex:2,position:"fixed",maxHeight:"1000px",opacity:1},oe={display:"inline-flex"},le={display:"flex",alignItems:"center",justifyContent:"center"},se={padding:"7px"},ue=X.a.createElement("svg",{style:le,height:30,width:30},X.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M12.7891666,14.6051302 L12.7751756,19.8293818 L11.4691127,19.8328795 L11.4776628,16.6402814 L6.96695389,21.1509902 L6.2433066,20.427343 L10.7540155,15.9166341 L7.56141732,15.9251842 L7.56491507,14.6191213 L12.7891666,14.6051302 Z M15.754133,9.38135895 C17.1795716,9.38135895 18.3857119,10.5874993 18.3857119,12.0129379 C18.3857119,13.4383765 17.1795716,14.6445168 15.754133,14.6445168 C14.3286944,14.6445168 13.122554,13.4383765 13.122554,12.0129379 C13.122554,10.5874993 14.3286944,9.38135895 15.754133,9.38135895 Z M6.96695389,3.2433066 L11.4776628,7.75401547 L11.4691127,4.56141732 L12.7751756,4.56491507 L12.7891666,9.7891666 L7.56491507,9.77517557 L7.56141732,8.46911269 L10.7540155,8.47766276 L6.2433066,3.96695389 L6.96695389,3.2433066 Z"})),ce=X.a.createElement("svg",{style:le,height:30,width:30},X.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M7.54586,15 L7.53186897,20.2242515 L6.22580608,20.2277493 L6.23435616,17.0351511 L1.72364729,21.54586 L1,20.8222127 L5.51070887,16.3115038 L2.31811071,16.3200539 L2.32160847,15.013991 L7.54586,15 Z M14.1975552,7.94441147 L17.901552,11.628622 L14.1975552,15.3128325 L13.271556,14.3917799 L15.5351096,12.1403179 L12.4724561,12.1407167 C12.2827518,13.474447 11.1361413,14.5 9.75,14.5 C8.23121694,14.5 7,13.2687831 7,11.75 C7,10.2312169 8.23121694,9 9.75,9 C11.0508538,9 12.1407461,9.90323356 12.4267385,11.1167623 L15.5351096,11.1169261 L13.271556,8.8654641 L14.1975552,7.94441147 Z M20.75,9 C22.2687831,9 23.5,10.2312169 23.5,11.75 C23.5,13.2687831 22.2687831,14.5 20.75,14.5 C19.2312169,14.5 18,13.2687831 18,11.75 C18,10.2312169 19.2312169,9 20.75,9 Z M1.72364729,2 L6.23435616,6.51070887 L6.22580608,3.31811071 L7.53186897,3.32160847 L7.54586,8.54586 L2.32160847,8.53186897 L2.31811071,7.22580608 L5.51070887,7.23435616 L1,2.72364729 L1.72364729,2 Z"}));function pe(e){var t=Object(ee.useTheme)(),n=e.disabled?.5:1,a={background:t.colors.bg2,cursor:"pointer",listStyle:"none",borderRadius:"3px",height:"32px",opacity:n},r=c(Object(J.useState)(!1),2),i=r[0],o=r[1];function l(t){e.onChange(t),o(!1)}return X.a.createElement("div",{style:ae},X.a.createElement("div",{onClick:function(){e.disabled||o(!i)},onBlur:function(){return o(!1)},style:a,contentEditable:!0},X.a.createElement(ee.Tooltip,{content:e.value?e.value:"ALL",theme:"info",placement:"top"},"INBOUND"===e.value?ue:ce)),X.a.createElement("ul",{style:i?ie:re},X.a.createElement("li",{onClick:function(){return l("INBOUND")},key:"INBOUND",style:a},X.a.createElement("div",{style:oe},ue," ",X.a.createElement("span",{style:se},"INBOUND"))),X.a.createElement("li",{onClick:function(){return l("ALL")},key:"ALL",style:a},X.a.createElement("div",{style:oe},ce," ",X.a.createElement("span",{style:se},"ALL")))))}var ye=!1,he=function(e){function t(t){var n=e.call(this,t)||this;return n.onApplicationChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,""!==e.boundaryScope?a.applicationBoundaryScope=e.boundaryScope:"ALL"!==a.applicationBoundaryScope&&"INBOUND"!==a.applicationBoundaryScope&&(a.applicationBoundaryScope="INBOUND"),r(a),n.loadServices(),n.loadEndpoints(),i()},n.onServiceChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.service=e,r(a),n.loadEndpoints(),i()},n.onEndpointChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.endpoint=e,r(a),i()},n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.onApplicationBoundaryScopeChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.applicationBoundaryScope=e,r(a),n.loadServices(),n.loadEndpoints(),i()},n.state={applications:[],services:[],endpoints:[],value:{value:2,imgUrl:"../../resources/dest.png"}},n}return i(t,e),t.prototype.componentDidMount=function(){ye=!1,this.loadApplications(),this.loadServices(),this.loadEndpoints();var e=this.props.datasource;this.props.updateMetrics(e.dataSourceApplication.getApplicationMetricsCatalog())},t.prototype.componentWillUnmount=function(){ye=!0},t.prototype.loadApplications=function(){var e=this,t=this.props,n=t.query,a=t.onChange;t.datasource.fetchApplications().then((function(t){if(!ye){if(e.setState({applications:t}),!A.a.find(e.state.applications,{key:null})){var r=e.state.applications;r.unshift({key:null,label:g}),e.setState({applications:r})}n.entity&&n.entity.key&&!A.a.find(e.state.applications,(function(e){return e.key===n.entity.key}))?n.entity=e.state.applications[0]:n.entity&&n.entity.key||!t||(n.entity=e.state.applications[0]),a(n)}}))},t.prototype.loadServices=function(){var e=this,t=this.props,n=t.query,a=t.onChange;t.datasource.fetchServices(n).then((function(t){if(!ye){if(e.setState({services:t}),!A.a.find(e.state.services,{key:null})){var r=e.state.services;r.unshift({key:null,label:"-- No Service Filter --"}),e.setState({services:r})}n.service&&n.service.key&&A.a.find(e.state.services,(function(e){return e.key===n.service.key}))||(n.service=e.state.services[0]),a(n)}}))},t.prototype.loadEndpoints=function(){var e=this,t=this.props,n=t.query,a=t.onChange;t.datasource.fetchEndpoints(n).then((function(t){if(!ye){if(e.setState({endpoints:t}),!A.a.find(e.state.endpoints,{key:null})){var r=e.state.endpoints;r.unshift({key:null,label:v}),e.setState({endpoints:r})}n.endpoint&&n.endpoint.key&&A.a.find(e.state.endpoints,(function(e){return e.key===n.endpoint.key}))||(n.endpoint={key:null,label:v}),a(n)}}))},t.prototype.render=function(){var e=this.props.query;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Select your application."},"Application"),X.a.createElement(pe,{value:e.applicationBoundaryScope,disabled:!e.entity.key,onChange:this.onApplicationBoundaryScopeChange}),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:e.entity,options:this.state.applications,onChange:this.onApplicationChange}),X.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:6,tooltip:"Select your service."},"Service"),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:e.service,options:this.state.services,onChange:this.onServiceChange}),X.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:6,tooltip:"Select your endpoint."},"Endpoint"),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:e.endpoint,options:this.state.endpoints,onChange:this.onEndpointChange}),X.a.createElement("div",{style:e.showGroupBySecondLevel?{}:{display:"none"}},X.a.createElement(ee.Input,{css:"",value:e.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(X.a.Component),de=["DESTINATION","SOURCE"];function fe(e){var t={display:"flex"};return e.disabled&&(t.opacity="0.4",t.pointerEvents="none"),e.stretch&&(t.width="100%"),X.a.createElement("div",{style:t},e.children)}var me={position:"relative",background:"transparent",width:"32px",height:"32px",marginRight:"4px"},ge={transition:"max-height .2s ease-out",maxHeight:0,overflow:"hidden",zIndex:1,position:"fixed"},ve={overflow:"hidden",zIndex:2,position:"fixed",maxHeight:"1000px",opacity:1},be={display:"inline-flex"},Se={display:"flex",alignItems:"center",justifyContent:"center"},Ce={padding:"7px"},Ee=X.a.createElement("svg",{style:Se,height:30,width:30},X.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M4 11.173h6.38L8.115 8.92 9.042 8l3.704 3.684-3.704 3.684-.926-.92 2.263-2.252H4zM16.43 14.316c-1.426 0-2.632-1.206-2.632-2.632 0-1.425 1.206-2.631 2.632-2.631 1.425 0 2.631 1.206 2.631 2.631 0 1.426-1.206 2.632-2.631 2.632z"})),Te=X.a.createElement("svg",{style:Se,height:30,width:30},X.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M9.939 11.173h6.379L14.054 8.92 14.98 8l3.704 3.684-3.704 3.684-.926-.92 2.264-2.252h-6.38c-.308 1.023-1.234 1.842-2.366 1.842C6.132 14.243 5 13.117 5 11.787c0-1.33 1.132-2.457 2.47-2.457 1.234 0 2.16.717 2.469 1.843z"}));function ke(e){var t={background:Object(ee.useTheme)().colors.bg2,cursor:"pointer",listStyle:"none",borderRadius:"3px",height:"32px"},n=c(Object(J.useState)(!1),2),a=n[0],r=n[1];function i(t){e.onChange(t),r(!1)}return X.a.createElement("div",{style:me},X.a.createElement("div",{onClick:function(){r(!a)},onBlur:function(){return r(!1)},style:t,contentEditable:!0},X.a.createElement(ee.Tooltip,{content:e.value,theme:"info",placement:"top"},"DESTINATION"===e.value?Ee:Te)),X.a.createElement("ul",{style:a?ve:ge},X.a.createElement("li",{onClick:function(){return i("DESTINATION")},key:"DESTINATION",style:t},X.a.createElement("div",{style:be},Ee," ",X.a.createElement("span",{style:Ce},"DESTINATION"))),X.a.createElement("li",{onClick:function(){return i("SOURCE")},key:"SOURCE",style:t},X.a.createElement("div",{style:be},Te," ",X.a.createElement("span",{style:Ce},"SOURCE")))))}n(7);var we=!1,Ae=function(e){function t(t){var n=e.call(this,t)||this;return n.onApplicationChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,r(a),i()},n.onGroupChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.group=e,a.group&&2===a.metricCategory.key&&(a.showGroupBySecondLevel="KEY_VALUE_PAIR"===a.group.type),a.showGroupBySecondLevel||(a.groupbyTagSecondLevelKey=""),r(a),i()},n.onApplicationCallToEntityChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.applicationCallToEntity=e,r(a),i()},n.onCallToEntityChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.callToEntity=e,r(a),i()},n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.state={applications:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.datasource,r=t.onChange;we=!1,a.fetchApplications().then((function(t){we||(A.a.find(t,{key:null})||t.unshift({key:null,label:g}),e.setState({applications:t}),n.entity&&(n.entity.key||n.entity.label)||(n.entity=t[0]),n.callToEntity||(n.callToEntity=de[0]),n.applicationCallToEntity||(n.applicationCallToEntity=de[0]),r(n))})),a.dataSourceApplication.getApplicationTags().then((function(t){we||(e.props.updateGroups(A.a.sortBy(t,"key")),n.group&&n.group.key||(n.group=A.a.find(t,["key","endpoint.name"]),r(n)))})),this.props.updateMetrics(a.dataSourceApplication.getApplicationMetricsCatalog())},t.prototype.componentWillUnmount=function(){we=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.groups;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(fe,{stretch:!0},X.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Select your application."},"Application"),X.a.createElement(ke,{value:t.applicationCallToEntity,onChange:this.onApplicationCallToEntityChange}),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:t.entity,options:this.state.applications,onChange:this.onApplicationChange})),X.a.createElement(fe,{stretch:!0},X.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:7,tooltip:"Group by tag."},"Group by"),X.a.createElement(ke,{value:t.callToEntity,onChange:this.onCallToEntityChange}),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,options:n,value:t.group,onChange:this.onGroupChange})),X.a.createElement("div",{style:t.showGroupBySecondLevel?{}:{display:"none"}},X.a.createElement(ee.Input,{css:"",type:"text",value:t.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(X.a.Component),Ie=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.queryKeyword,r=e.disabled,i=e.labelWidth,s=void 0===i?14:i,u=e.inputWidth,c=void 0===u?30:u,p=l(e,["label","tooltip","queryKeyword","disabled","labelWidth","inputWidth"]);return X.a.createElement(fe,{disabled:r,stretch:!c},X.a.createElement(ee.InlineFormLabel,{className:a?"query-keyword":"",width:s,tooltip:n},t),X.a.createElement(ee.Input,o({css:"",width:c,disabled:r},p)))},t}(X.a.Component),Me=function(e){function t(t){var n=e.call(this,t)||this;return n.onFilterChange=function(e,t){var a=n.state.customFilters;a[t]=e.currentTarget.value,n.setState({customFilters:a}),n.props.onFilterChange(a)},n.addCustomFilter=function(){var e=n.state.customFilters;e.push(""),n.setState({customFilters:e});var t=n.props,a=t.query,r=t.onChange;a.customFilters=e,r(a)},n.removeCustomFilter=function(e){var t=n.state.customFilters;t.splice(e,1),n.setState({customFilters:t}),n.props.onFilterChange(t)},n.state={customFilters:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props.query;this.setState({customFilters:e.customFilters})},t.prototype.render=function(){var e=this,t=this.state.customFilters.map((function(t,n){return X.a.createElement("div",{className:"gf-form"},X.a.createElement(Ie,{label:n+1+". filter metric select",value:e.state.customFilters[n],placeholder:"Please specify",onChange:function(t){return e.onFilterChange(t,n)},tooltip:"Type to suggest metrics."}),X.a.createElement(ee.Button,{variant:"secondary",onClick:function(){return e.removeCustomFilter(n)}},"-"))}));return X.a.createElement("div",null,t,X.a.createElement("div",{className:"gf-form"},X.a.createElement(ee.InlineFormLabel,{width:14,tooltip:"Add an additional metric select filter."},"Add filter metric select"),X.a.createElement(ee.Button,{variant:"secondary",onClick:this.addCustomFilter},"+")))},t}(X.a.Component),Re=ee.LegacyForms.Switch,qe=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.queryKeyword,r=e.disabled,i=e.labelWidth,s=void 0===i?14:i,u=e.value,c=l(e,["label","tooltip","queryKeyword","disabled","labelWidth","value"]);return X.a.createElement(fe,{disabled:r,stretch:!1},X.a.createElement(ee.InlineFormLabel,{className:a?"query-keyword":"",width:s,tooltip:n},t),X.a.createElement(Re,o({checked:u,label:""},c)))},t}(X.a.Component),Le=function(e){function t(t){var n=e.call(this,t)||this;return n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onUseFreeTextMetricsChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.loadEntityTypes;e&&e.currentTarget&&(a.useFreeTextMetrics=e.currentTarget.checked,a.useFreeTextMetrics?(i(!1),a.metric={}):i(!0),r(a))},n.onFreeTextMetricsChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.freeTextMetrics=e.currentTarget.value,r(a),n.debouncedRunQuery()},n}return i(t,e),t.prototype.render=function(){var e=this.props.query;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(qe,{queryKeyword:!0,label:"Enable free text metrics",tooltip:"Specify comma separated metrics directly in this text field. Once this field has a value, selected metrics from above will be ignored. Enabled as soon as a query is entered. Max 4 metrics supported.",value:e.useFreeTextMetrics,onChange:this.onUseFreeTextMetricsChange,disabled:!1}),X.a.createElement(ee.Input,{css:"",width:0,disabled:!e.useFreeTextMetrics,value:e.freeTextMetrics,placeholder:"metric.one,metric.two,metric.three",onChange:this.onFreeTextMetricsChange}))},t}(X.a.Component),Oe=[{label:"SUM"},{label:"MEAN"},{label:"MIN"},{label:"MAX"}],Fe=function(e){function t(t){var n=e.call(this,t)||this;n.onAggregateGraphs=function(e){var t=n.props,a=t.query,r=t.onRunQuery;e&&e.currentTarget&&(a.aggregateGraphs=e.currentTarget.checked,r())},n.onHideOriginalGraph=function(e){var t=n.props,a=t.query,r=t.onRunQuery;e&&e.currentTarget&&(a.hideOriginalGraphs=e.currentTarget.checked,r())},n.onAggregationFunctionChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery;a.aggregationFunction=e,r()},n.state={showAdditionalSettings:!1,legendFormat:""};var a=n.props.query;return a.aggregationFunction||(a.aggregationFunction=Oe[0]),n}return i(t,e),t.prototype.render=function(){var e=this.props.query;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(qe,{queryKeyword:!0,label:"Aggregate query graphs",tooltip:"Aggregate all graphs of a query.",value:e.aggregateGraphs,onChange:this.onAggregateGraphs}),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:12,isSearchable:!0,options:Oe,value:e.aggregationFunction,disabled:!e.aggregateGraphs,onChange:this.onAggregationFunctionChange}),X.a.createElement(qe,{queryKeyword:!0,disabled:!e.aggregateGraphs,labelWidth:10,label:"Hide original graphs",tooltip:"Removes the original graphs resulted from the query and only shows the aggregated graph.",value:e.hideOriginalGraphs,onChange:this.onHideOriginalGraph}))},t}(X.a.Component),xe=["$label (on host $host)","$label (on host $host)","$label ($application) - $key","$label ($website) - $key","$label ($application) - $key","","",""],Ne=[X.a.createElement("div",null,"Default: $label (on host $host)",X.a.createElement("ul",null,X.a.createElement("li",null,"â¢ $label - entity label"),X.a.createElement("li",null,"â¢ $host - corresponding host"),X.a.createElement("li",null,"â¢ $pid - corresponding PID"),X.a.createElement("li",null,"â¢ $timeShift - corresponding timeShift"),X.a.createElement("li",null,"â¢ $metric - displayed metric"),X.a.createElement("li",null,"â¢ $type - entity type"),X.a.createElement("li",null,"â¢ $service - service label"),X.a.createElement("li",null,"â¢ $name - label alternative"),X.a.createElement("li",null,"â¢ $index - index in the list"))),X.a.createElement("div",null,"Default: $label (on host $host)",X.a.createElement("ul",null,X.a.createElement("li",null,"â¢ $label - entity label"),X.a.createElement("li",null,"â¢ $host - corresponding host"),X.a.createElement("li",null,"â¢ $pid - corresponding PID"),X.a.createElement("li",null,"â¢ $timeShift - corresponding timeShift"),X.a.createElement("li",null,"â¢ $metric - displayed metric"),X.a.createElement("li",null,"â¢ $type - entity type"),X.a.createElement("li",null,"â¢ $service - service label"),X.a.createElement("li",null,"â¢ $name - label alternative"),X.a.createElement("li",null,"â¢ $index - index in the list"))),X.a.createElement("div",null,"Default: $label ($application) - $key",X.a.createElement("ul",null,X.a.createElement("li",null,"â¢ $label - entity label"),X.a.createElement("li",null,"â¢ $application - application label"),X.a.createElement("li",null,"â¢ $timeShift - corresponding timeShift"),X.a.createElement("li",null,"â¢ $metric - displayed metric"),X.a.createElement("li",null,"â¢ $key - metric key with aggregation and rollup"),X.a.createElement("li",null,"â¢ $index - index in the list"))),X.a.createElement("div",null,"Default: $label ($website) - $key",X.a.createElement("ul",null,X.a.createElement("li",null,"â¢ $label - entity label"),X.a.createElement("li",null,"â¢ $website - application label"),X.a.createElement("li",null,"â¢ $type - entity type"),X.a.createElement("li",null,"â¢ $timeShift - corresponding timeShift"),X.a.createElement("li",null,"â¢ $metric - displayed metric"),X.a.createElement("li",null,"â¢ $key - metric key with aggregation and rollup"),X.a.createElement("li",null,"â¢ $index - index in the list"))),X.a.createElement("div",null,"Default: $label ($application) - $key",X.a.createElement("ul",null,X.a.createElement("li",null,"â¢ $label - entity label"),X.a.createElement("li",null,"â¢ $application - application label"),X.a.createElement("li",null,"â¢ $service - service label"),X.a.createElement("li",null,"â¢ $endpoint - endpoint label"),X.a.createElement("li",null,"â¢ $timeShift - corresponding timeShift"),X.a.createElement("li",null,"â¢ $metric - displayed metric"),X.a.createElement("li",null,"â¢ $key - metric key with aggregation and rollup"),X.a.createElement("li",null,"â¢ $index - index in the list"))),"","",""],Pe=function(e){function t(t){var n=e.call(this,t)||this;return n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onLegendFormatChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.labelFormat=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.onTimeShiftChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.timeShift=e.currentTarget.value,a.timeShift?a.timeShiftIsValid=!!a.timeShift.match(/\d+[m,s,h,d,w]{1}/):a.timeShiftIsValid=!0,r(a),a.timeShiftIsValid&&n.debouncedRunQuery()},n.onShowAdvancedSettingsChange=function(e){if(e&&e.currentTarget){var t=n.props,a=t.query,r=t.onChange;a.showAdvancedSettings=e.currentTarget.checked,r(a)}},n.state={legendFormatPlaceholder:n.setLegendFormatPlaceholder()},n}return i(t,e),t.prototype.setLegendFormatPlaceholder=function(){var e=this.props.query;return xe[e.metricCategory.key]},t.prototype.setLegendFormatTooltip=function(){var e=this.props.query;return Ne[e.metricCategory.key]},t.prototype.render=function(){var e=this,t=this.props,n=t.query,a=t.onRunQuery,r=t.onChange,i=t.loadEntityTypes;return X.a.createElement("div",null,X.a.createElement("div",{className:"gf-form"},X.a.createElement(qe,{label:"Show advanced settings",tooltip:"Show all additional settings",value:n.showAdvancedSettings,onChange:function(t){return e.onShowAdvancedSettingsChange(t)}})),X.a.createElement("div",{hidden:!n.showAdvancedSettings},X.a.createElement("div",{className:"gf-form",hidden:7===n.metricCategory.key},X.a.createElement(Ie,{queryKeyword:!0,inputWidth:0,label:"Legend format",tooltip:this.setLegendFormatTooltip(),value:n.labelFormat,placeholder:this.setLegendFormatPlaceholder(),onChange:function(t){return e.onLegendFormatChange(t)}})),X.a.createElement("div",{className:"gf-form"},X.a.createElement(Ie,{queryKeyword:!0,inputWidth:0,label:"Time shift",tooltip:"Specify the amount of hours that shall be used. The time shift function always go back in time, not forward. Accepts values such as 1s, 1m, 1h, 1d, 1w.",value:n.timeShift,invalid:!n.timeShiftIsValid,placeholder:"1h",onChange:function(t){return e.onTimeShiftChange(t)}})),X.a.createElement("div",{hidden:1!==n.metricCategory.key},X.a.createElement(Le,{query:n,onRunQuery:a,onChange:r,loadEntityTypes:i})),X.a.createElement("div",{hidden:0!==n.metricCategory.key&&1!==n.metricCategory.key},X.a.createElement(Fe,{query:n,onRunQuery:a,onChange:r}))))},t}(X.a.Component),Qe=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.searchable,r=void 0===a||a,i=e.disabled,s=e.queryKeyword,u=e.placeholder,c=void 0===u?"-":u,p=e.labelWidth,y=void 0===p?14:p,h=e.inputWidth,d=void 0===h?30:h,f=l(e,["label","tooltip","searchable","disabled","queryKeyword","placeholder","labelWidth","inputWidth"]);return X.a.createElement(fe,{disabled:i,stretch:!d},X.a.createElement(ee.InlineFormLabel,{className:s?"query-keyword":"",width:y,tooltip:n},t),X.a.createElement(ee.Select,o({menuPlacement:"bottom",disabled:i,width:d,isSearchable:r,placeholder:c},f)))},t}(X.a.Component),_e=function(e){function t(t){var n=e.call(this,t)||this;return n.onQueryChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.updateQueryTypes;e.currentTarget&&e.currentTarget.value?a.entityQuery=e.currentTarget.value:(i([]),a.entityQuery="",a.entityType={key:null,label:"-"}),r(a),n.debouncedEntityTypes()},n.onTypeChange=function(e){var t=n.props,a=t.query,r=t.datasource,i=t.onChange;a.entityType=e,i(a),r.dataSourceInfrastructure.getMetricsCatalog(a.entityType,a.metricCategory.key).then((function(e){n.props.updateMetrics(e)}))},n.debouncedEntityTypes=A.a.debounce(n.props.loadEntityTypes,500),n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.query,n=e.loadEntityTypes;t.entityQuery&&n()},t.prototype.render=function(){var e=this.props,t=e.query,n=e.queryTypes;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(Ie,{queryKeyword:!0,inputWidth:0,label:"Query",tooltip:X.a.createElement("div",null,"Specify a query for the entities you wish to plot. Use the dynamic focus syntax:",X.a.createElement("a",{href:"https://docs.instana.io/core_concepts/dynamic_focus/#syntax"},"https://docs.instana.io/core_concepts/dynamic_focus/#syntax")),value:t.entityQuery,placeholder:"Please specify",onChange:this.onQueryChange}),X.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Type",tooltip:"Select an entity type for a list of available metrics.",noOptionsMessage:"No types found with query",value:t.entityType,options:n,onChange:this.onTypeChange}))},t}(X.a.Component),$e=!1,Ue=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.onChange,r=t.datasource;$e=!1,n.entityQuery&&n.entityType&&n.entityType.key?r.dataSourceInfrastructure.getMetricsCatalog(n.entityType,n.metricCategory.key).then((function(t){$e||e.props.updateMetrics(t)})):n.metric={key:null,label:"-"},a(n)},t.prototype.componentWillUnmount=function(){$e=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.onRunQuery,a=e.onChange,r=e.updateMetrics,i=e.loadEntityTypes,o=e.datasource,l=e.queryTypes,s=e.updateQueryTypes;return X.a.createElement(_e,{query:t,onChange:a,queryTypes:l,onRunQuery:n,datasource:o,updateMetrics:r,loadEntityTypes:i,updateQueryTypes:s})},t}(X.a.Component),De=[{key:"SLI",label:"SLI"},{key:"Remaining Error Budget",label:"Remaining Error Budget"},{key:"Timeseries",label:"Timeseries"}],Be=!1,Ve=function(e){function t(t){var n=e.call(this,t)||this;return n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onSloChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery;a.sloReport=e,r()},n.onSloValueChange=function(e){var t=n.props.query;t.sloValue=e.currentTarget.value,n.isValid(t.sloValue)&&n.debouncedRunQuery()},n.onSloSpecificChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery;a.sloSpecific=e,r()},n.state={sloReports:[],isValidSlo:!0},n}return i(t,e),t.prototype.componentDidMount=function(){Be=!1,this.loadSloReports(),this.isValid(this.props.query.sloValue)},t.prototype.componentWillUnmount=function(){Be=!0},t.prototype.isValid=function(e){var t=!e||+e>=0&&+e<=.9999;return this.setState({isValidSlo:t}),t},t.prototype.shouldComponentUpdate=function(e,t,n){return 7===e.query.metricCategory.key},t.prototype.loadSloReports=function(){var e=this,t=this.props.query;this.props.datasource.getSloReports().then((function(n){Be||(e.setState({sloReports:n}),!t.sloReport&&n.length>=1&&(t.sloReport=n[0]))}))},t.prototype.render=function(){var e=this.props.query;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Configured SLI",tooltip:"SLI configuration used to compute error budget and SLI values.",noOptionsMessage:"No configured SLI found",value:e.sloReport,options:this.state.sloReports,onChange:this.onSloChange}),X.a.createElement(Ie,{queryKeyword:!0,labelWidth:7,inputWidth:0,label:"SLO",tooltip:"Type in your desired SLO threshold from 0 to 0.9999",value:e.sloValue,invalid:!this.state.isValidSlo,placeholder:"0.99",onChange:this.onSloValueChange}),X.a.createElement(Qe,{queryKeyword:!0,labelWidth:7,inputWidth:0,label:"Value type",tooltip:X.a.createElement("div",null,"Select your specific SLO information:",X.a.createElement("ul",null,X.a.createElement("li",null,"'SLI' requires Gauge visualization"),X.a.createElement("li",null,"'Remaining Error Budget' requires Singlestat visualization"),X.a.createElement("li",null,"'Timeseries' requires Bars draw mode on Graph visualization"))),value:e.sloSpecific,options:De,onChange:this.onSloSpecificChange}))},t}(X.a.Component),We=[{key:"pageLoad",label:"Page Loads"},{key:"page_change",label:"Page Transitions"},{key:"resourceLoad",label:"Resources"},{key:"httpRequest",label:"HTTP Requests"},{key:"error",label:"Errors"},{key:"custom",label:"Custom Events"}],ze=!1,Ge=function(e){function t(t){var n=e.call(this,t)||this;return n.onWebsiteChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,r(a),i()},n.onBeaconTypeChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.filterMetricsOnType;a.entityType=e,r(a),i(a.entityType.key)},n.onGroupChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.group=e,a.group&&3===a.metricCategory.key&&(a.showGroupBySecondLevel="KEY_VALUE_PAIR"===a.group.type),a.showGroupBySecondLevel||(a.groupbyTagSecondLevelKey=""),r(a),i()},n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.state={websites:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.datasource,r=t.onChange;ze=!1,a.fetchWebsites().then((function(t){ze||(e.setState({websites:t}),n.entity&&n.entity.key||!t?n.entity&&!A.a.find(t,["key",n.entity.key])&&(n.entity=t[0]):n.entity=t[0],r(n))})),a.dataSourceWebsite.getWebsiteTags().then((function(t){ze||(e.props.updateGroups(A.a.sortBy(t,"key")),n.group&&n.group.key||(n.group=A.a.find(t,["key","beacon.page.name"]),r(n)))})),n.entityType&&n.entityType.key||(n.entityType=We[0],r(n)),a.dataSourceWebsite.getWebsiteMetricsCatalog().then((function(t){ze||e.props.updateMetrics(A.a.filter(t,(function(e){return e.beaconTypes.includes(n.entityType.key)})))}))},t.prototype.componentWillUnmount=function(){ze=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.groups;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Website",tooltip:"Select your website.",noOptionsMessage:"No websites found",value:t.entity,options:this.state.websites,onChange:this.onWebsiteChange}),X.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Type",tooltip:"Select a beacon type.",value:t.entityType,options:We,onChange:this.onBeaconTypeChange}),X.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Group by",tooltip:"Group by tag.",value:t.group,options:n,onChange:this.onGroupChange}),X.a.createElement("div",{style:t.showGroupBySecondLevel?{}:{display:"none"}},X.a.createElement(ee.Input,{css:"",value:t.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(X.a.Component),Ke=[{key:"EQUALS",label:"equals",type:"STRING"},{key:"NOT_EQUAL",label:"does not equal",type:"STRING"},{key:"CONTAINS",label:"contains",type:"STRING"},{key:"NOT_CONTAIN",label:"does not contain",type:"STRING"},{key:"NOT_EMPTY",label:"is present",type:"STRING"},{key:"IS_EMPTY",label:"is not present",type:"STRING"},{key:"EQUALS",label:"=",type:"NUMBER"},{key:"NOT_EQUAL",label:"!=",type:"NUMBER"},{key:"LESS_THAN",label:"<",type:"NUMBER"},{key:"GREATER_THAN",label:">",type:"NUMBER"},{key:"IS_EMPTY",label:"is empty",type:"NUMBER"},{key:"EQUALS",label:"is",type:"BOOLEAN"},{key:"EQUALS",label:"equals",type:"KEY_VALUE_PAIR"},{key:"NOT_EQUAL",label:"does not equal",type:"KEY_VALUE_PAIR"},{key:"CONTAINS",label:"contains",type:"KEY_VALUE_PAIR"},{key:"NOT_CONTAIN",label:"does not contain",type:"KEY_VALUE_PAIR"},{key:"NOT_EMPTY",label:"is present",type:"KEY_VALUE_PAIR"},{key:"IS_EMPTY",label:"is not present",type:"KEY_VALUE_PAIR"}],je=function(e){function t(t){var n=e.call(this,t)||this;return n.OPERATOR_STRING="STRING",n.OPERATOR_NUMBER="NUMBER",n.OPERATOR_BOOLEAN="BOOLEAN",n.OPERATOR_KEY_VALUE="KEY_VALUE_PAIR",n.addTagFilter=function(){var e=n.props,t=e.query,a=e.onChange;t.filters.push({tag:t.group,entity:de[0],operator:n.filterOperatorsOnType(t.group.type)[0],booleanValue:!1,numberValue:0,stringValue:"",isValid:!1}),a(t)},n.removeTagFilter=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.filters.splice(e,1),r(a),i()},n.onCallToEntityChange=function(e,t){n.props.query.filters[t].entity=e,n.validateChangeAndRun(t)},n.onOperatorChange=function(e,t){n.props.query.filters[t].operator=e,n.validateChangeAndRun(t)},n.debouncedRunQuery=A.a.debounce(n.props.onRunQuery,500),n.onTagFilterStringValueChange=function(e,t){n.props.query.filters[t].stringValue=e.currentTarget.value,n.validateChangeAndRun(t,!0)},n.onTagFilterNumberValueChange=function(e,t){n.props.query.filters[t].numberValue=e.currentTarget.valueAsNumber,n.validateChangeAndRun(t,!0)},n}return i(t,e),t.prototype.filterOperatorsOnType=function(e){return A.a.filter(Ke,(function(t){return t.type===e}))},t.prototype.onGroupChange=function(e,t){var n=this.props.query;n.filters[t].tag=e;var a=this.filterOperatorsOnType(e.type);A.a.includes(a,n.filters[t].operator)||(n.filters[t].operator=a[0]),this.validateChangeAndRun(t)},t.prototype.canShowStringInput=function(e){return!e.operator.key.includes("EMPTY")&&("STRING"===e.tag.type||"KEY_VALUE_PAIR"===e.tag.type)},t.prototype.onTagFilterBooleanValueChange=function(e,t){this.props.query.filters[t].booleanValue=e.key,this.validateChangeAndRun(t)},t.prototype.validateChangeAndRun=function(e,t){void 0===t&&(t=!1);var n=this.props,a=n.query,r=n.onChange,i=n.onRunQuery;a.filters[e].tag?a.filters[e].operator.key.includes("EMPTY")?(a.filters[e].isValid=!0,a.filters[e].stringValue="",a.filters[e].numberValue=0,a.filters[e].booleanValue=!0):this.OPERATOR_STRING===a.filters[e].tag.type&&a.filters[e].stringValue||this.OPERATOR_KEY_VALUE===a.filters[e].tag.type&&a.filters[e].stringValue&&a.filters[e].stringValue.includes("=")||this.OPERATOR_NUMBER===a.filters[e].tag.type&&null!==a.filters[e].numberValue?a.filters[e].isValid=!0:a.filters[e].isValid=this.OPERATOR_BOOLEAN===a.filters[e].tag.type&&a.filters[e].booleanValue:a.filters[e].isValid=!1,r(a),t?this.debouncedRunQuery():i()},t.prototype.render=function(){var e=this,t=this.props,n=t.query,a=t.groups,r=n.filters.map((function(t,r){return X.a.createElement("div",{className:"gf-form"},X.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Filter by tag."},r+1,". filter"),2===n.metricCategory.key&&X.a.createElement(ke,{value:n.filters[r].entity,onChange:function(t){return e.onCallToEntityChange(t,r)}}),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:30,isSearchable:!0,value:n.filters[r].tag,options:a,onChange:function(t){return e.onGroupChange(t,r)}}),X.a.createElement(ee.Select,{menuPlacement:"bottom",width:12,isSearchable:!0,value:n.filters[r].operator,options:e.filterOperatorsOnType(n.filters[r].tag.type),onChange:function(t){return e.onOperatorChange(t,r)}}),e.canShowStringInput(n.filters[r])&&X.a.createElement(ee.Input,{css:"",width:30,value:n.filters[r].stringValue,placeholder:"KEY_VALUE_PAIR"===n.filters[r].tag.type?"key=value":"Please specify",onChange:function(t){return e.onTagFilterStringValueChange(t,r)}}),"NUMBER"===n.filters[r].tag.type&&X.a.createElement(ee.Input,{css:"",type:"number",width:30,value:n.filters[r].numberValue,placeholder:"Please specify",onChange:function(t){return e.onTagFilterNumberValueChange(t,r)}}),"BOOLEAN"===n.filters[r].tag.type&&X.a.createElement(ee.Select,{menuPlacement:"bottom",width:30,isSearchable:!0,onChange:function(t){return e.onTagFilterBooleanValueChange(t,r)},value:{key:""+n.filters[r].booleanValue,label:""+n.filters[r].booleanValue},options:[{key:"false",label:"false"},{key:"true",label:"true"}]}),X.a.createElement(ee.Button,{variant:"secondary",onClick:function(){return e.removeTagFilter(r)}},"-"))}));return X.a.createElement("div",null,r,X.a.createElement("div",{className:"gf-form"},X.a.createElement(ee.InlineFormLabel,{width:14,tooltip:"Add an additional tag filter."},"Add filter"),X.a.createElement(ee.Button,{variant:"secondary",onClick:this.addTagFilter},"+"),X.a.createElement("div",{hidden:!n.showWarningCantShowAllResults},X.a.createElement(ee.InlineFormLabel,{width:12,tooltip:"Add Filter to narrow down the data."},"â ï¸ Can't show all results"))))},t}(X.a.Component),He=function(e){function t(t){var n=e.call(this,t)||this;return n.onMetricChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery,i=t.onChange;a.metric=e,a.metric&&a.metric.key&&!A.a.includes(a.metric.aggregations,a.aggregation)&&(a.aggregation=a.metric.aggregations[0]),a.displayMaxMetricValue&&!n.canShowMaxMetricValue()&&(a.displayMaxMetricValue=!1),a.allMetrics=[],a.showAllMetrics=!1,i(a),r()},n.onTimeIntervalChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery,i=t.onChange;a.timeInterval=e,i(a),r()},n.onAggregationChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery,i=t.onChange;a.aggregation=e,i(a),r()},n.onShowMaxValueChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;e&&e.currentTarget&&(a.displayMaxMetricValue=e.currentTarget.checked,r(a),i())},n.onShowAllMetricsChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;e&&e.currentTarget&&(a.showAllMetrics=e.currentTarget.checked,a.showAllMetrics&&(a.metric={key:null,label:"Displaying "+n.props.availableMetrics.length+" metrics"},a.allMetrics=n.props.availableMetrics),r(a),i())},n.state={possibleTimeIntervals:[],possibleAggregations:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.query,n=e.datasource,a=e.onChange;t.timeInterval&&t.timeInterval.key&&n.availableTimeIntervals.find((function(e){return e.key===t.timeInterval.key}))||(t.timeInterval=n.getDefaultTimeInterval(t)),a(t)},t.prototype.canShowMaxMetricValue=function(){var e=this.props.query;return e.entityType&&"host"===e.entityType.key&&e.metric&&A.a.find(P,(function(t){return t.key===e.metric.key}))},t.prototype.canShowAggregation=function(){return this.props.query.metricCategory.key>=2},t.prototype.canSelectAggregation=function(){var e=this.props.query;return e.metric&&e.metric.aggregations&&e.metric.aggregations.length>1},t.prototype.render=function(){var e=this.props,t=e.query,n=e.datasource;return X.a.createElement("div",{className:"gf-form"},X.a.createElement(Qe,{queryKeyword:!0,disabled:t.useFreeTextMetrics,inputWidth:0,label:"Metric",tooltip:"Select the metric you wish to plot.",value:t.metric,noOptionsMessage:"No metrics found",options:this.props.availableMetrics,onChange:this.onMetricChange}),0===t.metricCategory.key&&X.a.createElement(qe,{queryKeyword:!0,disabled:!this.canShowMaxMetricValue(),labelWidth:9,label:"Show max value",tooltip:"Displays the maximal value of current metric. Supported for 'Type=Host' with cpu.used, memory.used and openFiles.used only.",value:t.displayMaxMetricValue,onChange:this.onShowMaxValueChange}),1===t.metricCategory.key&&X.a.createElement(qe,{queryKeyword:!0,disabled:!t.canShowAllMetrics,labelWidth:9,label:"Show all metrics",tooltip:"You have the option to show all metrics in the graph once the amount of possible, selectable metrics is between 1 and 5.",value:t.showAllMetrics,onChange:this.onShowAllMetricsChange}),this.canShowAggregation()&&X.a.createElement(Qe,{queryKeyword:!0,disabled:!this.canSelectAggregation(),labelWidth:7,inputWidth:12,label:"Aggregation",tooltip:"Select a metric aggregation.",value:t.aggregation,options:t.metric.aggregations,onChange:this.onAggregationChange}),X.a.createElement(Qe,{queryKeyword:!0,disabled:n.availableTimeIntervals.length<=1,labelWidth:5,inputWidth:12,label:"Rollup",tooltip:"Select the rollup value.",value:t.timeInterval,options:n.availableTimeIntervals,onChange:this.onTimeIntervalChange}))},t}(X.a.Component),Ye=(n(10),function(e){function t(t){var n=e.call(this,t)||this;n.onCategoryChange=function(e){n.query.metricCategory===e||(n.selectionReset(),n.query.metricCategory=e,n.query.timeInterval=n.props.datasource.getDefaultTimeInterval(n.query),n.changeAndRun())},n.changeAndRun=function(){n.props.onChange(n.query),n.props.onRunQuery()},n.updateMetrics=function(e){if(n.setState({availableMetrics:A.a.sortBy(e,"key"),allMetrics:A.a.sortBy(e,"key")}),n.query.metric&&n.query.metric.key||n.query.showAllMetrics){var t=A.a.find(e,(function(e){return e.key===n.query.metric.key}));n.query.metric=t||{key:null}}1===n.query.metricCategory.key?n.onMetricsFilter(n.query.customFilters):n.query.metric&&n.query.metric.key||n.setMetricPlaceholder(e.length),n.changeAndRun()},n.filterForEntityType=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var a=n.props,r=a.query,i=a.datasource,o=a.onChange;i.getEntityTypes().then((function(a){var i=a;t&&!r.useFreeTextMetrics&&(i=n.filterEntityTypes(a,e)),n.setState({queryTypes:i}),r.entityType&&r.entityType.key&&A.a.find(i,(function(e){return e.key===r.entityType.key}))||(r.entityType={key:null,label:"Please select ("+i.length+")"}),o(r)}))},n.filterEntityTypes=function(e,t){return t?A.a.sortBy(A.a.filter(e,(function(e){return n.findMatchingEntityTypes(e)})),"label"):A.a.sortBy(e,"label")},n.findMatchingEntityTypes=function(e){return(0===n.props.query.metricCategory.key||"statsd"===e.key||"prometheus"===e.key||"jvmRuntimePlatform"===e.key||"dropwizardApplicationContainer"===e.key)&&(n.snapshots.find((function(t){return t===e.key}))&&null!=e.label)},n.updateQueryTypes=function(e){n.setState({queryTypes:e})},n.updateGroups=function(e){n.setState({groups:e})},n.onMetricsFilter=function(e){var t=[];t=e&&0!==e.length?n.applyFilterToMetricList(e):n.state.allMetrics,n.query.canShowAllMetrics=n.isAbleToShowAllMetrics(t),n.query.canShowAllMetrics||(n.query.showAllMetrics=!1),n.query.customFilters=e,n.query.metric&&n.query.metric.key||n.setMetricPlaceholder(t.length),n.setState((function(e){return o(o({},e),{availableMetrics:t})})),n.props.onChange(n.query),n.checkMetricAndRefresh()};var a={metricCategory:M[0],timeShiftIsValid:!0,customFilters:[]};return n.query=Object.assign(a,t.query),Y(n.query),n.state={groups:[],allMetrics:[],queryTypes:[],availableMetrics:[],selectedWindowSize:n.props.range?b(n.props.range).windowSize:216e5},n.filterMetricsOnType=n.filterMetricsOnType.bind(n),n.loadEntityTypes=n.loadEntityTypes.bind(n),n.props.onChange(n.query),n}return i(t,e),t.prototype.componentDidUpdate=function(e,t,n){var a=this,r=this.props,i=r.onChange,l=r.range,s=r.datasource;l&&this.state.selectedWindowSize!==b(l).windowSize&&(this.setState(o(o({},this.state),{selectedWindowSize:b(l).windowSize})),s.setPossibleTimeIntervals(this.query),s.availableTimeIntervals.find((function(e){return e.key===a.query.timeInterval.key}))||(this.query.timeInterval=s.getDefaultTimeInterval(this.query),i(this.query)))},t.prototype.setMetricPlaceholder=function(e){1===this.query.metricCategory.key?this.query.metric={key:null,label:"Please select ("+e+"/"+this.state.allMetrics.length+")"}:this.query.metric={key:null,label:"Please select ("+e+")"},this.props.onChange(this.query)},t.prototype.loadEntityTypes=function(e){var t=this;void 0===e&&(e=!0);var n=this.props,a=n.query,r=n.datasource,i=n.onRunQuery;a.entityQuery?r.fetchTypesForTarget(a).then((function(n){t.snapshots=n.data,t.filterForEntityType(!0,e),i()})):this.setState({queryTypes:[]})},t.prototype.applyFilterToMetricList=function(e){var t=this.state.allMetrics;return A.a.forEach(e,(function(e){""!==e&&(t=A.a.sortBy(A.a.filter(t,(function(t){return t.key.toLowerCase().includes(e.toLowerCase())})),"key"))})),t},t.prototype.filterMetricsOnType=function(e){var t=this.state.allMetrics.filter((function(t){return t.beaconTypes.includes(e)}));this.setState({availableMetrics:t}),this.query.metric&&this.query.metric.key&&this.query.metric.beaconTypes.includes(e)||this.setMetricPlaceholder(t.length),this.changeAndRun()},t.prototype.isAbleToShowAllMetrics=function(e){return 1===this.query.metricCategory.key&&e.length>0&&e.length<=5},t.prototype.checkMetricAndRefresh=function(){this.query.metric&&this.query.metric.key&&!A.a.includes(A.a.map(this.state.availableMetrics,(function(e){return e.key})),this.query.metric.key)&&this.resetMetricSelection(),this.changeAndRun()},t.prototype.selectionReset=function(){var e=this.props.query;e.metricCategory.key>1&&(e.entityQuery=""),this.setState({availableMetrics:[],allMetrics:[],groups:[]}),this.resetEntityTypeSelection(),this.resetEntitySelection(),this.resetMetricSelection()},t.prototype.resetEntityTypeSelection=function(){var e=this.props.query;e.entityType={key:null,label:"-"},e.customFilters=[]},t.prototype.resetEntitySelection=function(){var e=this.props.query;e.entity={},e.group={},e.showGroupBySecondLevel=!1,e.groupbyTagSecondLevelKey="",e.aggregateGraphs=!1,e.aggregationFunction=Oe[0],e.hideOriginalGraphs=!1,e.filters=[],e.showWarningCantShowAllResults=!1,e.showAllMetrics=!1,e.canShowAllMetrics=!1,e.displayMaxMetricValue=!1,e.applicationCallToEntity="",e.callToEntity="",this.resetServices(),this.resetEndpoints(),this.resetSLO()},t.prototype.resetMetricSelection=function(){var e=this.props.query;e.metric={},e.timeShift="",e.timeShiftIsValid=!0,e.showWarningCantShowAllResults=!1,e.showAllMetrics=!1,e.labelFormat="",e.freeTextMetrics="",e.useFreeTextMetrics=!1},t.prototype.resetServices=function(){this.props.query.service={}},t.prototype.resetEndpoints=function(){this.props.query.endpoint={}},t.prototype.resetSLO=function(){var e=this.props.query;e.sloValue="",e.sloReport={}},t.prototype.render=function(){var e=this.query,t=this.onCategoryChange;return X.a.createElement("div",{className:"gf-form-group"},X.a.createElement("div",{className:"gf-form"},X.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Category",tooltip:"Select a metric category.",value:e.metricCategory,options:M,onChange:t})),0===e.metricCategory.key&&X.a.createElement(Ue,{query:e,queryTypes:this.state.queryTypes,datasource:this.props.datasource,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,loadEntityTypes:this.loadEntityTypes,updateQueryTypes:this.updateQueryTypes}),1===e.metricCategory.key&&X.a.createElement(Ue,{query:e,queryTypes:this.state.queryTypes,datasource:this.props.datasource,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,loadEntityTypes:this.loadEntityTypes,updateQueryTypes:this.updateQueryTypes}),2===e.metricCategory.key&&X.a.createElement(Ae,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,groups:this.state.groups,updateGroups:this.updateGroups,datasource:this.props.datasource}),3===e.metricCategory.key&&X.a.createElement(Ge,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,groups:this.state.groups,updateGroups:this.updateGroups,filterMetricsOnType:this.filterMetricsOnType,datasource:this.props.datasource}),4===e.metricCategory.key&&X.a.createElement(he,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,datasource:this.props.datasource}),7===e.metricCategory.key&&X.a.createElement(Ve,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,datasource:this.props.datasource}),7!==e.metricCategory.key&&X.a.createElement(He,{query:e,onChange:this.props.onChange,onRunQuery:this.props.onRunQuery,updateMetrics:this.updateMetrics,availableMetrics:this.state.availableMetrics,datasource:this.props.datasource}),1===e.metricCategory.key&&X.a.createElement(Me,{query:e,onChange:this.props.onChange,onRunQuery:this.props.onRunQuery,onFilterChange:this.onMetricsFilter,availableMetrics:this.state.availableMetrics,datasource:this.props.datasource}),(2===e.metricCategory.key||3===e.metricCategory.key)&&X.a.createElement(je,{query:e,onChange:this.props.onChange,onRunQuery:this.props.onRunQuery,datasource:this.props.datasource,groups:this.state.groups}),X.a.createElement(Pe,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,loadEntityTypes:this.loadEntityTypes}),X.a.createElement(ee.Badge,{text:"3.1.1",color:"blue"}))},t}(J.PureComponent));n.d(t,"plugin",(function(){return Ze}));var Ze=new a.DataSourcePlugin(Z).setConfigEditor(ne).setQueryEditor(Ye)}])}));
//# sourceMappingURL=module.js.map