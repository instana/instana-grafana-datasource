/*! For license information please see module.js.LICENSE.txt */
define(["react","lodash","@grafana/ui","@grafana/data","@grafana/runtime"],(function(e,t,n,a,r){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=13)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t,n){var a=n(5),r=n(8);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1},o=(a(r,i),r.locals?r.locals:{});e.exports=o},function(e,t,n){"use strict";var a,r=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function l(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},a=[],r=0;r<e.length;r++){var i=e[r],s=t.base?i[0]+t.base:i[0],u=n[s]||0,c="".concat(s," ").concat(u);n[s]=u+1;var p=l(c),y={css:i[1],media:i[2],sourceMap:i[3]};-1!==p?(o[p].references++,o[p].updater(y)):o.push({identifier:c,updater:f(y,t),references:1}),a.push(c)}return a}function u(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var r=n.nc;r&&(a.nonce=r)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var c,p=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function y(e,t,n,a){var r=n?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=p(t,r);else{var i=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function h(e,t,n){var a=n.css,r=n.media,i=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),i&&btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var d=null,g=0;function f(e,t){var n,a,r;if(t.singleton){var i=g++;n=d||(d=u(t)),a=y.bind(null,n,i,!1),r=y.bind(null,n,i,!0)}else n=u(t),a=h.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<n.length;a++){var r=l(n[a]);o[r].references--}for(var i=s(e,t),u=0;u<n.length;u++){var c=l(n[u]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}n=i}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var r=(o=a,l=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),"/*# ".concat(s," */")),i=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[n].concat(i).concat([r]).join("\n")}var o,l,s;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,a){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(a)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(var l=0;l<e.length;l++){var s=[].concat(e[l]);a&&r[s[0]]||(n&&(s[2]?s[2]="".concat(n," and ").concat(s[2]):s[2]=n),t.push(s))}},t}},function(e,t){e.exports=r},function(e,t,n){(t=n(6)(!0)).push([e.i,".entityDropdown{min-width:80px}.settings{max-width:600px}","",{version:3,sources:["plugin.css"],names:[],mappings:"AAAA,gBAAgB,cAAc,CAAC,UAAU,eAAe",file:"plugin.css",sourcesContent:[".entityDropdown{min-width:80px}.settings{max-width:600px}"]}]),e.exports=t},function(e,t,n){var a=n(5),r=n(10);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1},o=(a(r,i),r.locals?r.locals:{});e.exports=o},function(e,t,n){(t=n(6)(!0)).push([e.i,'path[d="M18.71,7.21a1,1,0,0,0-1.42,0L9.84,14.67,6.71,11.53A1,1,0,1,0,5.29,13l3.84,3.84a1,1,0,0,0,1.42,0l8.16-8.16A1,1,0,0,0,18.71,7.21Z"]{display:none}',"",{version:3,sources:["instana-grafana.css"],names:[],mappings:"AAAA,0IAA0I,YAAY",file:"instana-grafana.css",sourcesContent:['path[d="M18.71,7.21a1,1,0,0,0-1.42,0L9.84,14.67,6.71,11.53A1,1,0,1,0,5.29,13l3.84,3.84a1,1,0,0,0,1.42,0l8.16-8.16A1,1,0,0,0,18.71,7.21Z"]{display:none}']}]),e.exports=t},function(e,t,n){var a=n(5),r=n(12);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1},o=(a(r,i),r.locals?r.locals:{});e.exports=o},function(e,t,n){(t=n(6)(!0)).push([e.i,'.dropdown{position:relative;background:transparent;width:"32px";height:"32px";margin-right:"4px"}.dropdown-list{transition:max-height .2s ease-out;max-height:0;overflow:hidden;z-index:2;position:absolute}.dropdown-list-active{overflow:hidden;z-index:2;max-height:1000px;opacity:1;position:absolute}.iconTextContainer{display:inline-flex}.iconStyle{display:flex;align-items:center;justify-content:center}.iconTextStyle{padding:7px}',"",{version:3,sources:["ApplicationBoundaryScope.css"],names:[],mappings:"AAAA,UAAU,iBAAiB,CAAC,sBAAsB,CAAC,YAAY,CAAC,aAAa,CAAC,kBAAkB,CAAC,eAAe,kCAAkC,CAAC,YAAY,CAAC,eAAe,CAAC,SAAS,CAAC,iBAAiB,CAAC,sBAAsB,eAAe,CAAC,SAAS,CAAC,iBAAiB,CAAC,SAAS,CAAC,iBAAiB,CAAC,mBAAmB,mBAAmB,CAAC,WAAW,YAAY,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,eAAe,WAAW",file:"ApplicationBoundaryScope.css",sourcesContent:['.dropdown{position:relative;background:transparent;width:"32px";height:"32px";margin-right:"4px"}.dropdown-list{transition:max-height .2s ease-out;max-height:0;overflow:hidden;z-index:2;position:absolute}.dropdown-list-active{overflow:hidden;z-index:2;max-height:1000px;opacity:1;position:absolute}.iconTextContainer{display:inline-flex}.iconStyle{display:flex;align-items:center;justify-content:center}.iconTextStyle{padding:7px}']}]),e.exports=t},function(e,t,n){"use strict";n.r(t);var a=n(3),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function l(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}function s(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{s(a.next(e))}catch(e){i(e)}}function l(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}s((a=a.apply(e,t||[])).next())}))}function u(e,t){var n,a,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}Object.create;function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}Object.create;var p="-- No Application Filter --",y="-- No Endpoint Filter --",h=n(1),d=n.n(h);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=["refId","pluginId","showWarningCantShowAllResults","timeShiftIsValid","useFreeTextMetrics","showGroupBySecondLevel","canShowAllMetrics","timeFilter","stableHash"];var m=[{value:1,label:"1s"},{value:5,label:"5s"},{value:10,label:"10s"},{value:60,label:"1min"},{value:300,label:"5min"},{value:600,label:"10min"},{value:1800,label:"30min"},{value:3600,label:"1h"},{value:14400,label:"4h"},{value:21600,label:"6h"},{value:28800,label:"8h"},{value:43200,label:"12h"},{value:86400,label:"1d"},{value:432e3,label:"5d"},{value:864e3,label:"10d"}];function v(e){var t=1e3*Math.floor(new Date(e.from.valueOf()).getTime()/1e3),n=1e3*Math.floor(new Date(e.to.valueOf()).getTime()/1e3);return{from:t,to:n,windowSize:n-t}}function b(e){return e.from?e.to-e.from:e.windowSize}function S(e){return T(e.from)+"|"+T(e.to)}function T(e){return Math.floor(e/6e4)}function C(e){return e>0?60*e*60*1e3:0}function E(e,t){var n=1e3*t;return Math.max(e,n)}var k=[{availableFor:864e5,rollup:1e3,label:"1s"},{availableFor:864e5,rollup:5e3,label:"5s"},{availableFor:26784e5,rollup:6e4,label:"1min"},{availableFor:80352e5,rollup:3e5,label:"5min"},{availableFor:321408e5,rollup:36e5,label:"1h"}];function A(e){return w(e,80)[0]}function w(e,t){void 0===t&&(t=600);var n=m.filter((function(n){return e/1e3/n.value<=t&&1e3*n.value<=e}));return e>48000001&&(n=n.filter((function(e){return e.value>=3600}))),e>=18e5&&(n=n.filter((function(e){return e.value>=60}))),n.length>0?n.map((function(e){return{key:e.value.toString(),label:e.label}})):[{key:m[m.length-1].value.toString(),label:m[m.length-1].label}]}function I(e){return M(e)[0]}function M(e){var t=Date.now(),n=b(e),a=k.filter((function(n){return e.from>=t-n.availableFor})).filter((function(e){return n>=e.rollup&&n/e.rollup<=800}));return a.length>0?a.map((function(e){return{key:e.rollup.toString(),label:e.label}})):[{key:k[k.length-1].rollup.toString(),label:k[k.length-1].label}]}var R=n(7),q=function(e,t,n,a){return void 0===n&&(n=!1),void 0===a&&(a=1),L(e,{method:"GET",url:e.url+t},n,a)},O=function(e,t,n,a,r){return void 0===a&&(a=!1),void 0===r&&(r=0),L(e,{method:"POST",url:e.url+t,data:n},a,r)};function L(e,t,n,a){return Object(R.getBackendSrv)().datasourceRequest(t).catch((function(r){var i,o;if(429===r.status){if(a>0&&(null===(i=r.data)||void 0===i?void 0:i.errors)&&r.data.errors[0]&&r.data.errors[0].includes("concurrent")){var l=a>=4?1e4:2e4*(4-a);return new Promise((function(e){return setTimeout(e,l)})).then((function(){return L(e,t,n,a-1)}))}throw new Error("API limit is reached.")}if(!n||!(r.status>=400||r.status<500)){if(a>0&&r.status>=500)return L(e,t,n,a-1);if(!r.statusText&&(null===(o=r.data)||void 0===o?void 0:o.errors)&&r.data.errors[0])throw new Error(r.data.errors[0]);throw r}}))}var F=function(){function e(){this.store={}}return e.prototype.put=function(e,t,n){var a=this;void 0===n&&(n=7e4),void 0!==e&&void 0!==t&&(this.del(e),this.store[e]={value:t,expiry:Date.now()+n,timeout:setTimeout((function(){a.del(e)}),n)})},e.prototype.get=function(e){var t=this.store[e];return!t||t.expiry&&t.expiry>Date.now()||(this.del(e),t=void 0),t&&t.value},e.prototype.del=function(e){this.store.hasOwnProperty(e)&&(clearTimeout(this.store[e].timeout),delete this.store[e])},e}();function N(e){var t={name:e.tag.key,operator:e.operator.key,value:e.stringValue};return"NUMBER"===e.tag.type?null!==e.numberValue&&(t.value=e.numberValue):"BOOLEAN"===e.tag.type&&(t.value=e.booleanValue),t}function x(e,t,n){return t.data?d.a.flatten(t.data.items.map((function(t,a){return d.a.map(t.metrics,(function(r,i){return{target:n(e,t,i,a),datapoints:d.a.map(r,(function(e){return[e[1],e[0]]})),refId:e.refId,key:e.stableHash}}))}))):t}function _(e){return{target:e,datapoints:[]}}function P(e,t,n){return{target:e,refId:t,datapoints:n}}var Q=[{key:"calls",label:"Call count",description:"calls",aggregations:[{key:"SUM",label:"SUM"}]},{key:"latency",label:"Call latency",description:"latency",aggregations:[{key:"MAX",label:"MAX"},{key:"MEAN",label:"MEAN"},{key:"MIN",label:"MIN"},{key:"P25",label:"P25"},{key:"P50",label:"P50"},{key:"P75",label:"P75"},{key:"P90",label:"P90"},{key:"P95",label:"P95"},{key:"P98",label:"P98"},{key:"P99",label:"P99"}]},{key:"errors",label:"Error rate",description:"errors",aggregations:[{key:"MEAN",label:"MEAN"}]},{key:"services",label:"Service Count",description:"services",aggregations:[{key:"DISTINCT_COUNT",label:"DISTINCT_COUNT"}]}];function B(e,t){return!!t&&(t>0&&1e3*Math.floor(e/1e3)>t)}var V=new F;function D(e){var t=V.get("version");return t?Promise.resolve(t):q(e,"/api/instana/version").then((function(t){if(t.data&&t.data.imageTag){var n=parseInt(t.data.imageTag.split(".",2)[1],10)||null;return n&&V.put(e.url,n,6e5),n}return null}),(function(e){return null}))}var $=function(){function e(e){this.instanaOptions=e,this.applicationsCache=new F,this.miscCache=new F}return e.prototype.runQuery=function(e,t){var n=this;if(B(t.windowSize,C(this.instanaOptions.queryinterval_limit_app_calls)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_app_calls+" hours");return e&&e.metric&&e.metric.key&&e.group&&e.group.key?this.fetchAnalyzeMetricsForApplication(e,t).then((function(t){return e.showWarningCantShowAllResults=t.data.canLoadMore,x(e,t,n.buildAnalyzeApplicationLabel)})):Promise.resolve(_(e.refId))},e.prototype.getApplications=function(e){var t=S(e),n=this.applicationsCache.get(t);if(n)return n;var a=b(e);return n=this.paginateApplications([],a,e.to,1,200,15).then((function(e){var t=d.a.flattenDeep(d.a.map(e,(function(e){return e.items})));return d.a.orderBy(d.a.compact(t).map((function(e){return{key:e.id,label:e.label,boundaryScope:e.boundaryScope}})),[function(e){return e.label.toLowerCase()}],["asc"])})),this.applicationsCache.put(t,n,6e5),n},e.prototype.paginateApplications=function(e,t,n,a,r,i){var o=this;if(a>i)return e;var l="windowSize="+t+"&to="+n+"&page="+a+"&pageSize="+r;return q(this.instanaOptions,"/api/application-monitoring/applications?"+l).then((function(l){return e.push(l.data),a*r<l.data.totalHits?(a++,o.paginateApplications(e,t,n,a,r,i)):e}))},e.prototype.getApplicationTags=function(e){var t=this,n=this.miscCache.get("applicationTags");return n||D(this.instanaOptions).then((function(a){return n=a>=191?t.getCatalog(e).then((function(e){return t.mapCatalogResponse(e.data.tags)})):t.getCatalogFromDeprecatedEndpoint().then((function(e){return t.mapCatalogResponse(e.data)})),t.miscCache.put("applicationTags",n),n}))},e.prototype.getCatalog=function(e){var t="/api/application-monitoring/catalog?dataSource=CALLS&useCase=FILTERING&from="+e.from;return q(this.instanaOptions,t)},e.prototype.getCatalogFromDeprecatedEndpoint=function(){return q(this.instanaOptions,"/api/application-monitoring/catalog/tags")},e.prototype.mapCatalogResponse=function(e){return e.map((function(e){return{key:e.name,label:e.name,type:e.type,canApplyToSource:e.canApplyToSource,canApplyToDestination:e.canApplyToDestination}}))},e.prototype.getApplicationMetricsCatalog=function(){return Q},e.prototype.fetchAnalyzeMetricsForApplication=function(e,t){var n=this,a=b(t),r=[];return Promise.resolve(this.getApplicationTags(t)).then((function(i){e.entity.key&&r.push({name:"application.name",operator:"EQUALS",value:e.entity.label,entity:e.applicationCallToEntity?e.applicationCallToEntity:"DESTINATION"}),d.a.forEach(e.filters,(function(e){if(e.isValid){var t=N(e),a=d.a.find(i,["key",e.tag.key]);(a.canApplyToDestination||a.canApplyToSource)&&(t.entity=n.getTagEntity(e.entity,a)),r.push(t)}})),e.timeInterval||(e.timeInterval=A(a));var o={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},l={groupbyTag:e.group.key},s=d.a.find(i,["key",e.group.key]);(s.canApplyToDestination||s.canApplyToSource)&&(l.groupbyTagEntity=e.callToEntity),"KEY_VALUE_PAIR"===e.group.type&&e.groupbyTagSecondLevelKey&&(l.groupbyTagSecondLevelKey=e.groupbyTagSecondLevelKey);var u=!1;e.filters.map((function(e){"call.is_synthetic"===e.tag.key&&(u=e.booleanValue)}));var c={group:l,timeFrame:{to:t.to,windowSize:E(a,o.granularity)},metrics:[o],includeSynthetic:u,tagFilterExpression:{type:"EXPRESSION",logicalOperator:"AND",elements:r}};return O(n.instanaOptions,"/api/application-monitoring/analyze/call-groups?fillTimeSeries=true",c,!1,5)}))},e.prototype.getTagEntity=function(e,t){return"DESTINATION"===e&&t.canApplyToDestination?"DESTINATION":"SOURCE"===e&&t.canApplyToSource?"SOURCE":t.canApplyToDestination?"DESTINATION":"SOURCE"},e.prototype.fetchApplicationMetrics=function(e,t){if(!e||!e.metric||!e.metric.key)return Promise.resolve(_(e.refId));var n=b(t);e.timeInterval||(e.timeInterval=A(n));var a={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},r={timeFrame:{to:t.to,windowSize:E(n,a.granularity)},metrics:[a]};return null!==e.entity.key&&(r.applicationId=e.entity.key,r.applicationBoundaryScope=e.applicationBoundaryScope),O(this.instanaOptions,"/api/application-monitoring/metrics/applications?fillTimeSeries=true",r)},e.prototype.buildAnalyzeApplicationLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=d.a.replace(r,"$label",t.name),r=d.a.replace(r,"$application",e.entity.label),r=d.a.replace(r,"$metric",e.metric.label),r=d.a.replace(r,"$key",n),r=d.a.replace(r,"$index",""+a+1),r=d.a.replace(r,"$timeShift",e.timeShift)}return e.entity.label===p?e.timeShift?t.name+" - "+n+" - "+e.timeShift:t.name+" - "+n:e.timeShift&&e.timeShiftIsValid?t.name+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.name+" ("+e.entity.label+") - "+n},e.prototype.buildApplicationMetricLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=d.a.replace(r,"$label",t.application.label),r=d.a.replace(r,"$application",e.entity.label),r=d.a.replace(r,"$metric",e.metric.label),r=d.a.replace(r,"$key",n),r=d.a.replace(r,"$index",""+a+1),r=d.a.replace(r,"$timeShift",e.timeShift)}return e.entity.label===p?e.timeShift?t.application.label+" - "+n+" - "+e.timeShift:t.application.label+" - "+n:e.timeShift&&e.timeShiftIsValid?t.application.label+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.application.label+" ("+e.entity.label+") - "+n},e}(),U=function(){function e(e){this.instanaOptions=e,this.endpointsCache=new F}return e.prototype.getEndpointsOfService=function(e,t){var n="";e.entity&&e.entity.key&&(n=e.entity.key);var a="";e.service&&(a=e.service.key);var r=S(t)+n+a+e.applicationBoundaryScope,i=this.endpointsCache.get(r);if(i)return i;var o=b(t);return i=this.paginateEndpoints([],n,a,o,e.applicationBoundaryScope,t.to,1,200,15).then((function(e){var t=d.a.flattenDeep(d.a.map(e,(function(e){return e.items})));return d.a.orderBy(d.a.compact(t).map((function(e){return{key:e.id,label:e.label}})),[function(e){return e.label.toLowerCase()}],["asc"])})),this.endpointsCache.put(r,i,6e5),i},e.prototype.paginateEndpoints=function(e,t,n,a,r,i,o,l,s){var u=this;if(o>s)return e;var c="windowSize="+a+"&to="+i+"&page="+o+"&pageSize="+l;"ALL"!==r&&"INBOUND"!==r||(c+="&applicationBoundaryScope="+r);var p="/api/application-monitoring/applications;id="+(t||"")+"/services;id="+(n||"")+"/endpoints?"+c;return q(this.instanaOptions,p).then((function(c){return e.push(c.data),o*l<c.data.totalHits?(o++,u.paginateEndpoints(e,t,n,a,r,i,o,l,s)):e}))},e.prototype.fetchEndpointMetrics=function(e,t){if(!e||!e.metric||!e.metric.key)return Promise.resolve(_(e.refId));var n=b(t);e.timeInterval||(e.timeInterval=A(n));var a={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},r={endpointId:e.endpoint.key,timeFrame:{to:t.to,windowSize:E(n,a.granularity)},metrics:[a]};return e.entity&&e.entity.key&&(r.applicationId=e.entity.key,r.applicationBoundaryScope=e.applicationBoundaryScope),e.service&&e.service.key&&(r.serviceId=e.service.key),O(this.instanaOptions,"/api/application-monitoring/metrics/endpoints?fillTimeSeries=true",r)},e.prototype.buildEndpointMetricLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=d.a.replace(r,"$label",t.endpoint.label),r=d.a.replace(r,"$endpoint",e.endpoint.label),r=d.a.replace(r,"$service",e.service.label),r=d.a.replace(r,"$application",e.entity.label),r=d.a.replace(r,"$metric",e.metric.label),r=d.a.replace(r,"$key",n),r=d.a.replace(r,"$index",""+a+1),r=d.a.replace(r,"$timeShift",e.timeShift)}return e.endpoint.label===y?e.timeShift?t.endpoint.label+" - "+n+" - "+e.timeShift:t.endpoint.label+" - "+n:e.timeShift&&e.timeShiftIsValid?t.endpoint.label+" ("+e.endpoint.label+") - "+n+" - "+e.timeShift:t.endpoint.label+" ("+e.endpoint.label+") - "+n},e}(),G=[{key:"cpu.used",value:"cpu.count",label:"cpu.max"},{key:"memory.used",value:"memory.total",label:"memory.max"},{key:"openFiles.used",value:"openFiles.max",label:"openFiles.max"}],K=function(){function e(e){this.timeToLiveSnapshotInfoCache=4e6,this.instanaOptions=e,this.snapshotCache=new F,this.snapshotInfoCache=new F,this.catalogCache=new F,this.typeCache=new F,this.miscCache=new F}return e.prototype.runQuery=function(e,t){var n=this;if(B(t.windowSize,C(this.instanaOptions.queryinterval_limit_infra)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_infra+" hours");return e.tagFilterExpression||8===e.metricCategory.key&&e.metric.key&&e.group.key&&e.entity.key?this.fetchAnalyzeEntities(e,t):e.metric&&e.metric.key||e.showAllMetrics||e.freeTextMetrics?this.fetchSnapshotsForTarget(e,t).then((function(a){if(e.showAllMetrics)return n.fetchMultipleMetricsForSnapshots(e,a,t,e.allMetrics);if(e.freeTextMetrics){var r=n.extractMetricsFromText(e.freeTextMetrics);return n.fetchMultipleMetricsForSnapshots(e,a,t,r)}return n.fetchMetricsForSnapshots(e,a,t,e.metric)})):Promise.resolve(_(e.refId))},e.prototype.extractMetricsFromText=function(e){var t=e.replace(/\s/g,"").split(","),n=[];return d.a.each(t,(function(e){return n.push(JSON.parse('{ "key": "'+e+'"}'))})),n.length>4&&(n=n.slice(0,4)),n},e.prototype.fetchMultipleMetricsForSnapshots=function(e,t,n,a){var r=this,i=[];return d.a.forEach(a,(function(a){i.push(r.fetchMetricsForSnapshots(e,t,n,a))})),Promise.all(i).then((function(e){var t=[];return e.forEach((function(e){return e.forEach((function(e){return t.push(e)}))})),t}))},e.prototype.fetchMetricsForSnapshots=function(e,t,n,a){var r=this,i=[],o=[];return d.a.map(t,(function(e){return o.push(e.snapshotId)})),this.fetchMetricsForSnapshot(e,o.slice(0,30),n,a).then((function(a){if(!a.data)return a;var o=r.readTimeSeries(a.data.items,e.aggregation,n);return d.a.flatten(a.data.items.map((function(n,a){return d.a.map(n.metrics,(function(a,l){var s={target:n.label,datapoints:d.a.map(a,(function(e){return[e[1],e[0]]})),refId:e.refId,key:e.stableHash};if(e.displayMaxMetricValue){var u=r.getMaxMetricValue(e.metric,t);i.push(r.buildMaxMetricTarget(e,o,u,s.target)),s.datapoints=r.convertRelativeToAbsolute(s.datapoints,u)}return s}))})))}))},e.prototype.getMaxMetricValue=function(e,t){var n=G;return t.response.data.data[d.a.find(n,(function(t){return t.key===e.key})).value]},e.prototype.buildMaxMetricTarget=function(e,t,n,a){var r=d.a.map(t,(function(e){return[n,e.timestamp]})),i=this.convertMetricNameToMaxLabel(e.metric);return{target:a+" "+i,datapoints:r,refId:e.refId,key:e.stableHash+i}},e.prototype.convertMetricNameToMaxLabel=function(e){var t=G;return d.a.find(t,(function(t){return t.key===e.key})).label},e.prototype.convertRelativeToAbsolute=function(e,t){return d.a.map(e,(function(e){return e[0]?[e[0]*t,e[1]]:[null,e[1]]}))},e.prototype.getEntityTypes=function(){var e=this.typeCache.get("entityTypes");return e||(e=q(this.instanaOptions,"/api/infrastructure-monitoring/catalog/plugins").then((function(e){var t=e.data.map((function(e){return{key:e.plugin,label:e.label}}));return t.push({key:"regionEntity",label:"Region"}),d.a.sortBy(t,"label")})),this.typeCache.put("entityTypes",e),e)},e.prototype.fetchTypesForTarget=function(e,t){var n="/api/snapshots/types?q="+encodeURIComponent(e.entityQuery)+"&from="+t.from+"&to="+t.to+(this.instanaOptions.showOffline?"":"&time="+t.to);return q(this.instanaOptions,n)},e.prototype.fetchAvailableMetricsForEntityType=function(e,t){var n=b(t);e.timeInterval=A(n);var a={tagFilterExpression:{type:"EXPRESSION",logicalOperator:"AND",elements:[]},timeFrame:{to:t.to,windowSize:E(n,e.timeInterval.key)},query:"",type:e.entity.key};return O(this.instanaOptions,"/api/infrastructure-monitoring/analyze/metrics",a).then((function(e){var t=[];return e.data.metrics.map((function(e){return t.push({key:e.id,label:e.label,description:e.description,aggregations:[{key:"MAX",label:"MAX"},{key:"MEAN",label:"MEAN"},{key:"MIN",label:"MIN"},{key:"P25",label:"P25"},{key:"P50",label:"P50"},{key:"P75",label:"P75"},{key:"P90",label:"P90"},{key:"P95",label:"P95"},{key:"P98",label:"P98"},{key:"P99",label:"P99"}]})})),d.a.sortBy(t,"label")}))},e.prototype.fetchAnalyzeEntities=function(e,t){var n=b(t),a=[];e.timeInterval||(e.timeInterval=A(n)),e.timeInterval.key<6e4&&(e.timeInterval.key=6e4),d.a.forEach(e.filters,(function(e){a.push(e)}));var r={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},i={tagFilterExpression:{elements:a,type:"EXPRESSION",logicalOperator:"AND"},pagination:{retrievalSize:200},groupBy:[e.groupbyTagSecondLevelKey],type:e.entity.key,metrics:[r],timeFrame:{to:t.to,windowSize:E(n,r.granularity)}};return O(this.instanaOptions,"/api/infrastructure-monitoring/analyze/entity-groups",i).then((function(t){var n=[];if(!t.data&&t.errors.length>=1)throw new Error(t.errors[0].message||t.errors[0]);return t.data.items.forEach((function(t){for(var a in t.metrics)n.push({target:t.tags[e.groupbyTagSecondLevelKey]+" - "+a,datapoints:t.metrics[a]?t.metrics[a].map((function(e){return[e[1],e[0]]})):[],refId:e.refId,key:e.stableHash})})),n}))},e.prototype.getMetricsCatalog=function(e,t){var n=e.key+"|"+t,a=this.catalogCache.get(n);if(a)return a;var r=1===t?"custom":"builtin";return a=q(this.instanaOptions,"/api/infrastructure-monitoring/catalog/metrics/"+e.key+"?filter="+r).then((function(e){return e.data.map((function(e){return{key:e.metricId,label:e.label,description:e.metricId,aggregations:[{key:"MEAN",label:"MEAN"},{key:"SUM",label:"SUM"}],entityType:e.pluginId}}))})),this.catalogCache.put(n,a),a},e.prototype.fetchSnapshotsForTarget=function(e,t){var n=this,a=this.buildQuery(e),r=this.buildSnapshotCacheKey(a,t),i=this.snapshotCache.get(r);if(i)return i;var o="/api/infrastructure-monitoring/snapshots?plugin="+e.entityType.key+"&size=100&q="+e.entityQuery+"&from="+t.from+"&to="+t.to+(this.instanaOptions.showOffline?"":"&time="+t.to);return i=q(this.instanaOptions,o).then((function(e){return Promise.all(e.data.items.map((function(e){var a=e.snapshotId,r=e.host,i=n.snapshotInfoCache.get(a);if(i)return i;var o="/api/infrastructure-monitoring/snapshots/"+a+(n.instanaOptions.showOffline?"?from="+t.from+"&to="+t.to:"?time="+t.to);return i=q(n.instanaOptions,o,!0).then((function(e){return void 0!==e?{snapshotId:a,host:r,response:n.reduceSnapshot(e)}:null})),n.snapshotInfoCache.put(a,i,n.timeToLiveSnapshotInfoCache),i})))})).then((function(e){return d.a.compact(e)})),this.snapshotCache.put(r,i),i},e.prototype.buildQuery=function(e){return(""+e.entityQuery).includes("entity.pluginId:")||(""+e.entityQuery).includes("entity.selfType:")?encodeURIComponent(""+e.entityQuery):encodeURIComponent(e.entityQuery+" AND entity.pluginId:"+e.entityType.key)},e.prototype.buildSnapshotCacheKey=function(e,t){return e+"|"+S(t)},e.prototype.reduceSnapshot=function(e){return e.data=d.a.pick(e.data,["id","label","plugin","data"]),e},e.prototype.readTimeSeries=function(e,t,n){return t&&"SUM"===t.key?this.correctMeanToSum(e,n):e},e.prototype.correctMeanToSum=function(e,t){var n=parseInt(I(t).key,10)/1e3;return d.a.map(e,(function(e){return{value:e.value?e.value*n:null,timestamp:e.timestamp}}))},e.prototype.fetchMetricsForSnapshot=function(e,t,n,a){var r=b(n);e.timeInterval=A(r);var i={metrics:[a.key],query:e.entityQuery,plugin:e.entityType.key,rollup:e.timeInterval.key,snapshotIds:t,timeFrame:{to:n.to,windowSize:E(r,e.timeInterval.key)}};return O(this.instanaOptions,"/api/infrastructure-monitoring/metrics",i)},e.prototype.getHostSuffix=function(e){return e?' (on host "'+e+'")':""},e.prototype.buildLabel=function(e,t,n,a,r){if(n.labelFormat){var i=n.labelFormat;return i=d.a.replace(i,"$label",e.label),i=d.a.replace(i,"$plugin",e.plugin),i=d.a.replace(i,"$snapshot",e.snapshotId),i=d.a.replace(i,"$host",t||"unknown"),i=d.a.replace(i,"$pid",d.a.get(e,["data","pid"],"")),i=d.a.replace(i,"$type",d.a.get(e,["data","type"],"")),i=d.a.replace(i,"$name",d.a.get(e,["data","name"],"")),i=d.a.replace(i,"$service",d.a.get(e,["data","service_name"],"")),i=n.freeTextMetrics?d.a.replace(i,"$metric",r.key):d.a.replace(i,"$metric",d.a.get(n,["metric","key"],"n/a")),i=d.a.replace(i,"$index",a+1),i=d.a.replace(i,"$timeShift",n.timeShift)}return n.timeShift&&n.timeShiftIsValid?e.label+this.getHostSuffix(t)+" - "+n.timeShift:e.label+this.getHostSuffix(t)},e}(),W=function(){function e(e){this.instanaOptions=e,this.MobileAppCache=new F,this.miscCache=new F}return e.prototype.runQuery=function(e,t){var n=this;if(B(t.windowSize,C(this.instanaOptions.queryinterval_limit_mobileapp_metrics)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_mobileapp_metrics+" hours");return e&&e.metric&&e.metric.key&&e.group&&e.group.key&&e.entity&&e.entity.key?this.fetchAnalyzeMetricsForMobileapp(e,t).then((function(t){return x(e,t,n.buildAnalyzeMobileAppLabel)})):Promise.resolve(_(e.refId))},e.prototype.getMobileapp=function(e){var t=S(e),n=this.MobileAppCache.get(t);return n||(n=q(this.instanaOptions,"/api/mobile-app-monitoring/config").then((function(e){return e.data.map((function(e){return{key:e.name,label:e.name}}))})),this.MobileAppCache.put(t,n,6e5),n)},e.prototype.getMobileappTags=function(){var e=this.miscCache.get("mobileappTags");return e||(e=q(this.instanaOptions,"/api/mobile-app-monitoring/catalog/tags").then((function(e){return e.data.map((function(e){return{key:e.name,label:e.name,type:e.type}}))})),this.miscCache.put("mobileappTags",e),e)},e.prototype.getMobileappMetricsCatalog=function(){var e=this,t=this.miscCache.get("mobileappCatalog");return t||(t=q(this.instanaOptions,"/api/mobile-app-monitoring/catalog/metrics").then((function(t){return t.data.map((function(t){return{key:t.metricId,label:t.label,aggregations:t.aggregations?e.transformAggregations(t.aggregations.sort()):[],beaconTypes:t.beaconTypes?e.transformBeaconTypes(t.beaconTypes):["sessionStart","crash","httpRequest","custom","viewChange"]}}))})),this.miscCache.put("mobileappCatalog",t),t)},e.prototype.transformBeaconTypes=function(e){var t;return e.includes("sessionStart")?((t=d.a.remove(e,(function(e){return"sessionStart"!==e}))).push("session_start"),t):e.includes("httpRequest")?((t=d.a.remove(e,(function(e){return"httpRequest"!==e}))).push("http_request"),t):e.includes("viewChange")?((t=d.a.remove(e,(function(e){return"viewChange"!==e}))).push("view_change"),t):e},e.prototype.transformAggregations=function(e){return d.a.map(e,(function(e){return{key:e,label:e}}))},e.prototype.fetchAnalyzeMetricsForMobileapp=function(e,t){var n=b(t),a=[{name:"mobileBeacon.mobileApp.name",operator:"EQUALS",value:e.entity.key}];d.a.forEach(e.filters,(function(e){e.isValid&&a.push(N(e))})),e.timeInterval||(e.timeInterval=A(n));var r={metric:e.metric.key,aggregation:e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},i={groupbyTag:e.group.key};"KEY_VALUE_PAIR"===e.group.type&&e.groupbyTagSecondLevelKey&&(i.groupbyTagSecondLevelKey=e.groupbyTagSecondLevelKey);var o={group:i,timeFrame:{to:t.to,windowSize:E(n,r.granularity)},tagFilters:a,type:e.entityType.key,metrics:[r]};return O(this.instanaOptions,"/api/mobile-app-monitoring/analyze/beacon-groups?fillTimeSeries=true",o,!1,5)},e.prototype.buildAnalyzeMobileAppLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=d.a.replace(r,"$label",t.name),r=d.a.replace(r,"$mobileapp",e.entity.label),r=d.a.replace(r,"$type",e.entityType.label),r=d.a.replace(r,"$metric",e.metric.label),r=d.a.replace(r,"$key",n),r=d.a.replace(r,"$index",""+a+1),r=d.a.replace(r,"$timeShift",e.timeShift)}return e.timeShift&&e.timeShiftIsValid?t.name+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.name+" ("+e.entity.label+") - "+n},e}(),z=function(){function e(e){this.instanaOptions=e,this.servicesCache=new F}return e.prototype.getServicesOfApplication=function(e,t){var n="";e.entity&&e.entity.key&&(n=e.entity.key);var a=S(t)+n+e.applicationBoundaryScope,r=this.servicesCache.get(a);if(r)return r;var i=b(t);return r=this.paginateServices([],n,i,t.to,e.applicationBoundaryScope,1,200,15).then((function(e){var t=d.a.flattenDeep(d.a.map(e,(function(e){return e.items})));return d.a.orderBy(d.a.compact(t).map((function(e){return{key:e.id,label:e.label}})),[function(e){return e.label.toLowerCase()}],["asc"])})),this.servicesCache.put(a,r,6e5),r},e.prototype.paginateServices=function(e,t,n,a,r,i,o,l){var s=this;if(i>l)return e;var u="windowSize="+n+"&to="+a+"&page="+i+"&pageSize="+o;"ALL"!==r&&"INBOUND"!==r||(u+="&applicationBoundaryScope="+r);var c="/api/application-monitoring/applications;id="+(t||"")+"/services?"+u;return q(this.instanaOptions,c).then((function(u){return e.push(u.data),i*o<u.data.totalHits?(i++,s.paginateServices(e,t,n,a,r,i,o,l)):e}))},e.prototype.fetchServiceMetrics=function(e,t){if(!e||!e.metric||!e.metric.key)return Promise.resolve(_(e.refId));var n=b(t);e.timeInterval||(e.timeInterval=A(n));var a={metric:e.metric.key,aggregation:e.aggregation&&e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},r={timeFrame:{to:t.to,windowSize:E(n,a.granularity)},metrics:[a]};return e.entity&&e.entity.key&&(r.applicationId=e.entity.key,r.applicationBoundaryScope=e.applicationBoundaryScope),e.service&&e.service.key&&(r.serviceId=e.service.key),O(this.instanaOptions,"/api/application-monitoring/metrics/services?fillTimeSeries=true",r)},e.prototype.buildServiceMetricLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=d.a.replace(r,"$label",t.service.label),r=d.a.replace(r,"$service",e.service.label),r=d.a.replace(r,"$application",e.entity.label),r=d.a.replace(r,"$metric",e.metric.label),r=d.a.replace(r,"$key",n),r=d.a.replace(r,"$index",a+1+""),r=d.a.replace(r,"$timeShift",e.timeShift)}return null===e.service.key?e.timeShift?t.service.label+" - "+n+" - "+e.timeShift:t.service.label+" - "+n:e.timeShift&&e.timeShiftIsValid?t.service.label+" ("+e.service.label+") - "+n+" - "+e.timeShift:t.service.label+" ("+e.service.label+") - "+n},e}(),j=function(){function e(e){this.instanaOptions=e,this.sliReportsCache=new F}return e.prototype.getConfiguredSLIs=function(){var e=this.sliReportsCache.get("sliReports");return e||(e=q(this.instanaOptions,"/api/settings/sli").then((function(e){return d.a.map(e.data,(function(e){return{key:e.id,label:e.sliName}}))})),this.sliReportsCache.put("sliReports",e),e)},e.prototype.runQuery=function(e,t){var n=this;if(!(e&&e.sloReport&&e.sloReport.key&&e.sloSpecific&&e.sloSpecific.key&&e.sloValue))return Promise.resolve(_(e.refId));var a="/api/sli/report/"+e.sloReport.key+"?from="+t.from+"&to="+t.to+"&slo="+e.sloValue;return q(this.instanaOptions,a).then((function(a){return n.extractSpecificValueFromSLI(e,a.data,t)}))},e.prototype.extractSpecificValueFromSLI=function(e,t,n){return"SLI"===e.sloSpecific.key?[P(e.sloSpecific.label,e.refId,this.buildResultArray(t.sli,n.to))]:"Remaining Error Budget"===e.sloSpecific.key?[P(e.sloSpecific.label,e.refId,this.buildResultArray(t.errorBudgetRemaining,n.to))]:"Timeseries"===e.sloSpecific.key?this.buildViolationDistributionTimeSeries(e,t.violationDistribution,n):[_(e.refId)]},e.prototype.buildResultArray=function(e,t){return[[e,t]]},e.prototype.buildViolationDistributionTimeSeries=function(e,t,n){var a=[],r=[],i=[],o=b(n)/Object.keys(t).length;d.a.forEach(t,(function(e,t){1===e?a.push([1,n.from+t*o]):0===e?i.push([1,n.from+t*o]):-1===e&&r.push([1,n.from+t*o])}));var l=[];return l.push(P("No violation",e.refId,a)),l.push(P("Violation",e.refId,r)),l.push(P("No data",e.refId,i)),l},e}(),Y=function(){function e(e){this.instanaOptions=e,this.websitesCache=new F,this.miscCache=new F}return e.prototype.runQuery=function(e,t){var n=this;if(B(t.windowSize,C(this.instanaOptions.queryinterval_limit_website_metrics)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.instanaOptions.queryinterval_limit_website_metrics+" hours");return e&&e.metric&&e.metric.key&&e.group&&e.group.key&&e.entity&&e.entity.key?this.fetchAnalyzeMetricsForWebsite(e,t).then((function(t){return x(e,t,n.buildAnalyzeWebsiteLabel)})):Promise.resolve(_(e.refId))},e.prototype.getWebsites=function(e){var t=S(e),n=this.websitesCache.get(t);return n||(n=q(this.instanaOptions,"/api/website-monitoring/config").then((function(e){return e.data.map((function(e){return{key:e.name,label:e.name}}))})),this.websitesCache.put(t,n,6e5),n)},e.prototype.getWebsiteTags=function(){var e=this.miscCache.get("websiteTags");return e||(e=q(this.instanaOptions,"/api/website-monitoring/catalog/tags").then((function(e){return e.data.map((function(e){return{key:e.name,label:e.name,type:e.type}}))})),this.miscCache.put("websiteTags",e),e)},e.prototype.getWebsiteMetricsCatalog=function(){var e=this,t=this.miscCache.get("websiteCatalog");return t||(t=q(this.instanaOptions,"/api/website-monitoring/catalog/metrics").then((function(t){return t.data.map((function(t){return{key:t.metricId,label:t.label,aggregations:t.aggregations?e.transformAggregations(t.aggregations.sort()):[],beaconTypes:t.beaconTypes?e.transformBeaconTypes(t.beaconTypes):["pageLoad","resourceLoad","httpRequest","error","custom","pageChange"]}}))})),this.miscCache.put("websiteCatalog",t),t)},e.prototype.transformBeaconTypes=function(e){if(e.includes("pageChange")){var t=d.a.remove(e,(function(e){return"pageChange"!==e}));return t.push("page_change"),t}return e},e.prototype.transformAggregations=function(e){return d.a.map(e,(function(e){return{key:e,label:e}}))},e.prototype.fetchAnalyzeMetricsForWebsite=function(e,t){var n=b(t),a=[{name:"beacon.website.name",operator:"EQUALS",value:e.entity.key}];d.a.forEach(e.filters,(function(e){e.isValid&&a.push(N(e))})),e.timeInterval||(e.timeInterval=A(n));var r={metric:e.metric.key,aggregation:e.aggregation.key?e.aggregation.key:"SUM",granularity:e.timeInterval.key},i={groupbyTag:e.group.key};"KEY_VALUE_PAIR"===e.group.type&&e.groupbyTagSecondLevelKey&&(i.groupbyTagSecondLevelKey=e.groupbyTagSecondLevelKey);var o={group:i,timeFrame:{to:t.to,windowSize:E(n,r.granularity)},tagFilters:a,type:e.entityType.key,metrics:[r]};return O(this.instanaOptions,"/api/website-monitoring/analyze/beacon-groups?fillTimeSeries=true",o,!1,5)},e.prototype.buildAnalyzeWebsiteLabel=function(e,t,n,a){if(e.labelFormat){var r=e.labelFormat;return r=d.a.replace(r,"$label",t.name),r=d.a.replace(r,"$website",e.entity.label),r=d.a.replace(r,"$type",e.entityType.label),r=d.a.replace(r,"$metric",e.metric.label),r=d.a.replace(r,"$key",n),r=d.a.replace(r,"$index",""+a+1),r=d.a.replace(r,"$timeShift",e.timeShift)}return e.timeShift&&e.timeShiftIsValid?t.name+" ("+e.entity.label+") - "+n+" - "+e.timeShift:t.name+" ("+e.entity.label+") - "+n},e}(),H=[{label:"Infrastructure built-in metrics",key:0},{label:"Infrastructure custom metrics",key:1},{label:"Infrastructure Analyze",key:8},{label:"Application/service/endpoint metrics",key:4},{label:"Analyze application calls",key:2},{label:"Analyze website",key:3},{label:"Analyze mobile app",key:9},{label:"SLO information",key:7}];function J(e,t){var n=function(e){if(e.showAllMetrics){if(e.allMetrics.length>1){if(e.customFilters&&e.customFilters.length>0){var t="";return d.a.each(e.customFilters,(function(n,a){t+=n,a!==e.customFilters.length-1&&(t+=".")})),t=t+" ("+e.aggregationFunction.label+")"}return e.aggregationFunction.label}return e.allMetrics[0].key+" ("+e.aggregationFunction.label+")"}return e.metric.key+" ("+e.aggregationFunction.label+")"}(t),a=function(e){var t=[];return d.a.each(e,(function(e){t=d.a.concat(t,e.datapoints)})),t}(e=d.a.filter(e,(function(e){return e.target!==n}))),r=function(e,t){var n=[];return d.a.each(e,(function(e,a){var r,i,o=d.a.map(e,(function(e){return e[0]})),l=(i=o,"sum"===(r=t).toLowerCase()?d.a.sum(i):"mean"===r.toLowerCase()?d.a.mean(i):"min"===r.toLowerCase()?d.a.min(i):"max"===r.toLowerCase()?d.a.max(i):i);n.push([l,parseInt(a,10)])})),n}(d.a.groupBy(a,(function(e){return e[1]})),t.aggregationFunction.label);return function(e,t,n){return{datapoints:e,refId:t,target:n}}(r=d.a.sortBy(r,[function(e){return e[1]}]),t.refId,n)}var Z=function(e){e.entityType&&"string"==typeof e.entityType&&(e.entityType={key:e.entityType,label:e.entityType}),e.filter&&""!==e.filter&&(e.customFilters||(e.customFilters=[],e.customFilters.push({value:e.filter}))),e.timeInterval&&(e.timeInterval.value?e.timeInterval={key:e.timeInterval.value,label:e.timeInterval.label}:e.timeInterval.rollup&&(e.timeInterval={key:e.timeInterval.rollup,label:e.timeInterval.label})),"5"===e.metricCategory&&(e.metricCategory="4",e.service={},e.service.key=e.entity.key,e.service.label=e.entity.label,e.selectedApplication&&e.selectedApplication.key?(e.entity.key=e.selectedApplication.key,e.entity.label=e.selectedApplication.label):(e.entity.key=null,e.entity.label="Test")),"6"===e.metricCategory&&(e.metricCategory="4",e.endpoint={},e.endpoint.key=e.entity.key,e.selectedApplication&&e.selectedApplication.key?(e.entity.key=e.selectedApplication.key,e.entity.label=e.selectedApplication.label):(e.entity.key=null,e.entity.label="Test")),e.aggregation&&"string"==typeof e.aggregation&&(e.aggregation?e.aggregation={key:e.aggregation,label:e.aggregation}:e.aggregation={},e.aggregationFunction?e.aggregationFunction={key:e.aggregationFunction.label,label:e.aggregationFunction.label}:e.aggregationFunction={}),e.customFilters&&e.customFilters.length>0&&e.customFilters[0].value&&(e.customFilters=d.a.map(e.customFilters,(function(e){return e.value}))),8!==e.metricCategory.key&&e.filters&&e.filters.length>0&&!e.filters[0].tag.key&&!e.filters[0].tag.label&&d.a.forEach(e.filters,(function(e){e.tag.label=e.tag.key})),e.group&&e.group.key&&!e.group.label&&(e.group.label=e.group.key),e.metricCategory&&"string"==typeof e.metricCategory&&(e.metricCategory=d.a.find(H,(function(t){return t.key===parseInt(e.metricCategory,10)}))),e.callToEntity&&e.callToEntity.key&&(e.callToEntity=e.callToEntity.key),e.applicationCallToEntity&&e.applicationCallToEntity.key&&(e.applicationCallToEntity=e.applicationCallToEntity.key),e.filters&&e.filters.length>0&&e.filters.forEach((function(e){e.entity&&e.entity.key&&(e.entity=e.entity.key)}))},X=function(e){function t(t){var n=e.call(this,t)||this;return n.options=t.jsonData,n.options.url=function(e){return e.jsonData.useProxy?d.a.trimEnd(e.url,"/ ")+"/instana":d.a.trimEnd(e.jsonData.url,"/ ")}(t),n.availableGranularities=[],n.availableRollups=[],n.availableTimeIntervals=[],n.dataSourceSlo=new j(t.jsonData),n.dataSourceInfrastructure=new K(t.jsonData),n.dataSourceWebsite=new Y(t.jsonData),n.dataSourceMobileapp=new W(t.jsonData),n.dataSourceApplication=new $(t.jsonData),n.dataSourceService=new z(t.jsonData),n.dataSourceEndpoint=new U(t.jsonData),n.resultCache=new F,n}return i(t,e),t.prototype.query=function(e){return s(this,void 0,Promise,(function(){var t,n=this;return u(this,(function(a){return t=e.range,this.timeFilter=v(t),this.availableRollups=M(this.timeFilter),this.availableGranularities=w(this.timeFilter.windowSize),[2,Promise.all(e.targets.map((function(e){var a,r,i=v(t);if(e.hide)return{data:[],target:e};if(Z(e),e.metricCategory||(e.metricCategory=H[0]),n.setPossibleTimeIntervals(e),n.availableTimeIntervals.find((function(t){return t.key===e.timeInterval.key}))||(e.timeInterval=n.getDefaultTimeInterval(e)),e.timeShift){var o=n.convertTimeShiftToMillis(e.timeShift);o>0&&(i=n.applyTimeShiftOnTimeFilter(i,o))}e.timeFilter=i,e.stableHash=(a=e,r=d.a.omit(a,f),r=d.a.mapValues(r,(function(e){return null!=e&&"object"===g(e)&&"key"in e&&(e=e.key),e})),JSON.stringify(r)),i=n.adjustTimeFilterIfCached(i,e);var l=e.metricCategory.key;return 7===l?n.dataSourceSlo.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):8===l?n.dataSourceInfrastructure.runQuery(e,i).then((function(t){return n.buildTarget(e,t)})):0===l||1===l?n.dataSourceInfrastructure.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):3===l?n.dataSourceWebsite.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):9===l?n.dataSourceMobileapp.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):2===l?n.dataSourceApplication.runQuery(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):4===l?n.getApplicationServiceEndpointMetrics(e,i).then((function(t){return n.buildTargetWithAppendedDataResult(e,i,t)})):Promise.resolve(_(e.refId))}))).then((function(e){var t=[];return d.a.each(e,(function(e){var a=d.a.compact(d.a.flatten(e.data));n.cacheResultIfNecessary(d.a.cloneDeep(a),e.target),n.applyTimeShiftIfNecessary(a,e.target),a=n.aggregateDataIfNecessary(a,e.target),t.push(a)})),{data:d.a.flatten(t)}}))]}))}))},t.prototype.getApplicationServiceEndpointMetrics=function(e,t){var n=this;if(B(t.windowSize,C(this.options.queryinterval_limit_app_metrics)))throw new Error("Limit for maximum selectable windowsize exceeded, max is: "+this.options.queryinterval_limit_app_metrics+" hours");return e.endpoint&&e.endpoint.key?this.dataSourceEndpoint.fetchEndpointMetrics(e,t).then((function(t){return x(e,t,n.dataSourceEndpoint.buildEndpointMetricLabel)})):e.service&&e.service.key?this.dataSourceService.fetchServiceMetrics(e,t).then((function(t){return x(e,t,n.dataSourceService.buildServiceMetricLabel)})):e.entity&&e.entity.key?this.dataSourceApplication.fetchApplicationMetrics(e,t).then((function(t){return t.data&&(e.showWarningCantShowAllResults=t.data.canLoadMore),x(e,t,n.dataSourceApplication.buildApplicationMetricLabel)})):Promise.resolve({data:{items:[]}})},t.prototype.applyTimeShiftIfNecessary=function(e,t){var n=this;if(t.timeShift){var a=this.convertTimeShiftToMillis(t.timeShift);a>0&&e.forEach((function(e){n.applyTimeShiftOnData(e,a)}))}},t.prototype.cacheResultIfNecessary=function(e,t){if(this.supportsDeltaRequests(t)&&this.hasResult(e)){var n={timeFilter:t.timeFilter,results:e};this.resultCache.put(t.stableHash,n,4e6)}},t.prototype.supportsDeltaRequests=function(e){var t=this;if(e.metricCategory&&(7===e.metricCategory.key||8===e.metricCategory.key))return!1;var n=this.resultCache.get("version");return n?n>=171:D(this.options).then((function(e){return t.resultCache.put("version",e,4e6),e>=171}))},t.prototype.hasResult=function(e){return e&&e.length>0},t.prototype.applyTimeShiftOnData=function(e,t){e.datapoints.forEach((function(e){e[1]=e[1]+t}))},t.prototype.aggregateDataIfNecessary=function(e,t){var n=[];if(t.aggregateGraphs){var a=J(e,t);return n.push(a),t.hideOriginalGraphs||d.a.each(e,(function(e){e.target!==a.target&&n.push(e)})),n}return e},t.prototype.buildTarget=function(e,t){return{target:e,data:t}},t.prototype.buildTargetWithAppendedDataResult=function(e,t,n){return t.from!==e.timeFilter.from&&n&&(n=this.appendResult(n,e)).forEach((function(t){t.datapoints=t.datapoints.filter((function(t){return t[1]>=e.timeFilter.from}))})),this.buildTarget(e,n)},t.prototype.appendResult=function(e,t){var n,a,r=this.resultCache.get(t.stableHash);return r&&r.results&&(n=e,a=r.results,d.a.each(n,(function(e){var t=d.a.findIndex(a,(function(t){return t.key===e.key&&t.target===e.target}));if(a[t]&&e.datapoints){var n=e.datapoints.concat(a[t].datapoints);n=d.a.sortedUniqBy(n.sort((function(e,t){return e[1]-t[1]})),(function(e){return e[1]})),a[t].datapoints=d.a.takeRight(n,800),a[t].target=e.target}else a.push(e)})),e=a),e},t.prototype.adjustTimeFilterIfCached=function(e,t){var n,a,r=this.resultCache.get(t.stableHash);if(r&&(n=e,a=r.timeFilter,n.from<a.to&&n.from>=a.from&&n.to>=a.to)){var i=function(e,t,n){if("1"===n.key)return t;var a=e[0].datapoints.length;if(a<2)return t;var r=a-2;return e[0].datapoints[r][1]}(r.results,r.timeFilter.from,t.timeInterval),o=1e4*Math.floor(e.to/1e4);return{from:i,to:o,windowSize:o-i}}return e},t.prototype.getSloReports=function(){return this.dataSourceSlo.getConfiguredSLIs()},t.prototype.getEntityTypes=function(){return this.dataSourceInfrastructure.getEntityTypes()},t.prototype.fetchApplications=function(){return this.dataSourceApplication.getApplications(this.getTimeFilter())},t.prototype.fetchApplicationTags=function(){return this.dataSourceApplication.getApplicationTags(this.getTimeFilter())},t.prototype.fetchServices=function(e){return this.dataSourceService.getServicesOfApplication(e,this.getTimeFilter())},t.prototype.fetchEndpoints=function(e){return this.dataSourceEndpoint.getEndpointsOfService(e,this.getTimeFilter())},t.prototype.fetchTypesForTarget=function(e){return this.dataSourceInfrastructure.fetchTypesForTarget(e,this.getTimeFilter())},t.prototype.fetchWebsites=function(){return this.dataSourceWebsite.getWebsites(this.getTimeFilter())},t.prototype.fetchMobileapp=function(){return this.dataSourceMobileapp.getMobileapp(this.getTimeFilter())},t.prototype.fetchMetricsForEntityType=function(e){return this.dataSourceInfrastructure.fetchAvailableMetricsForEntityType(e,this.timeFilter)},t.prototype.getDefaultTimeInterval=function(e){var t=e.metricCategory.key;return 0===t||1===t||8===t?I(this.getTimeFilter()):A(this.getTimeFilter().windowSize)},t.prototype.convertTimeShiftToMillis=function(e){if(!e)return 0;try{return this.parseTimeShift(e)}catch(e){return 0}},t.prototype.parseTimeShift=function(e){return e.endsWith("s")?1e3*parseInt(e.split("s")[0],10):e.endsWith("m")?60*parseInt(e.split("m")[0],10)*1e3:e.endsWith("h")?60*parseInt(e.split("h")[0],10)*60*1e3:e.endsWith("d")?60*parseInt(e.split("d")[0],10)*60*24*1e3:e.endsWith("w")?60*parseInt(e.split("w")[0],10)*60*24*7*1e3:0},t.prototype.applyTimeShiftOnTimeFilter=function(e,t){return{from:e.from-t,to:e.to-t,windowSize:e.windowSize}},t.prototype.setPossibleTimeIntervals=function(e){var t=e.metricCategory.key;this.availableTimeIntervals=0===t||1===t||8===t?this.availableRollups:this.availableGranularities},t.prototype.getTimeFilter=function(){if(!this.timeFilter||!this.timeFilter.from){var e=1e3*Math.floor(Date.now()/1e3);this.timeFilter={from:e-216e5,to:e,windowSize:216e5}}return this.timeFilter},t.prototype.testDatasource=function(){return q(this.options,"/api/infrastructure-monitoring/monitoring-state").then((function(){return{status:"success",message:"Successfully connected to the Instana API.",title:"Success"}}),(function(e){return 401===e.status?{status:"error",message:"Unauthorized. Please verify the API Token.",title:"Error"}:{status:"error",message:"Error ("+e.status+") connecting to the Instana API: "+e.statusText,title:"Error"}}))},t}(a.DataSourceApi),ee=(n(4),n(2)),te=n(0),ne=n.n(te),ae=function(){var e=d.a.get(window,["grafanaBootData","settings","buildInfo","version"],"3.0.0"),t=d.a.split(e,".",2).map((function(e){return parseInt(e,10)}));return e[0]>=6||t[0]>=5&&t[1]>=3},re=function(e){function t(t){var n,a=e.call(this,t)||this;a.onInstanaOptionsChange=function(e,t){var n,r,i=a.props,l=i.options,s=i.onOptionsChange,u=o(o({},l.jsonData),((n={})[t]=e.currentTarget.value,n));if("apiToken"===t){r={apiToken:e.currentTarget.value},delete u.apiToken,l.secureJsonData=r;var c=!!e.currentTarget.value,p=c?e.currentTarget.value:"";a.setState({isApiKeyConfigured:c,apiKeyValue:p})}s(o(o({},l),{jsonData:u,secureJsonData:r})),"url"!==t&&"apiToken"!==t||a.debouncedDetectFeatures(l)},a.onResetAPIKey=function(){var e=a.props,t=e.options;(0,e.onOptionsChange)(o(o({},t),{secureJsonFields:o(o({},t.secureJsonFields),{apiToken:!1}),secureJsonData:o(o({},t.secureJsonData),{apiToken:""})})),a.setState({apiKeyValue:""})},a.onSwitchChange=function(e,t){var n,r=a.props,i=r.options,l=r.onOptionsChange,s=!1;e&&e.currentTarget&&(s=!i.jsonData[t]);var u=o(o({},i.jsonData),((n={})[t]=s,n));l(o(o({},i),{jsonData:u}))},a.debouncedDetectFeatures=function(e){d.a.debounce((function(){return a.detectFeatures(e)}),500)},a.detectFeatures=function(e){var t=e?e.jsonData:a.props.options.jsonData;t&&t.url&&(a.setState({canUseProxy:ae()}),D(t).then((function(e){e?a.setState({canQueryOfflineSnapshots:e>=156}):a.setState({canQueryOfflineSnapshots:!1})})))},a.state={canQueryOfflineSnapshots:!1,canUseProxy:!1,isApiKeyConfigured:!1,apiKeyValue:""},a.detectFeatures();var r=a.props,i=r.options,l=r.onOptionsChange,s=i.jsonData;void 0===s.useProxy&&(s.useProxy=ae()),s.useProxy=!0;var u=!!(null===(n=i.secureJsonData)||void 0===n?void 0:n.apiToken),c=u?"********":"";return a.setState({isApiKeyConfigured:u,apiKeyValue:c}),l(o(o({},i),{jsonData:s})),a}return i(t,e),t.prototype.render=function(){var e,t,n=this,a=this.props.options,r=a.jsonData,i=this.state.apiKeyValue;return ne.a.createElement("div",{className:"settings"},ne.a.createElement(ee.Legend,null,"Instana configuration"),ne.a.createElement(ee.Field,{className:"width-30",horizontal:!0,required:!0,label:"URL",description:"The URL of your Instana installation."},ne.a.createElement(ee.Input,{width:30,value:r.url,placeholder:"https://tools-acme.instana.io",onChange:function(e){return n.onInstanaOptionsChange(e,"url")}})),ne.a.createElement(ee.Field,{style:{width:"637px"},horizontal:!0,required:!0,label:"API Token",description:"The API token to access the data."},ne.a.createElement("div",{style:{display:"flex"}},ne.a.createElement(ee.Input,{type:"password",width:30,value:i,placeholder:(null===(e=a.secureJsonFields)||void 0===e?void 0:e.apiToken)?"Configured":"Enter API Key",readOnly:null===(t=a.secureJsonFields)||void 0===t?void 0:t.apiToken,suffix:ne.a.createElement(ee.Tooltip,{content:ne.a.createElement("p",null,"You can create API tokens following the instructions at ",ne.a.createElement("a",{href:"https://www.ibm.com/docs/en/obi/current?topic=apis-web-rest-api#unit-specific-api-tokens"},"https://www.ibm.com/docs/en/obi/current?topic=apis-web-rest-api")),theme:"info"},ne.a.createElement(ee.Icon,{name:"info-circle"})),onChange:function(e){return n.onInstanaOptionsChange(e,"apiToken")}}),ne.a.createElement("div",{style:{marginLeft:"15px"}},ne.a.createElement(ee.Button,{onClick:this.onResetAPIKey},"Reset API Token")))),ne.a.createElement(ee.Checkbox,{label:"Use Proxy",value:!0,disabled:!0,description:"The only way to use the API token for authentication in Grafana is through Use-Proxy. Needs Grafana 10.0.0+ and Instana datasource 4.0.0+"}),ne.a.createElement(ee.Checkbox,{label:"Enable offline snapshots",value:r.showOffline,onChange:function(e){return n.onSwitchChange(e,"showOffline")},description:"Enables querying offline snapshots. Needs Instana release 260+ and Instana datasource 3.3.0+"}),ne.a.createElement(ee.Checkbox,{label:"Enable Infrastructure Analyze category",value:r.allowInfraExplore,onChange:function(e){return n.onSwitchChange(e,"allowInfraExplore")},description:"Adds a new category that allows usage of Infrastructure Analyze functionality. Needs Instana release 195+ and an explicit feature flag. If you are interested in this technology, please submit a request via our support system at https://support.instana.com/."}),ne.a.createElement("br",null),ne.a.createElement("br",null),ne.a.createElement("b",null,"Maximum query intervals in hours"),ne.a.createElement("p",{className:"width-30"},"This settings are optional values to control the load of data queries, by defining the maximum allowed query intervals against the Instana API."),ne.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Infrastructure metrics"},ne.a.createElement(ee.Input,{width:30,value:r.queryinterval_limit_infra,placeholder:"optional: interval limit in hours",onChange:function(e){return n.onInstanaOptionsChange(e,"queryinterval_limit_infra")}})),ne.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Application metrics"},ne.a.createElement(ee.Input,{width:30,value:r.queryinterval_limit_app_metrics,placeholder:"optional: interval limit in hours",onChange:function(e){return n.onInstanaOptionsChange(e,"queryinterval_limit_app_metrics")}})),ne.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Analyze application calls"},ne.a.createElement(ee.Input,{width:30,value:r.queryinterval_limit_app_calls,placeholder:"optional: interval limit in hours",onChange:function(e){return n.onInstanaOptionsChange(e,"queryinterval_limit_app_calls")}})),ne.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Analyze website"},ne.a.createElement(ee.Input,{width:30,value:r.queryinterval_limit_website_metrics,placeholder:"optional: interval limit in hours",onChange:function(e){return n.onInstanaOptionsChange(e,"queryinterval_limit_website_metrics")}})),ne.a.createElement(ee.Field,{className:"width-30",horizontal:!0,label:"Analyze mobile app"},ne.a.createElement(ee.Input,{width:30,value:r.queryinterval_limit_mobileapp_metrics,placeholder:"optional: interval limit in hours",onChange:function(e){return n.onInstanaOptionsChange(e,"queryinterval_limit_mobileapp_metrics")}})))},t}(te.PureComponent);n(9);function ie(e){var t={display:"flex"};return e.disabled&&(t.opacity="0.4",t.pointerEvents="none"),e.stretch&&(t.width="100%"),ne.a.createElement("div",{style:t},e.children)}var oe=ee.LegacyForms.Switch,le=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.queryKeyword,r=e.disabled,i=e.labelWidth,s=void 0===i?14:i,u=e.value,c=l(e,["label","tooltip","queryKeyword","disabled","labelWidth","value"]);return ne.a.createElement(ie,{disabled:r,stretch:!1},ne.a.createElement(ee.InlineFormLabel,{className:a?"query-keyword":"",width:s,tooltip:n},t),ne.a.createElement(oe,o({checked:u,label:""},c)))},t}(ne.a.Component),se=function(e){function t(t){var n=e.call(this,t)||this;return n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onUseFreeTextMetricsChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.loadEntityTypes;e&&e.currentTarget&&(a.useFreeTextMetrics=e.currentTarget.checked,a.useFreeTextMetrics?(i(!1),a.metric={}):i(!0),r(a))},n.onFreeTextMetricsChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.freeTextMetrics=e.currentTarget.value,r(a),n.debouncedRunQuery()},n}return i(t,e),t.prototype.render=function(){var e=this.props.query;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(le,{queryKeyword:!0,label:"Enable free text metrics",tooltip:"Specify comma separated metrics directly in this text field. Once this field has a value, selected metrics from above will be ignored. Enabled as soon as a query is entered. Max 4 metrics supported.",value:e.useFreeTextMetrics,onChange:this.onUseFreeTextMetricsChange,disabled:!1}),ne.a.createElement(ee.Input,{width:0,disabled:!e.useFreeTextMetrics,value:e.freeTextMetrics,placeholder:"metric.one,metric.two,metric.three",onChange:this.onFreeTextMetricsChange}))},t}(ne.a.Component),ue=[{label:"SUM"},{label:"MEAN"},{label:"MIN"},{label:"MAX"}],ce=function(e){function t(t){var n=e.call(this,t)||this;n.onAggregateGraphs=function(e){var t=n.props,a=t.query,r=t.onRunQuery;e&&e.currentTarget&&(a.aggregateGraphs=e.currentTarget.checked,r())},n.onHideOriginalGraph=function(e){var t=n.props,a=t.query,r=t.onRunQuery;e&&e.currentTarget&&(a.hideOriginalGraphs=e.currentTarget.checked,r())},n.onAggregationFunctionChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery;a.aggregationFunction=e,r()},n.state={showAdditionalSettings:!1,legendFormat:""};var a=n.props.query;return a.aggregationFunction||(a.aggregationFunction=ue[0]),n}return i(t,e),t.prototype.render=function(){var e=this.props.query;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(le,{queryKeyword:!0,label:"Aggregate query graphs",tooltip:"Aggregate all graphs of a query.",value:e.aggregateGraphs,onChange:this.onAggregateGraphs}),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:12,isSearchable:!0,options:ue,value:e.aggregationFunction,disabled:!e.aggregateGraphs,onChange:this.onAggregationFunctionChange}),ne.a.createElement(le,{queryKeyword:!0,disabled:!e.aggregateGraphs,labelWidth:10,label:"Hide original graphs",tooltip:"Removes the original graphs resulted from the query and only shows the aggregated graph.",value:e.hideOriginalGraphs,onChange:this.onHideOriginalGraph}))},t}(ne.a.Component),pe=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.queryKeyword,r=e.disabled,i=e.labelWidth,s=void 0===i?14:i,u=e.inputWidth,c=void 0===u?30:u,p=l(e,["label","tooltip","queryKeyword","disabled","labelWidth","inputWidth"]);return ne.a.createElement(ie,{disabled:r,stretch:!c},ne.a.createElement(ee.InlineFormLabel,{className:a?"query-keyword":"",width:s,tooltip:n},t),ne.a.createElement(ee.Input,o({width:c,disabled:r},p)))},t}(ne.a.Component),ye=["$label (on host $host)","$label (on host $host)","$label ($application) - $key","$label ($website) - $key","$label ($application) - $key","","",""],he=[ne.a.createElement("div",{key:"builtIn"},"Default: $label (on host $host)",ne.a.createElement("ul",null,ne.a.createElement("li",null,"• $label - entity label"),ne.a.createElement("li",null,"• $host - corresponding host"),ne.a.createElement("li",null,"• $pid - corresponding PID"),ne.a.createElement("li",null,"• $timeShift - corresponding timeShift"),ne.a.createElement("li",null,"• $metric - displayed metric"),ne.a.createElement("li",null,"• $type - entity type"),ne.a.createElement("li",null,"• $service - service label"),ne.a.createElement("li",null,"• $name - label alternative"),ne.a.createElement("li",null,"• $index - index in the list"))),ne.a.createElement("div",{key:"custom"},"Default: $label (on host $host)",ne.a.createElement("ul",null,ne.a.createElement("li",null,"• $label - entity label"),ne.a.createElement("li",null,"• $host - corresponding host"),ne.a.createElement("li",null,"• $pid - corresponding PID"),ne.a.createElement("li",null,"• $timeShift - corresponding timeShift"),ne.a.createElement("li",null,"• $metric - displayed metric"),ne.a.createElement("li",null,"• $type - entity type"),ne.a.createElement("li",null,"• $service - service label"),ne.a.createElement("li",null,"• $name - label alternative"),ne.a.createElement("li",null,"• $index - index in the list"))),ne.a.createElement("div",{key:"application"},"Default: $label ($application) - $key",ne.a.createElement("ul",null,ne.a.createElement("li",null,"• $label - entity label"),ne.a.createElement("li",null,"• $application - application label"),ne.a.createElement("li",null,"• $timeShift - corresponding timeShift"),ne.a.createElement("li",null,"• $metric - displayed metric"),ne.a.createElement("li",null,"• $key - metric key with aggregation and rollup"),ne.a.createElement("li",null,"• $index - index in the list"))),ne.a.createElement("div",{key:"website"},"Default: $label ($website) - $key",ne.a.createElement("ul",null,ne.a.createElement("li",null,"• $label - entity label"),ne.a.createElement("li",null,"• $website - application label"),ne.a.createElement("li",null,"• $type - entity type"),ne.a.createElement("li",null,"• $timeShift - corresponding timeShift"),ne.a.createElement("li",null,"• $metric - displayed metric"),ne.a.createElement("li",null,"• $key - metric key with aggregation and rollup"),ne.a.createElement("li",null,"• $index - index in the list"))),ne.a.createElement("div",{key:"endpoint"},"Default: $label ($application) - $key",ne.a.createElement("ul",null,ne.a.createElement("li",null,"• $label - entity label"),ne.a.createElement("li",null,"• $application - application label"),ne.a.createElement("li",null,"• $service - service label"),ne.a.createElement("li",null,"• $endpoint - endpoint label"),ne.a.createElement("li",null,"• $timeShift - corresponding timeShift"),ne.a.createElement("li",null,"• $metric - displayed metric"),ne.a.createElement("li",null,"• $key - metric key with aggregation and rollup"),ne.a.createElement("li",null,"• $index - index in the list"))),"","",""],de=function(e){function t(t){var n=e.call(this,t)||this;return n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onLegendFormatChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.labelFormat=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.onTimeShiftChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.timeShift=e.currentTarget.value,a.timeShift?a.timeShiftIsValid=!!a.timeShift.match(/\d+[m,s,h,d,w]{1}/):a.timeShiftIsValid=!0,r(a),a.timeShiftIsValid&&n.debouncedRunQuery()},n.onShowAdvancedSettingsChange=function(e){if(e&&e.currentTarget){var t=n.props,a=t.query,r=t.onChange;a.showAdvancedSettings=e.currentTarget.checked,r(a)}},n.state={legendFormatPlaceholder:n.setLegendFormatPlaceholder()},n}return i(t,e),t.prototype.setLegendFormatPlaceholder=function(){var e=this.props.query;return ye[e.metricCategory.key]},t.prototype.setLegendFormatTooltip=function(){var e=this.props.query;return he[e.metricCategory.key]},t.prototype.render=function(){var e=this,t=this.props,n=t.query,a=t.onRunQuery,r=t.onChange,i=t.loadEntityTypes,o=n.metricCategory.key;return ne.a.createElement("div",null,ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(le,{label:"Show advanced settings",tooltip:"Show all additional settings",value:n.showAdvancedSettings,onChange:function(t){return e.onShowAdvancedSettingsChange(t)}})),ne.a.createElement("div",{hidden:!n.showAdvancedSettings},ne.a.createElement("div",{className:"gf-form",hidden:7===o||8===o},ne.a.createElement(pe,{queryKeyword:!0,inputWidth:0,label:"Legend format",tooltip:this.setLegendFormatTooltip(),value:n.labelFormat,placeholder:this.setLegendFormatPlaceholder(),onChange:function(t){return e.onLegendFormatChange(t)}})),ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(pe,{queryKeyword:!0,inputWidth:0,label:"Time shift",tooltip:"Specify the amount of hours that shall be used. The time shift function always go back in time, not forward. Accepts values such as 1s, 1m, 1h, 1d, 1w.",value:n.timeShift,invalid:!n.timeShiftIsValid,placeholder:"1h",onChange:function(t){return e.onTimeShiftChange(t)}})),ne.a.createElement("div",{hidden:1!==o},ne.a.createElement(se,{query:n,onRunQuery:a,onChange:r,loadEntityTypes:i})),ne.a.createElement("div",{hidden:0!==o&&1!==o},ne.a.createElement(ce,{query:n,onRunQuery:a,onChange:r}))))},t}(ne.a.Component),ge=["DESTINATION","SOURCE"],fe={position:"relative",background:"transparent",width:"32px",height:"32px",marginRight:"4px"},me={transition:"max-height .2s ease-out",maxHeight:0,overflow:"hidden",zIndex:1,position:"fixed"},ve={overflow:"hidden",zIndex:2,position:"fixed",maxHeight:"1000px",opacity:1},be={display:"inline-flex"},Se={display:"flex",alignItems:"center",justifyContent:"center"},Te={padding:"7px"},Ce=ne.a.createElement("svg",{style:Se,height:30,width:30},ne.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M4 11.173h6.38L8.115 8.92 9.042 8l3.704 3.684-3.704 3.684-.926-.92 2.263-2.252H4zM16.43 14.316c-1.426 0-2.632-1.206-2.632-2.632 0-1.425 1.206-2.631 2.632-2.631 1.425 0 2.631 1.206 2.631 2.631 0 1.426-1.206 2.632-2.631 2.632z"})),Ee=ne.a.createElement("svg",{style:Se,height:30,width:30},ne.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M9.939 11.173h6.379L14.054 8.92 14.98 8l3.704 3.684-3.704 3.684-.926-.92 2.264-2.252h-6.38c-.308 1.023-1.234 1.842-2.366 1.842C6.132 14.243 5 13.117 5 11.787c0-1.33 1.132-2.457 2.47-2.457 1.234 0 2.16.717 2.469 1.843z"}));function ke(e){var t={background:Object(ee.useTheme)().colors.bg2,cursor:"pointer",listStyle:"none",borderRadius:"3px",height:"32px"},n=c(Object(te.useState)(!1),2),a=n[0],r=n[1];function i(t){e.onChange(t),r(!1)}return ne.a.createElement("div",{style:fe},ne.a.createElement("div",{onClick:function(){r(!a)},onBlur:function(){return r(!1)},style:t,contentEditable:!0},ne.a.createElement(ee.Tooltip,{content:e.value,theme:"info",placement:"top"},"DESTINATION"===e.value?Ce:Ee)),ne.a.createElement("ul",{style:a?ve:me},ne.a.createElement("li",{onClick:function(){return i("DESTINATION")},key:"DESTINATION",style:t},ne.a.createElement("div",{style:be},Ce," ",ne.a.createElement("span",{style:Te},"DESTINATION"))),ne.a.createElement("li",{onClick:function(){return i("SOURCE")},key:"SOURCE",style:t},ne.a.createElement("div",{style:be},Ee," ",ne.a.createElement("span",{style:Te},"SOURCE")))))}var Ae=!1,we=function(e){function t(t){var n=e.call(this,t)||this;return n.onApplicationChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,r(a),i()},n.onGroupChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.group=e,a.group&&2===a.metricCategory.key&&(a.showGroupBySecondLevel="KEY_VALUE_PAIR"===a.group.type),a.showGroupBySecondLevel||(a.groupbyTagSecondLevelKey=""),r(a),i()},n.onApplicationCallToEntityChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.applicationCallToEntity=e,r(a),i()},n.onCallToEntityChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.callToEntity=e,r(a),i()},n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.state={applications:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.datasource,r=t.onChange;Ae=!1,a.fetchApplications().then((function(t){Ae||(d.a.find(t,{key:null})||t.unshift({key:null,label:p}),e.setState({applications:t}),n.entity&&(n.entity.key||n.entity.label)||(n.entity=t[0]),n.callToEntity||(n.callToEntity=ge[0]),n.applicationCallToEntity||(n.applicationCallToEntity=ge[0]),r(n))})),a.fetchApplicationTags().then((function(t){Ae||(e.props.updateGroups(d.a.sortBy(t,"key")),n.group&&n.group.key||(n.group=d.a.find(t,["key","endpoint.name"]),r(n)))})),this.props.updateMetrics(a.dataSourceApplication.getApplicationMetricsCatalog())},t.prototype.componentWillUnmount=function(){Ae=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.groups;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(ie,{stretch:!0},ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Select your application."},"Application"),ne.a.createElement(ke,{value:t.applicationCallToEntity,onChange:this.onApplicationCallToEntityChange}),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:t.entity,options:this.state.applications,onChange:this.onApplicationChange})),ne.a.createElement(ie,{stretch:!0},ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:7,tooltip:"Group by tag."},"Group by"),ne.a.createElement(ke,{value:t.callToEntity,onChange:this.onCallToEntityChange}),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,options:n,value:t.group,onChange:this.onGroupChange})),ne.a.createElement("div",{style:t.showGroupBySecondLevel?{}:{display:"none"}},ne.a.createElement(ee.Input,{type:"text",value:t.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(ne.a.Component),Ie=(n(11),{position:"relative",background:"transparent",width:"32px",height:"32px",marginRight:"4px"}),Me=ne.a.createElement("svg",{className:"iconStyle",height:30,width:30},ne.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M12.7891666,14.6051302 L12.7751756,19.8293818 L11.4691127,19.8328795 L11.4776628,16.6402814 L6.96695389,21.1509902 L6.2433066,20.427343 L10.7540155,15.9166341 L7.56141732,15.9251842 L7.56491507,14.6191213 L12.7891666,14.6051302 Z M15.754133,9.38135895 C17.1795716,9.38135895 18.3857119,10.5874993 18.3857119,12.0129379 C18.3857119,13.4383765 17.1795716,14.6445168 15.754133,14.6445168 C14.3286944,14.6445168 13.122554,13.4383765 13.122554,12.0129379 C13.122554,10.5874993 14.3286944,9.38135895 15.754133,9.38135895 Z M6.96695389,3.2433066 L11.4776628,7.75401547 L11.4691127,4.56141732 L12.7751756,4.56491507 L12.7891666,9.7891666 L7.56491507,9.77517557 L7.56141732,8.46911269 L10.7540155,8.47766276 L6.2433066,3.96695389 L6.96695389,3.2433066 Z"})),Re=ne.a.createElement("svg",{className:"iconStyle",height:30,width:30},ne.a.createElement("path",{transform:"translate(3, 5)",fill:"#33a2e5",d:"M7.54586,15 L7.53186897,20.2242515 L6.22580608,20.2277493 L6.23435616,17.0351511 L1.72364729,21.54586 L1,20.8222127 L5.51070887,16.3115038 L2.31811071,16.3200539 L2.32160847,15.013991 L7.54586,15 Z M14.1975552,7.94441147 L17.901552,11.628622 L14.1975552,15.3128325 L13.271556,14.3917799 L15.5351096,12.1403179 L12.4724561,12.1407167 C12.2827518,13.474447 11.1361413,14.5 9.75,14.5 C8.23121694,14.5 7,13.2687831 7,11.75 C7,10.2312169 8.23121694,9 9.75,9 C11.0508538,9 12.1407461,9.90323356 12.4267385,11.1167623 L15.5351096,11.1169261 L13.271556,8.8654641 L14.1975552,7.94441147 Z M20.75,9 C22.2687831,9 23.5,10.2312169 23.5,11.75 C23.5,13.2687831 22.2687831,14.5 20.75,14.5 C19.2312169,14.5 18,13.2687831 18,11.75 C18,10.2312169 19.2312169,9 20.75,9 Z M1.72364729,2 L6.23435616,6.51070887 L6.22580608,3.31811071 L7.53186897,3.32160847 L7.54586,8.54586 L2.32160847,8.53186897 L2.31811071,7.22580608 L5.51070887,7.23435616 L1,2.72364729 L1.72364729,2 Z"}));function qe(e){var t=Object(ee.useTheme)(),n=e.disabled?.5:1,a={background:t.colors.bg2,cursor:"pointer",listStyle:"none",borderRadius:"3px",height:"32px",opacity:n},r=c(Object(te.useState)(!1),2),i=r[0],o=r[1];function l(t){e.onChange(t),o(!1)}return ne.a.createElement("div",{style:Ie},ne.a.createElement("div",{onClick:function(){e.disabled||o(!i)},onBlur:function(){return o(!1)},style:a,contentEditable:!0},ne.a.createElement(ee.Tooltip,{content:e.value?e.value:"ALL",theme:"info",placement:"top"},"INBOUND"===e.value?Me:Re)),ne.a.createElement("ul",{className:i?"dropdown-list-active":"dropdown-list"},ne.a.createElement("li",{onClick:function(){return l("INBOUND")},key:"INBOUND",style:a},ne.a.createElement("div",{className:"iconTextContainer"},Me," ",ne.a.createElement("span",{className:"iconTextStyle"},"INBOUND"))),ne.a.createElement("li",{onClick:function(){return l("ALL")},key:"ALL",style:a},ne.a.createElement("div",{className:"iconTextContainer"},Re," ",ne.a.createElement("span",{className:"iconTextStyle"},"ALL")))))}var Oe=!1,Le=function(e){function t(t){var n=e.call(this,t)||this;return n.onApplicationChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,""!==e.boundaryScope?a.applicationBoundaryScope=e.boundaryScope:"ALL"!==a.applicationBoundaryScope&&"INBOUND"!==a.applicationBoundaryScope&&(a.applicationBoundaryScope="INBOUND"),r(a),n.loadServices(),n.loadEndpoints(),i()},n.onServiceChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.service=e,r(a),n.loadEndpoints(),i()},n.onEndpointChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.endpoint=e,r(a),i()},n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.onApplicationBoundaryScopeChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.applicationBoundaryScope=e,r(a),n.loadServices(),n.loadEndpoints(),i()},n.state={applications:[],services:[],endpoints:[],value:{value:2,imgUrl:"../../resources/dest.png"}},n}return i(t,e),t.prototype.componentDidMount=function(){Oe=!1,this.loadApplications(),this.loadServices(),this.loadEndpoints();var e=this.props.datasource;this.props.updateMetrics(e.dataSourceApplication.getApplicationMetricsCatalog())},t.prototype.componentWillUnmount=function(){Oe=!0},t.prototype.loadApplications=function(){var e=this,t=this.props,n=t.query,a=t.onChange;t.datasource.fetchApplications().then((function(t){Oe||(d.a.find(t,{key:null})||t.unshift({key:null,label:p}),e.setState({applications:t}),n.entity&&n.entity.key&&!d.a.find(t,(function(e){return e.key===n.entity.key}))?n.entity=t[0]:n.entity&&n.entity.key||!t||(n.entity=t[0]),a(n))}))},t.prototype.loadServices=function(){var e=this,t=this.props,n=t.query,a=t.onChange;t.datasource.fetchServices(n).then((function(t){Oe||(d.a.find(t,{key:null})||t.unshift({key:null,label:"-- No Service Filter --"}),e.setState({services:t}),n.service&&n.service.key&&d.a.find(t,(function(e){return e.key===n.service.key}))||(n.service=t[0]),a(n))}))},t.prototype.loadEndpoints=function(){var e=this,t=this.props,n=t.query,a=t.onChange;t.datasource.fetchEndpoints(n).then((function(t){Oe||(d.a.find(t,{key:null})||t.unshift({key:null,label:y}),e.setState({endpoints:t}),n.endpoint&&n.endpoint.key&&d.a.find(t,(function(e){return e.key===n.endpoint.key}))||(n.endpoint={key:null,label:y}),a(n))}))},t.prototype.render=function(){var e,t=this.props.query;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Select your application."},"Application"),ne.a.createElement(qe,{value:t.applicationBoundaryScope,disabled:!(null===(e=t.entity)||void 0===e?void 0:e.key),onChange:this.onApplicationBoundaryScopeChange}),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:t.entity,options:this.state.applications,onChange:this.onApplicationChange}),ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:6,tooltip:"Select your service."},"Service"),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:t.service,options:this.state.services,onChange:this.onServiceChange}),ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:6,tooltip:"Select your endpoint."},"Endpoint"),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:t.endpoint,options:this.state.endpoints,onChange:this.onEndpointChange}),ne.a.createElement("div",{style:t.showGroupBySecondLevel?{}:{display:"none"}},ne.a.createElement(ee.Input,{value:t.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(ne.a.Component),Fe=!1,Ne=function(e){function t(t){var n=e.call(this,t)||this;return n.onEntityChange=function(e){var t=n.props,a=t.query,r=t.datasource,i=t.onChange,o=t.onRunQuery;a.entity=e,i(a),o(),r.fetchMetricsForEntityType(a).then((function(e){n.props.updateMetrics(e)}))},n.onInfraCallToEntityChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.applicationCallToEntity=e,r(a),i()},n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onCallToEntityChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.callToEntity=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.group={key:e.currentTarget.value,label:e.currentTarget.value,type:"STRING"},a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.state={entityTypes:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.datasource,r=t.onChange;Fe=!1,a.getEntityTypes().then((function(t){Fe||(d.a.find(t,{key:null})||t.unshift({key:null,label:"Please specify"}),e.setState({entityTypes:t}),n.entity&&(n.entity.key||n.entity.label)||(n.entity=t[0]),n.callToEntity||(n.callToEntity=ge[0]),n.applicationCallToEntity||(n.applicationCallToEntity=ge[0]),r(n))}))},t.prototype.componentWillUnmount=function(){Fe=!0},t.prototype.render=function(){var e=this.props.query;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(ie,{stretch:!0},ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Select your Entity Type."},"Entity types"),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:0,isSearchable:!0,value:e.entity,options:this.state.entityTypes,onChange:this.onEntityChange})),ne.a.createElement(ie,{stretch:!0},ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:7,tooltip:"Enter the Group by tag."},"Group by"),ne.a.createElement(ee.Input,{type:"text",value:e.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(ne.a.Component),xe=[{key:"EQUALS",label:"equals",type:"STRING"},{key:"NOT_EQUAL",label:"does not equal",type:"STRING"},{key:"CONTAINS",label:"contains",type:"STRING"},{key:"NOT_CONTAIN",label:"does not contain",type:"STRING"},{key:"NOT_EMPTY",label:"is present",type:"STRING"},{key:"IS_EMPTY",label:"is not present",type:"STRING"},{key:"STARTS_WITH",label:"starts with",type:"STRING"},{key:"ENDS_WITH",label:"ends with",type:"STRING"},{key:"NOT_STARTS_WITH",label:"does not start with",type:"STRING"},{key:"NOT_ENDS_WITH",label:"does not end with",type:"STRING"},{key:"EQUALS",label:"=",type:"NUMBER"},{key:"NOT_EQUAL",label:"!=",type:"NUMBER"},{key:"LESS_THAN",label:"<",type:"NUMBER"},{key:"GREATER_THAN",label:">",type:"NUMBER"},{key:"IS_EMPTY",label:"is empty",type:"NUMBER"},{key:"NOT_EMPTY",label:"is not empty",type:"NUMBER"},{key:"LESS_OR_EQUAL_THAN",label:"less or equal than",type:"NUMBER"},{key:"GREATER_OR_EQUAL_THAN",label:"greater or equal than",type:"NUMBER"},{key:"EQUALS",label:"is",type:"BOOLEAN"},{key:"EQUALS",label:"equals",type:"KEY_VALUE_PAIR"},{key:"NOT_EQUAL",label:"does not equal",type:"KEY_VALUE_PAIR"},{key:"CONTAINS",label:"contains",type:"KEY_VALUE_PAIR"},{key:"NOT_CONTAIN",label:"does not contain",type:"KEY_VALUE_PAIR"},{key:"NOT_EMPTY",label:"is present",type:"KEY_VALUE_PAIR"},{key:"IS_EMPTY",label:"is not present",type:"KEY_VALUE_PAIR"},{key:"STARTS_WITH",label:"starts with",type:"KEY_VALUE_PAIR"},{key:"ENDS_WITH",label:"ends with",type:"KEY_VALUE_PAIR"},{key:"IS_BLANK",label:"is blank",type:"KEY_VALUE_PAIR"},{key:"NOT_BLANK",label:"is not blank",type:"KEY_VALUE_PAIR"},{key:"EQUALS",label:"equals",type:"STRING_SET"},{key:"NOT_EQUAL",label:"does not equal",type:"STRING_SET"},{key:"CONTAINS",label:"contains",type:"STRING_SET"},{key:"NOT_CONTAIN",label:"does not contain",type:"STRING_SET"},{key:"NOT_EMPTY",label:"is present",type:"STRING_SET"},{key:"IS_EMPTY",label:"is not present",type:"STRING_SET"}],_e=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.queryKeyword,r=e.disabled,i=e.labelWidth,s=void 0===i?14:i,u=e.inputWidth,c=void 0===u?30:u,p=l(e,["label","tooltip","queryKeyword","disabled","labelWidth","inputWidth"]);return ne.a.createElement(ie,{disabled:r,stretch:!c},ne.a.createElement(ee.InlineFormLabel,{className:a?"query-keyword":"",width:s,tooltip:n},t),ne.a.createElement(ee.TextArea,o({rows:4,width:c,disabled:r},p)))},t}(ne.a.Component),Pe=function(e){function t(t){var n=e.call(this,t)||this;return n.OPERATOR_STRING="STRING",n.OPERATOR_STRING_SET="STRING_SET",n.OPERATOR_NUMBER="NUMBER",n.OPERATOR_BOOLEAN="BOOLEAN",n.OPERATOR_KEY_VALUE="KEY_VALUE_PAIR",n.addTagFilter=function(){var e=n.props,t=e.query,a=e.onChange;t.filters.push({tag:t.group,entity:ge[0],operator:n.filterOperatorsOnType(t.group.type)[0],booleanValue:!1,numberValue:0,stringValue:"",isValid:!1}),a(t)},n.removeTagFilter=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.filters.splice(e,1),r(a),i()},n.onCallToEntityChange=function(e,t){n.props.query.filters[t].entity=e,n.validateChangeAndRun(t)},n.onOperatorChange=function(e,t){n.props.query.filters[t].operator=e,n.validateChangeAndRun(t)},n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onTagFilterStringValueChange=function(e,t){n.props.query.filters[t].stringValue=e.currentTarget.value,n.validateChangeAndRun(t,!0)},n.onTagFilterNumberValueChange=function(e,t){n.props.query.filters[t].numberValue=e.currentTarget.valueAsNumber,n.validateChangeAndRun(t,!0)},n.onFilterChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery,o=e.currentTarget.value;n.setState({textareaValue:e.currentTarget.value}),""!==o.trim()?a.filters=JSON.parse(o):a.filters=[],r(a),n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),i()},n.state={textareaValue:""},n}return i(t,e),t.prototype.filterOperatorsOnType=function(e){return d.a.filter(xe,(function(t){return t.type===e}))},t.prototype.onGroupChange=function(e,t){var n=this.props.query;n.filters[t].tag=e;var a=this.filterOperatorsOnType(e.type);d.a.includes(a,n.filters[t].operator)||(n.filters[t].operator=a[0]),this.validateChangeAndRun(t)},t.prototype.canShowStringInput=function(e){return e.tag.type===this.OPERATOR_KEY_VALUE||!e.operator.key.includes("EMPTY")&&(e.tag.type===this.OPERATOR_STRING||e.tag.type===this.OPERATOR_STRING_SET)},t.prototype.canShowNumberInput=function(e){return e.tag.type===this.OPERATOR_NUMBER&&!e.operator.key.includes("EMPTY")},t.prototype.onTagFilterBooleanValueChange=function(e,t){this.props.query.filters[t].booleanValue=e.key,this.validateChangeAndRun(t)},t.prototype.validateChangeAndRun=function(e,t){void 0===t&&(t=!1);var n=this.props,a=n.query,r=n.onChange,i=n.onRunQuery;a.filters[e].tag?!a.filters[e].operator.key.includes("EMPTY")||this.OPERATOR_STRING!==a.filters[e].tag.type&&this.OPERATOR_STRING_SET!==a.filters[e].tag.type?this.OPERATOR_STRING!==a.filters[e].tag.type&&this.OPERATOR_STRING_SET!==a.filters[e].tag.type||!a.filters[e].stringValue?a.filters[e].operator.key.includes("EMPTY")&&this.OPERATOR_KEY_VALUE===a.filters[e].tag.type&&a.filters[e].stringValue||this.OPERATOR_KEY_VALUE===a.filters[e].tag.type&&a.filters[e].stringValue&&a.filters[e].stringValue.includes("=")?a.filters[e].isValid=!0:this.OPERATOR_NUMBER!==a.filters[e].tag.type||isNaN(a.filters[e].numberValue)?this.OPERATOR_BOOLEAN===a.filters[e].tag.type&&void 0!==a.filters[e].booleanValue&&(a.filters[e].isValid=!0):a.filters[e].isValid=!0:a.filters[e].isValid=!0:(a.filters[e].isValid=!0,a.filters[e].stringValue="",a.filters[e].numberValue=0,a.filters[e].booleanValue=!0):a.filters[e].isValid=!1,r(a),t?this.debouncedRunQuery():i()},t.prototype.render=function(){var e,t=this,n=this.props,a=n.query,r=n.groups;if(8===a.metricCategory.key)return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(_e,{queryKeyword:!0,inputWidth:0,label:"TagFilterExpression",tooltip:"Enter the tagFilterExpression here ",placeholder:"[{Enter the filter JSON here}]",value:this.state.textareaValue,onChange:function(e){return t.onFilterChange(e)}}));var i=null===(e=a.filters)||void 0===e?void 0:e.map((function(e,n){return ne.a.createElement("div",{key:"filter_"+n,className:"gf-form"},ne.a.createElement(ee.InlineFormLabel,{className:"query-keyword",width:14,tooltip:"Filter by tag."},n+1,". filter"),2===a.metricCategory.key&&ne.a.createElement(ke,{value:a.filters[n].entity,onChange:function(e){return t.onCallToEntityChange(e,n)}}),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:30,isSearchable:!0,value:a.filters[n].tag,options:r,onChange:function(e){return t.onGroupChange(e,n)}}),ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:20,isSearchable:!0,value:a.filters[n].operator,options:t.filterOperatorsOnType(a.filters[n].tag.type),onChange:function(e){return t.onOperatorChange(e,n)}}),t.canShowStringInput(a.filters[n])&&ne.a.createElement(ee.Input,{width:30,value:a.filters[n].stringValue,placeholder:"KEY_VALUE_PAIR"===a.filters[n].tag.type?"key=value":"Please specify",onChange:function(e){return t.onTagFilterStringValueChange(e,n)}}),t.canShowNumberInput(a.filters[n])&&ne.a.createElement(ee.Input,{type:"number",width:30,value:a.filters[n].numberValue,placeholder:"Please specify",onChange:function(e){return t.onTagFilterNumberValueChange(e,n)}}),"BOOLEAN"===a.filters[n].tag.type&&ne.a.createElement(ee.Select,{menuPlacement:"bottom",width:30,isSearchable:!0,onChange:function(e){return t.onTagFilterBooleanValueChange(e,n)},value:{key:""+a.filters[n].booleanValue,label:""+a.filters[n].booleanValue},options:[{key:!1,label:"false"},{key:!0,label:"true"}]}),ne.a.createElement(ee.Button,{variant:"secondary",onClick:function(){return t.removeTagFilter(n)}},"-"))}));return ne.a.createElement("div",null,i,ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(ee.InlineFormLabel,{width:14,tooltip:"Add an additional tag filter."},"Add filter"),ne.a.createElement(ee.Button,{variant:"secondary",onClick:this.addTagFilter},"+"),ne.a.createElement("div",{hidden:!a.showWarningCantShowAllResults},ne.a.createElement(ee.InlineFormLabel,{width:12,tooltip:"Add Filter to narrow down the data."},"⚠️ Can't show all results"))))},t}(ne.a.Component),Qe=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.tooltip,a=e.searchable,r=void 0===a||a,i=e.disabled,s=e.queryKeyword,u=e.placeholder,c=void 0===u?"-":u,p=e.labelWidth,y=void 0===p?14:p,h=e.inputWidth,d=void 0===h?30:h,g=l(e,["label","tooltip","searchable","disabled","queryKeyword","placeholder","labelWidth","inputWidth"]);return ne.a.createElement(ie,{disabled:i,stretch:!d},ne.a.createElement(ee.InlineFormLabel,{className:s?"query-keyword":"",width:y,tooltip:n},t),ne.a.createElement(ee.Select,o({menuPlacement:"bottom",disabled:i,width:d,isSearchable:r,placeholder:c},g)))},t}(ne.a.Component),Be=function(e){function t(t){var n=e.call(this,t)||this;return n.onQueryChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.updateQueryTypes;e.currentTarget&&e.currentTarget.value?a.entityQuery=e.currentTarget.value:(i([]),a.entityQuery="",a.entityType={key:null,label:"-"}),r(a),n.debouncedEntityTypes()},n.onTypeChange=function(e){var t=n.props,a=t.query,r=t.datasource,i=t.onChange;a.entityType=e,i(a),r.dataSourceInfrastructure.getMetricsCatalog(a.entityType,a.metricCategory.key).then((function(e){n.props.updateMetrics(e)}))},n.debouncedEntityTypes=d.a.debounce(n.props.loadEntityTypes,500),n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.query,n=e.loadEntityTypes;t.entityQuery&&n()},t.prototype.render=function(){var e=this.props,t=e.query,n=e.queryTypes;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(pe,{queryKeyword:!0,inputWidth:0,label:"Query",tooltip:ne.a.createElement("div",null,"Specify a query for the entities you wish to plot. Use the dynamic focus syntax:",ne.a.createElement("a",{href:"https://www.ibm.com/docs/en/instana-observability/current?topic=instana-filtering-dynamic-focus#syntax"},"https://www.ibm.com/docs/en/instana-observability/current?topic=instana-filtering-dynamic-focus#syntax")),value:t.entityQuery,placeholder:"Please specify",onChange:this.onQueryChange}),ne.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Type",tooltip:"Select an entity type for a list of available metrics.",noOptionsMessage:"No types found with query",value:t.entityType,options:n,onChange:this.onTypeChange}))},t}(ne.a.Component),Ve=!1,De=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.onChange,r=t.datasource;Ve=!1,n.entityQuery&&n.entityType&&n.entityType.key?r.dataSourceInfrastructure.getMetricsCatalog(n.entityType,n.metricCategory.key).then((function(t){Ve||e.props.updateMetrics(t)})):n.metric={key:null,label:"-"},a(n)},t.prototype.componentWillUnmount=function(){Ve=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.onRunQuery,a=e.onChange,r=e.updateMetrics,i=e.loadEntityTypes,o=e.datasource,l=e.queryTypes,s=e.updateQueryTypes;return ne.a.createElement(Be,{query:t,onChange:a,queryTypes:l,onRunQuery:n,datasource:o,updateMetrics:r,loadEntityTypes:i,updateQueryTypes:s})},t}(ne.a.Component),$e=function(e){function t(t){var n=e.call(this,t)||this;return n.onMetricChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery,i=t.onChange;a.metric=e,a.metric&&a.metric.key&&!d.a.includes(a.metric.aggregations,a.aggregation)&&(a.aggregation=a.metric.aggregations[0]),a.displayMaxMetricValue&&!n.canShowMaxMetricValue()&&(a.displayMaxMetricValue=!1),a.allMetrics=[],a.showAllMetrics=!1,i(a),r()},n.onTimeIntervalChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery,i=t.onChange;a.timeInterval=e,i(a),r()},n.onAggregationChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery,i=t.onChange;a.aggregation=e,i(a),r()},n.onShowMaxValueChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;e&&e.currentTarget&&(a.displayMaxMetricValue=e.currentTarget.checked,r(a),i())},n.onShowAllMetricsChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;e&&e.currentTarget&&(a.showAllMetrics=e.currentTarget.checked,a.showAllMetrics&&(a.metric={key:null,label:"Displaying "+n.props.availableMetrics.length+" metrics"},a.allMetrics=n.props.availableMetrics),r(a),i())},n.state={possibleTimeIntervals:[],possibleAggregations:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.query,n=e.datasource,a=e.onChange;t.timeInterval&&t.timeInterval.key&&n.availableTimeIntervals.find((function(e){return e.key===t.timeInterval.key}))||(t.timeInterval=n.getDefaultTimeInterval(t)),a(t)},t.prototype.canShowMaxMetricValue=function(){var e=this.props.query;return e.entityType&&"host"===e.entityType.key&&e.metric&&d.a.find(G,(function(t){return t.key===e.metric.key}))},t.prototype.canShowAggregation=function(){return this.props.query.metricCategory.key>=2},t.prototype.canSelectAggregation=function(){var e=this.props.query;return e.metric&&e.metric.aggregations&&e.metric.aggregations.length>1},t.prototype.render=function(){var e=this.props,t=e.query,n=e.datasource;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(Qe,{queryKeyword:!0,disabled:t.useFreeTextMetrics,inputWidth:0,label:"Metric",tooltip:"Select the metric you wish to plot.",value:t.metric,noOptionsMessage:"No metrics found",options:this.props.availableMetrics,onChange:this.onMetricChange}),0===t.metricCategory.key&&ne.a.createElement(le,{queryKeyword:!0,disabled:!this.canShowMaxMetricValue(),labelWidth:9,label:"Show max value",tooltip:"Displays the maximal value of current metric. Supported for 'Type=Host' with cpu.used, memory.used and openFiles.used only.",value:t.displayMaxMetricValue,onChange:this.onShowMaxValueChange}),1===t.metricCategory.key&&ne.a.createElement(le,{queryKeyword:!0,disabled:!t.canShowAllMetrics,labelWidth:9,label:"Show all metrics",tooltip:"You have the option to show all metrics in the graph once the amount of possible, selectable metrics is between 1 and 5.",value:t.showAllMetrics,onChange:this.onShowAllMetricsChange}),this.canShowAggregation()&&ne.a.createElement(Qe,{queryKeyword:!0,disabled:!this.canSelectAggregation(),labelWidth:7,inputWidth:12,label:"Aggregation",tooltip:"Select a metric aggregation.",value:t.aggregation,options:t.metric.aggregations,onChange:this.onAggregationChange}),8!==t.metricCategory.key&&ne.a.createElement(Qe,{queryKeyword:!0,disabled:n.availableTimeIntervals.length<=1,labelWidth:5,inputWidth:12,label:"Rollup",tooltip:"Select the rollup value.",value:t.timeInterval,options:n.availableTimeIntervals,onChange:this.onTimeIntervalChange}))},t}(ne.a.Component),Ue=function(e){function t(t){var n=e.call(this,t)||this;return n.onFilterChange=function(e,t){var a=n.state.customFilters;a[t]=e.currentTarget.value,n.setState({customFilters:a}),n.props.onFilterChange(a)},n.addCustomFilter=function(){var e=n.state.customFilters;e.push(""),n.setState({customFilters:e});var t=n.props,a=t.query,r=t.onChange;a.customFilters=e,r(a)},n.removeCustomFilter=function(e){var t=n.state.customFilters;t.splice(e,1),n.setState({customFilters:t}),n.props.onFilterChange(t)},n.state={customFilters:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.props.query;this.setState({customFilters:e.customFilters})},t.prototype.render=function(){var e=this,t=this.state.customFilters.map((function(t,n){return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(pe,{label:n+1+". filter metric select",value:e.state.customFilters[n],placeholder:"Please specify",onChange:function(t){return e.onFilterChange(t,n)},tooltip:"Type to suggest metrics."}),ne.a.createElement(ee.Button,{variant:"secondary",onClick:function(){return e.removeCustomFilter(n)}},"-"))}));return ne.a.createElement("div",null,t,ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(ee.InlineFormLabel,{width:14,tooltip:"Add an additional metric select filter."},"Add filter metric select"),ne.a.createElement(ee.Button,{variant:"secondary",onClick:this.addCustomFilter},"+")))},t}(ne.a.Component),Ge=[{key:"session_start",label:"Session Starts"},{key:"view_change",label:"View Transitions"},{key:"crash",label:"Crashes"},{key:"http_request",label:"HTTP Requests"},{key:"custom",label:"Custom Events"}],Ke=!1,We=function(e){function t(t){var n=e.call(this,t)||this;return n.onMobileappChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,r(a),i()},n.onBeaconTypeChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.filterMetricsOnType;a.entityType=e,r(a),i(a.entityType.key)},n.onGroupChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.group=e,a.group&&9===a.metricCategory.key&&(a.showGroupBySecondLevel="KEY_VALUE_PAIR"===a.group.type),a.showGroupBySecondLevel||(a.groupbyTagSecondLevelKey=""),r(a),i()},n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.state={mobileapps:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.datasource,r=t.onChange;Ke=!1,a.fetchMobileapp().then((function(t){Ke||(d.a.find(t,{key:null})||t.unshift({key:null,label:"-- No Mobile App Filter --"}),e.setState({mobileapps:t}),n.entity&&n.entity.key||!t?n.entity&&!d.a.find(t,["key",n.entity.key])&&(n.entity=t[0]):n.entity=t[0],r(n))})),a.dataSourceMobileapp.getMobileappTags().then((function(t){Ke||(e.props.updateGroups(d.a.sortBy(t,"key")),n.group&&n.group.key||(n.group=d.a.find(t,["key","beacon.page.name"]),r(n)))})),n.entityType&&n.entityType.key||(n.entityType=Ge[0],r(n)),a.dataSourceMobileapp.getMobileappMetricsCatalog().then((function(t){Ke||(e.props.updateMetrics(t),e.props.filterMetricsOnType(n.entityType.key))}))},t.prototype.componentWillUnmount=function(){Ke=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.groups;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Mobile-app",tooltip:"Select your mobile app.",noOptionsMessage:"No mobile apps found",value:t.entity,options:this.state.mobileapps,onChange:this.onMobileappChange}),ne.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Type",tooltip:"Select a beacon type.",value:t.entityType,options:Ge,onChange:this.onBeaconTypeChange}),ne.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Group by",tooltip:"Group by tag.",value:t.group,options:n,onChange:this.onGroupChange}),ne.a.createElement("div",{style:t.showGroupBySecondLevel?{}:{display:"none"}},ne.a.createElement(ee.Input,{value:t.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(ne.a.Component),ze=[{key:"SLI",label:"SLI"},{key:"Remaining Error Budget",label:"Remaining Error Budget"},{key:"Timeseries",label:"Timeseries"}],je=!1,Ye=function(e){function t(t){var n=e.call(this,t)||this;return n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onSloChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery;a.sloReport=e,r()},n.onSloValueChange=function(e){var t=n.props.query;t.sloValue=e.currentTarget.value,n.isValid(t.sloValue)&&n.debouncedRunQuery()},n.onSloSpecificChange=function(e){var t=n.props,a=t.query,r=t.onRunQuery;a.sloSpecific=e,r()},n.state={sloReports:[],isValidSlo:!0},n}return i(t,e),t.prototype.componentDidMount=function(){je=!1,this.loadSloReports(),this.isValid(this.props.query.sloValue)},t.prototype.componentWillUnmount=function(){je=!0},t.prototype.isValid=function(e){var t=!e||+e>=0&&+e<=.9999;return this.setState({isValidSlo:t}),t},t.prototype.shouldComponentUpdate=function(e,t,n){return 7===e.query.metricCategory.key},t.prototype.loadSloReports=function(){var e=this,t=this.props.query;this.props.datasource.getSloReports().then((function(n){je||(e.setState({sloReports:n}),!t.sloReport&&n.length>=1&&(t.sloReport=n[0]))}))},t.prototype.render=function(){var e=this.props.query;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Configured SLI",tooltip:"SLI configuration used to compute error budget and SLI values.",noOptionsMessage:"No configured SLI found",value:e.sloReport,options:this.state.sloReports,onChange:this.onSloChange}),ne.a.createElement(pe,{queryKeyword:!0,labelWidth:7,inputWidth:0,label:"SLO",tooltip:"Type in your desired SLO threshold from 0 to 0.9999",value:e.sloValue,invalid:!this.state.isValidSlo,placeholder:"0.99",onChange:this.onSloValueChange}),ne.a.createElement(Qe,{queryKeyword:!0,labelWidth:7,inputWidth:0,label:"Value type",tooltip:ne.a.createElement("div",null,"Select your specific SLO information:",ne.a.createElement("ul",null,ne.a.createElement("li",null,"'SLI' requires Gauge visualization"),ne.a.createElement("li",null,"'Remaining Error Budget' requires Singlestat visualization"),ne.a.createElement("li",null,"'Timeseries' drequires Bars draw mode on Graph visualization"))),value:e.sloSpecific,options:ze,onChange:this.onSloSpecificChange}))},t}(ne.a.Component),He=[{key:"pageLoad",label:"Page Loads"},{key:"page_change",label:"Page Transitions"},{key:"resourceLoad",label:"Resources"},{key:"httpRequest",label:"HTTP Requests"},{key:"error",label:"Errors"},{key:"custom",label:"Custom Events"}],Je=!1,Ze=function(e){function t(t){var n=e.call(this,t)||this;return n.onWebsiteChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.entity=e,r(a),i()},n.onBeaconTypeChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.filterMetricsOnType;a.entityType=e,r(a),i(a.entityType.key)},n.onGroupChange=function(e){var t=n.props,a=t.query,r=t.onChange,i=t.onRunQuery;a.group=e,a.group&&3===a.metricCategory.key&&(a.showGroupBySecondLevel="KEY_VALUE_PAIR"===a.group.type),a.showGroupBySecondLevel||(a.groupbyTagSecondLevelKey=""),r(a),i()},n.debouncedRunQuery=d.a.debounce(n.props.onRunQuery,500),n.onGroupByTagSecondLevelKeyChange=function(e){var t=n.props,a=t.query,r=t.onChange;a.groupbyTagSecondLevelKey=e.currentTarget.value,r(a),n.debouncedRunQuery()},n.state={websites:[]},n}return i(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.query,a=t.datasource,r=t.onChange;Je=!1,a.fetchWebsites().then((function(t){Je||(d.a.find(t,{key:null})||t.unshift({key:null,label:"-- No Website Filter --"}),e.setState({websites:t}),n.entity&&n.entity.key||!t?n.entity&&!d.a.find(t,["key",n.entity.key])&&(n.entity=t[0]):n.entity=t[0],r(n))})),a.dataSourceWebsite.getWebsiteTags().then((function(t){Je||(e.props.updateGroups(d.a.sortBy(t,"key")),n.group&&n.group.key||(n.group=d.a.find(t,["key","beacon.page.name"]),r(n)))})),n.entityType&&n.entityType.key||(n.entityType=He[0],r(n)),a.dataSourceWebsite.getWebsiteMetricsCatalog().then((function(t){Je||(e.props.updateMetrics(t),e.props.filterMetricsOnType(n.entityType.key))}))},t.prototype.componentWillUnmount=function(){Je=!0},t.prototype.render=function(){var e=this.props,t=e.query,n=e.groups;return ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Website",tooltip:"Select your website.",noOptionsMessage:"No websites found",value:t.entity,options:this.state.websites,onChange:this.onWebsiteChange}),ne.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Type",tooltip:"Select a beacon type.",value:t.entityType,options:He,onChange:this.onBeaconTypeChange}),ne.a.createElement(Qe,{queryKeyword:!0,labelWidth:6,label:"Group by",tooltip:"Group by tag.",value:t.group,options:n,onChange:this.onGroupChange}),ne.a.createElement("div",{style:t.showGroupBySecondLevel?{}:{display:"none"}},ne.a.createElement(ee.Input,{value:t.groupbyTagSecondLevelKey,onChange:this.onGroupByTagSecondLevelKeyChange})))},t}(ne.a.Component),Xe=function(e){function t(t){var n=e.call(this,t)||this;n.onCategoryChange=function(e){n.query.metricCategory===e||(n.selectionReset(),n.query.metricCategory=e,n.query.timeInterval=n.props.datasource.getDefaultTimeInterval(n.query),n.changeAndRun())},n.changeAndRun=function(){n.props.onChange(n.query),n.props.onRunQuery()},n.updateMetrics=function(e){n.setState({availableMetrics:d.a.sortBy(e,"key"),allMetrics:d.a.sortBy(e,"key")},(function(){if(n.query.metric&&n.query.metric.key||n.query.showAllMetrics){var t=d.a.find(e,(function(e){return e.key===n.query.metric.key}));n.query.metric=t||{key:null}}1===n.query.metricCategory.key?n.onMetricsFilter(n.query.customFilters):n.query.metric&&n.query.metric.key||n.setMetricPlaceholder(e.length),n.changeAndRun()}))},n.filterForEntityType=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var a=n.props,r=a.query,i=a.datasource,o=a.onChange;i.getEntityTypes().then((function(a){var i=a;t&&!r.useFreeTextMetrics&&(i=n.filterEntityTypes(a,e)),n.setState({queryTypes:i}),r.entityType&&r.entityType.key&&d.a.find(i,(function(e){return e.key===r.entityType.key}))||(r.entityType={key:null,label:"Please select ("+i.length+")"}),o(r)}))},n.filterEntityTypes=function(e,t){return t?d.a.sortBy(d.a.filter(e,(function(e){return n.findMatchingEntityTypes(e)})),"label"):d.a.sortBy(e,"label")},n.findMatchingEntityTypes=function(e){return(0===n.props.query.metricCategory.key||"statsd"===e.key||"prometheus"===e.key||"jvmRuntimePlatform"===e.key||"dropwizardApplicationContainer"===e.key)&&(n.snapshots.find((function(t){return t===e.key}))&&null!=e.label)},n.updateQueryTypes=function(e){n.setState({queryTypes:e})},n.updateGroups=function(e){n.setState({groups:e})},n.onMetricsFilter=function(e){var t=[];t=e&&0!==e.length?n.applyFilterToMetricList(e):n.state.allMetrics,n.query.canShowAllMetrics=n.isAbleToShowAllMetrics(t),n.query.canShowAllMetrics||(n.query.showAllMetrics=!1),n.query.customFilters=e,n.query.metric&&n.query.metric.key||n.setMetricPlaceholder(t.length),n.setState((function(e){return o(o({},e),{availableMetrics:t})})),n.props.onChange(n.query),n.checkMetricAndRefresh()};var a={metricCategory:H[0],timeShiftIsValid:!0,customFilters:[]};return n.query=Object.assign(a,t.query),Z(n.query),n.state={groups:[],allMetrics:[],queryTypes:[],availableMetrics:[],selectedWindowSize:t.range?v(t.range).windowSize:216e5},n.filterMetricsOnType=n.filterMetricsOnType.bind(n),n.loadEntityTypes=n.loadEntityTypes.bind(n),n.allowInfraExplore=t.datasource.options.allowInfraExplore,t.onChange(n.query),n}return i(t,e),t.prototype.componentDidUpdate=function(e,t,n){var a=this,r=this.props,i=r.onChange,l=r.range,s=r.datasource;l&&this.state.selectedWindowSize!==v(l).windowSize&&(this.setState(o(o({},this.state),{selectedWindowSize:v(l).windowSize})),s.setPossibleTimeIntervals(this.query),s.availableTimeIntervals.find((function(e){return e.key===a.query.timeInterval.key}))||(this.query.timeInterval=s.getDefaultTimeInterval(this.query),i(this.query)))},t.prototype.setMetricPlaceholder=function(e){1===this.query.metricCategory.key?this.query.metric={key:null,label:"Please select ("+e+"/"+this.state.allMetrics.length+")"}:this.query.metric={key:null,label:"Please select ("+e+")"},this.props.onChange(this.query)},t.prototype.loadEntityTypes=function(e){var t=this;void 0===e&&(e=!0);var n=this.props,a=n.query,r=n.datasource,i=n.onRunQuery;a.entityQuery?r.fetchTypesForTarget(a).then((function(n){t.snapshots=n.data,t.filterForEntityType(!0,e),i()})):this.setState({queryTypes:[]})},t.prototype.applyFilterToMetricList=function(e){var t=this.state.allMetrics;return d.a.forEach(e,(function(e){""!==e&&(t=d.a.sortBy(d.a.filter(t,(function(t){return t.key.toLowerCase().includes(e.toLowerCase())})),"key"))})),t},t.prototype.filterMetricsOnType=function(e){var t=this.state.allMetrics.filter((function(t){return t.beaconTypes.includes(e)}));this.setState({availableMetrics:t}),this.query.metric&&this.query.metric.key&&this.query.metric.beaconTypes.includes(e)||this.setMetricPlaceholder(t.length),this.changeAndRun()},t.prototype.isAbleToShowAllMetrics=function(e){return 1===this.query.metricCategory.key&&e.length>0&&e.length<=5},t.prototype.checkMetricAndRefresh=function(){this.query.metric&&this.query.metric.key&&!d.a.includes(d.a.map(this.state.availableMetrics,(function(e){return e.key})),this.query.metric.key)&&this.resetMetricSelection(),this.changeAndRun()},t.prototype.selectionReset=function(){var e=this.props.query;e.metricCategory.key>1&&(e.entityQuery=""),this.setState({availableMetrics:[],allMetrics:[],groups:[]}),this.resetEntityTypeSelection(),this.resetEntitySelection(),this.resetMetricSelection()},t.prototype.resetEntityTypeSelection=function(){var e=this.props.query;e.entityType={key:null,label:"-"},e.customFilters=[]},t.prototype.resetEntitySelection=function(){var e=this.props.query;e.entity={},e.group={},e.showGroupBySecondLevel=!1,e.groupbyTagSecondLevelKey="",e.aggregateGraphs=!1,e.aggregationFunction=ue[0],e.hideOriginalGraphs=!1,e.filters=[],e.showWarningCantShowAllResults=!1,e.showAllMetrics=!1,e.canShowAllMetrics=!1,e.displayMaxMetricValue=!1,e.applicationCallToEntity="",e.callToEntity="",e.tagFilterExpression="",this.resetServices(),this.resetEndpoints(),this.resetSLO()},t.prototype.resetMetricSelection=function(){var e=this.props.query;e.metric={},e.timeShift="",e.timeShiftIsValid=!0,e.showWarningCantShowAllResults=!1,e.showAllMetrics=!1,e.labelFormat="",e.freeTextMetrics="",e.useFreeTextMetrics=!1},t.prototype.resetServices=function(){this.props.query.service={}},t.prototype.resetEndpoints=function(){this.props.query.endpoint={}},t.prototype.resetSLO=function(){var e=this.props.query;e.sloValue="",e.sloReport={}},t.prototype.render=function(){var e=this.query,t=this.onCategoryChange,n=this.allowInfraExplore?H:H.filter((function(e){return 8!==e.key}));return ne.a.createElement("div",{className:"gf-form-group"},ne.a.createElement("div",{className:"gf-form"},ne.a.createElement(Qe,{queryKeyword:!0,inputWidth:0,label:"Category",tooltip:"Select a metric category.",value:e.metricCategory,options:n,onChange:t})),0===e.metricCategory.key&&ne.a.createElement(De,{query:e,queryTypes:this.state.queryTypes,datasource:this.props.datasource,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,loadEntityTypes:this.loadEntityTypes,updateQueryTypes:this.updateQueryTypes}),1===e.metricCategory.key&&ne.a.createElement(De,{query:e,queryTypes:this.state.queryTypes,datasource:this.props.datasource,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,loadEntityTypes:this.loadEntityTypes,updateQueryTypes:this.updateQueryTypes}),8===e.metricCategory.key&&ne.a.createElement(Ne,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,groups:this.state.groups,updateGroups:this.updateGroups,datasource:this.props.datasource}),2===e.metricCategory.key&&ne.a.createElement(we,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,groups:this.state.groups,updateGroups:this.updateGroups,datasource:this.props.datasource}),3===e.metricCategory.key&&ne.a.createElement(Ze,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,groups:this.state.groups,updateGroups:this.updateGroups,filterMetricsOnType:this.filterMetricsOnType,datasource:this.props.datasource}),9===e.metricCategory.key&&ne.a.createElement(We,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,groups:this.state.groups,updateGroups:this.updateGroups,filterMetricsOnType:this.filterMetricsOnType,datasource:this.props.datasource}),4===e.metricCategory.key&&ne.a.createElement(Le,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,updateMetrics:this.updateMetrics,datasource:this.props.datasource}),7===e.metricCategory.key&&ne.a.createElement(Ye,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,datasource:this.props.datasource}),7!==e.metricCategory.key&&ne.a.createElement($e,{query:e,onChange:this.props.onChange,onRunQuery:this.props.onRunQuery,updateMetrics:this.updateMetrics,availableMetrics:this.state.availableMetrics,datasource:this.props.datasource}),1===e.metricCategory.key&&ne.a.createElement(Ue,{query:e,onChange:this.props.onChange,onRunQuery:this.props.onRunQuery,onFilterChange:this.onMetricsFilter,availableMetrics:this.state.availableMetrics,datasource:this.props.datasource}),(2===e.metricCategory.key||3===e.metricCategory.key||9===e.metricCategory.key||8===e.metricCategory.key)&&ne.a.createElement(Pe,{query:e,onChange:this.props.onChange,onRunQuery:this.props.onRunQuery,datasource:this.props.datasource,groups:this.state.groups}),ne.a.createElement(de,{query:e,onRunQuery:this.props.onRunQuery,onChange:this.props.onChange,loadEntityTypes:this.loadEntityTypes}),ne.a.createElement(ee.Badge,{text:"4.0.1",color:"blue"}))},t}(te.PureComponent);n.d(t,"plugin",(function(){return et}));var et=new a.DataSourcePlugin(X).setConfigEditor(re).setQueryEditor(Xe)}])}));
//# sourceMappingURL=module.js.map